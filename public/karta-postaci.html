<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karta Postaci ¬∑ Psycher</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #030014;
            color: #f8fafc;
            font-family: 'Space Grotesk', sans-serif;
            min-height: 100vh;
            background-image:
                linear-gradient(rgba(56,182,255,.025) 1px, transparent 1px),
                linear-gradient(90deg, rgba(56,182,255,.025) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* ‚îÄ‚îÄ‚îÄ NAV BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .kp-nav {
            position: sticky;
            top: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: rgba(3,0,20,.88);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(56,182,255,.09);
        }
        .kp-back {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid rgba(56,182,255,.22);
            background: rgba(56,182,255,.07);
            color: #38b6ff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            letter-spacing: 1.5px;
            cursor: pointer;
            text-decoration: none;
            transition: background .18s, border-color .18s;
        }
        .kp-back:hover { background: rgba(56,182,255,.14); border-color: rgba(56,182,255,.45); }
        .kp-logo {
            font-family: 'Orbitron', monospace;
            font-size: 15px;
            font-weight: 900;
            letter-spacing: 3px;
            color: #fff;
            text-shadow: 0 0 18px rgba(56,182,255,.35);
        }
        .kp-logo span { color: #38b6ff; }
        .kp-share {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid rgba(176,143,255,.22);
            background: rgba(176,143,255,.07);
            color: #b08fff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: background .18s, border-color .18s;
        }
        .kp-share:hover { background: rgba(176,143,255,.14); border-color: rgba(176,143,255,.45); }

        /* ‚îÄ‚îÄ‚îÄ PAGE WRAPPER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .kp-main {
            max-width: 1320px;
            margin: 0 auto;
            padding: 28px 20px 60px;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           KARTA POSTACI ‚Äî CHARACTER SHEET (ch-*)
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .ch-sheet-wrapper { font-family: 'Space Grotesk', sans-serif; padding-bottom: 48px; }
        /* Top status bar */
        .ch-topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; padding:9px 16px; background:rgba(8,14,40,.72); border:1px solid rgba(56,182,255,.10); border-radius:8px; backdrop-filter:blur(14px); flex-wrap:wrap; gap:8px; }
        .ch-tb-pill { display:inline-flex; align-items:center; gap:7px; padding:4px 12px; border-radius:3px; background:rgba(52,211,153,.07); border:1px solid rgba(52,211,153,.22); font-family:'Share Tech Mono',monospace; font-size:9.5px; letter-spacing:2px; color:#34d399; }
        .ch-tb-dot { width:5px; height:5px; border-radius:50%; background:#34d399; box-shadow:0 0 8px #34d399; animation:ch-blink 1.8s ease-in-out infinite; }
        @keyframes ch-blink { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.5)} }
        .ch-tb-meta { font-family:'Share Tech Mono',monospace; font-size:8.5px; color:rgba(56,182,255,.28); letter-spacing:2px; text-align:right; line-height:1.9; }
        /* Avatar animations */
        .ch-av-wrap { position:relative; width:120px; height:120px; flex-shrink:0; }
        .ch-av-svg  { width:120px; height:120px; }
        .ch-asc { animation:ch-asc 3.4s ease-in-out infinite; }
        @keyframes ch-asc { 0%{transform:translateY(-33px);opacity:0} 6%{opacity:.6} 94%{opacity:.6} 100%{transform:translateY(33px);opacity:0} }
        /* Level pill */
        .ch-lvl { display:inline-flex; align-items:center; gap:6px; padding:4px 11px; border-radius:2px; background:linear-gradient(110deg,rgba(99,102,241,.14),rgba(56,182,255,.11)); border:1px solid rgba(99,102,241,.28); font-family:'Share Tech Mono',monospace; font-size:9px; letter-spacing:2px; color:#a5b4fc; margin-bottom:11px; }
        .ch-ldot { width:4px; height:4px; border-radius:50%; background:#a5b4fc; box-shadow:0 0 6px #a5b4fc; }
        .ch-cname  { font-family:'Orbitron',monospace; font-size:17px; font-weight:900; letter-spacing:2.5px; text-transform:uppercase; color:#fff; margin-bottom:4px; text-shadow:0 0 18px rgba(56,182,255,.22); word-break:break-all; }
        .ch-carch  { font-family:'Share Tech Mono',monospace; font-size:10px; letter-spacing:2px; color:#38b6ff; text-shadow:0 0 10px rgba(56,182,255,.4); margin-bottom:3px; }
        .ch-ccodes { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:1.5px; color:rgba(255,255,255,.22); margin-bottom:11px; }
        .ch-rare   { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:2px; background:rgba(176,143,255,.07); border:1px solid rgba(176,143,255,.2); font-family:'Share Tech Mono',monospace; font-size:8.5px; letter-spacing:1.5px; color:#b08fff; margin-bottom:13px; }
        /* XP bar */
        .ch-xp-wrap  { width:100%; }
        .ch-xp-lbl   { display:flex; justify-content:space-between; margin-bottom:4px; font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:1.5px; }
        .ch-xp-track { height:4px; background:rgba(255,255,255,.05); border-radius:2px; overflow:visible; position:relative; }
        .ch-xp-fill  { height:100%; border-radius:2px; background:linear-gradient(90deg,#3d2a9e,#38b6ff); box-shadow:0 0 10px rgba(56,182,255,.5); position:relative; transition:width 1s ease-out; }
        .ch-xp-fill::after { content:''; position:absolute; right:-1px; top:50%; transform:translateY(-50%); width:8px; height:8px; border-radius:50%; background:#fff; box-shadow:0 0 8px rgba(56,182,255,.8); }
        /* Attribute grid (HEXACO) */
        .ch-attr-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:16px; }
        .ch-attr-b { padding:10px 9px; border-radius:4px; position:relative; overflow:hidden; cursor:default; transition:transform .22s; }
        .ch-attr-b:hover { transform:translateY(-2px); }
        .ch-a-lbl { font-family:'Share Tech Mono',monospace; font-size:7px; letter-spacing:1.5px; color:rgba(255,255,255,.26); margin-bottom:2px; text-transform:uppercase; }
        .ch-a-val { font-family:'Orbitron',monospace; font-size:25px; font-weight:700; line-height:1; margin-bottom:1px; }
        .ch-a-nm  { font-size:8px; font-weight:600; color:rgba(255,255,255,.28); }
        .ch-ag { background:rgba(0,229,160,.07);   border:1px solid rgba(0,229,160,.18);   } .ch-ag .ch-a-val{color:#34d399;}
        .ch-ac { background:rgba(56,182,255,.07);  border:1px solid rgba(56,182,255,.18);  } .ch-ac .ch-a-val{color:#38b6ff;}
        .ch-av { background:rgba(176,143,255,.07); border:1px solid rgba(176,143,255,.18); } .ch-av .ch-a-val{color:#b08fff;}
        .ch-at { background:rgba(64,224,208,.07);  border:1px solid rgba(64,224,208,.18);  } .ch-at .ch-a-val{color:#40e0d0;}
        .ch-ap { background:rgba(232,120,224,.07); border:1px solid rgba(232,120,224,.18); } .ch-ap .ch-a-val{color:#e878e0;}
        .ch-ao { background:rgba(249,115,22,.07);  border:1px solid rgba(249,115,22,.18);  } .ch-ao .ch-a-val{color:#f97316;}
        /* HEXACO detail bars */
        .ch-hx-bars { display:grid; grid-template-columns:1fr 1fr; gap:6px 20px; }
        .ch-hb       { display:flex; flex-direction:column; gap:4px; }
        .ch-hb-top   { display:flex; justify-content:space-between; align-items:center; }
        .ch-hb-name  { font-size:10px; font-weight:600; color:rgba(255,255,255,.44); }
        .ch-hb-val   { font-family:'Share Tech Mono',monospace; font-size:10px; font-weight:700; }
        .ch-hb-track { height:4px; background:rgba(255,255,255,.06); border-radius:100px; overflow:hidden; }
        .ch-hb-fill  { height:100%; border-radius:100px; }
        /* Enneagram type labels */
        .ch-enn-type { font-size:13px; font-weight:700; color:rgba(255,255,255,.85); }
        .ch-enn-sub  { font-family:'Share Tech Mono',monospace; font-size:7.5px; color:rgba(255,255,255,.25); letter-spacing:1px; margin-top:2px; }
        .ch-enn-desc { font-size:10px; color:rgba(255,255,255,.38); line-height:1.6; }
        /* Holland / Career letters */
        .ch-hol-ltrs { display:flex; gap:5px; margin-bottom:8px; }
        .ch-hl       { font-family:'Orbitron',monospace; font-size:15px; font-weight:700; width:29px; height:29px; border-radius:3px; display:flex; align-items:center; justify-content:center; }
        .ch-hl-i     { background:rgba(56,182,255,.12);  color:#38b6ff; border:1px solid rgba(56,182,255,.28); }
        .ch-hl-e     { background:rgba(0,229,160,.10);   color:#34d399; border:1px solid rgba(0,229,160,.24); }
        .ch-hl-a     { background:rgba(232,120,224,.10); color:#e878e0; border:1px solid rgba(232,120,224,.24); }
        /* Career tags */
        .ch-careers  { display:flex; flex-wrap:wrap; gap:4px; }
        .ch-ct       { font-family:'Share Tech Mono',monospace; font-size:7.5px; padding:3px 7px; border-radius:2px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); color:rgba(255,255,255,.38); }
        /* Value chips */
        .ch-val-chips { display:flex; flex-wrap:wrap; gap:4px; }
        .ch-vc  { font-size:9.5px; font-weight:600; padding:3px 8px; border-radius:2px; }
        .ch-vc1 { background:rgba(56,182,255,.09);  border:1px solid rgba(56,182,255,.22);  color:#38b6ff; }
        .ch-vc2 { background:rgba(0,229,160,.07);   border:1px solid rgba(0,229,160,.2);    color:#34d399; }
        .ch-vc3 { background:rgba(245,158,11,.08);  border:1px solid rgba(245,158,11,.2);   color:#f59e0b; }
        .ch-vc4 { background:rgba(176,143,255,.08); border:1px solid rgba(176,143,255,.2);  color:#b08fff; }
        /* Dark Triad */
        .ch-dt-bars  { display:flex; flex-direction:column; gap:14px; }
        .ch-dt-row   { display:flex; flex-direction:column; gap:5px; }
        .ch-dt-head  { display:flex; align-items:center; justify-content:space-between; }
        .ch-dt-name  { display:flex; align-items:center; gap:7px; font-size:12.5px; font-weight:700; }
        .ch-dt-sw    { display:flex; align-items:baseline; gap:2px; }
        .ch-dt-sc    { font-family:'Orbitron',monospace; font-size:18px; font-weight:700; }
        .ch-dt-mx    { font-family:'Share Tech Mono',monospace; font-size:8px; color:rgba(255,255,255,.28); }
        .ch-dt-pc    { font-family:'Share Tech Mono',monospace; font-size:8px; }
        .ch-dt-track { height:9px; border-radius:2px; background:rgba(255,255,255,.04); overflow:hidden; }
        .ch-dt-fill  { height:100%; border-radius:2px; transition:width 1s ease-out; }
        .ch-dt-tags  { display:flex; flex-wrap:wrap; gap:3px; }
        .ch-dtag     { font-family:'Share Tech Mono',monospace; font-size:7px; letter-spacing:.5px; padding:2px 6px; border-radius:2px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); color:rgba(255,255,255,.3); }
        /* Strengths */
        .ch-str-list { display:flex; flex-direction:column; gap:6px; }
        .ch-str-item { display:flex; align-items:center; gap:8px; padding:7px 10px; border-radius:4px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07); transition:background .2s,border-color .2s,transform .18s; }
        .ch-str-item:hover { background:rgba(56,182,255,.05); border-color:rgba(56,182,255,.18); transform:translateX(3px); }
        .ch-srk { font-family:'Share Tech Mono',monospace; font-size:9px; color:rgba(255,255,255,.18); width:14px; flex-shrink:0; text-align:center; }
        .ch-sinf { flex:1; }
        .ch-snm  { font-size:11px; font-weight:700; color:rgba(255,255,255,.78); }
        .ch-sct  { font-family:'Share Tech Mono',monospace; font-size:7px; color:rgba(255,255,255,.27); }
        .ch-sbar { width:30px; height:3px; background:rgba(255,255,255,.06); border-radius:100px; flex-shrink:0; overflow:hidden; }
        .ch-sbf  { height:100%; border-radius:100px; }
        /* Trait chips */
        .ch-tflow { display:flex; flex-wrap:wrap; gap:6px; }
        .ch-tt  { display:flex; align-items:center; gap:4px; padding:4px 10px; border-radius:2px; font-size:10px; font-weight:600; cursor:default; transition:transform .18s; }
        .ch-tt:hover { transform:translateY(-2px); }
        .ch-ttc { background:rgba(56,182,255,.09);  border:1px solid rgba(56,182,255,.22);  color:#38b6ff; }
        .ch-ttv { background:rgba(176,143,255,.09); border:1px solid rgba(176,143,255,.22); color:#b08fff; }
        .ch-ttg { background:rgba(0,229,160,.08);   border:1px solid rgba(0,229,160,.2);    color:#34d399; }
        .ch-tto { background:rgba(249,115,22,.08);  border:1px solid rgba(249,115,22,.2);   color:#f97316; }
        .ch-ttp { background:rgba(232,120,224,.08); border:1px solid rgba(232,120,224,.2);  color:#e878e0; }
        .ch-ttw { background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);  color:rgba(255,255,255,.5); }
        .ch-ttt { background:rgba(64,224,208,.08);  border:1px solid rgba(64,224,208,.2);   color:#40e0d0; }
        /* shadow panel */
        .ch-sh-list  { display:flex; flex-direction:column; gap:8px; }
        .ch-sh-item  { display:flex; align-items:flex-start; gap:10px; padding:10px 12px; border-radius:4px; background:rgba(239,68,68,.04); border:1px solid rgba(239,68,68,.10); }
        .ch-sh-item:hover { background:rgba(239,68,68,.07); border-color:rgba(239,68,68,.2); }
        .ch-shico { font-size:16px; flex-shrink:0; margin-top:1px; }
        .ch-shbd  { flex:1; }
        .ch-shtt  { font-size:11px; font-weight:700; color:rgba(255,100,100,.82); margin-bottom:2px; }
        .ch-sht   { font-size:10px; color:rgba(255,255,255,.35); line-height:1.6; }
        /* Insight blocks */
        .ch-iblk  { padding:12px 13px; border-radius:4px; margin-bottom:9px; }
        .ch-iblk:last-child { margin-bottom:0; }
        .ch-ib-hd { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; margin-bottom:5px; text-transform:uppercase; }
        .ch-ib-tx { font-size:10.5px; color:rgba(255,255,255,.42); line-height:1.7; }
        .ch-ib-tx strong { color:rgba(255,255,255,.8); font-weight:600; }
        /* Footer */
        .ch-footer { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-top:13px; padding:10px 14px; border-radius:4px; background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.05); }
        .ch-fid    { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; color:rgba(56,182,255,.28); }
        .ch-ftests { font-family:'Share Tech Mono',monospace; font-size:7.5px; color:rgba(255,255,255,.12); letter-spacing:.8px; text-align:center; }
        .ch-fver   { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; color:rgba(123,94,167,.35); }
        /* Empty block / CTA */
        .ch-empty-block { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px 10px; text-align:center; opacity:.55; }
        .ch-empty-icon  { font-size:2rem; margin-bottom:8px; }
        .ch-empty-text  { font-size:.78rem; color:rgba(255,255,255,.3); margin-bottom:10px; }
        .ch-go-btn { display:inline-block; padding:6px 13px; border-radius:6px; border:1px solid rgba(99,102,241,.4); background:rgba(99,102,241,.12); color:#a5b4fc; font-size:.72rem; font-weight:600; cursor:pointer; transition:all .2s; font-family:inherit; }
        .ch-go-btn:hover { background:rgba(99,102,241,.22); color:#fff; }
        /* Section label */
        .ch-tl { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2.5px; color:rgba(56,182,255,.38); text-transform:uppercase; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
        .ch-tl::after { content:''; flex:1; height:1px; background:linear-gradient(90deg,rgba(56,182,255,.18),transparent); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BENTO GRID ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .ch-bento { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; }
        .ch-tile  { background:rgba(8,14,38,.88); backdrop-filter:blur(28px) saturate(160%); -webkit-backdrop-filter:blur(28px) saturate(160%); border:1px solid rgba(56,182,255,.11); border-radius:14px; position:relative; overflow:hidden; padding:20px; display:flex; flex-direction:column; }
        .ch-tile::before,.ch-tile::after { content:''; position:absolute; width:13px; height:13px; border-color:#38b6ff; border-style:solid; opacity:.22; pointer-events:none; z-index:0; }
        .ch-tile::before { top:0; left:0; border-width:1.5px 0 0 1.5px; }
        .ch-tile::after  { bottom:0; right:0; border-width:0 1.5px 1.5px 0; }
        .ch-tile-accent  { position:absolute; top:0; left:0; right:0; height:2px; border-radius:14px 14px 0 0; z-index:1; }
        .ch-t-hero  { grid-column:span 1; }
        .ch-t-radar { grid-column:span 2; }
        .ch-t-enn   { grid-column:span 1; }
        .ch-t-str   { grid-column:span 2; }
        .ch-t-dt    { grid-column:span 2; }
        .ch-t-synth { grid-column:1/-1; }
        @media (max-width:1100px) { .ch-bento { grid-template-columns:repeat(2,1fr); } .ch-t-radar { grid-column:1/-1; } .ch-t-str,.ch-t-dt { grid-column:span 2; } }
        @media (max-width:680px)  { .ch-bento { grid-template-columns:1fr; } .ch-t-hero,.ch-t-radar,.ch-t-enn,.ch-t-str,.ch-t-dt { grid-column:1/-1; } }
    </style>
</head>
<body>

    <!-- NAV BAR -->
    <nav class="kp-nav">
        <a class="kp-back" href="/user-profile-tests">‚Üê WR√ìƒÜ DO PROFILU</a>
        <div class="kp-logo">PSY<span>CH</span>ER</div>
        <button class="kp-share" onclick="copyShareUrl()">‚éò UDOSTƒòPNIJ</button>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="kp-main">
      <div class="ch-sheet-wrapper">

        <!-- STATUS BAR -->
        <div class="ch-topbar">
          <div style="display:flex;align-items:center;gap:10px;">
            <div class="ch-tb-pill"><div class="ch-tb-dot"></div><span id="ch-completion-pill">≈ÅADOWANIE PROFILU‚Ä¶</span></div>
          </div>
          <div class="ch-tb-meta" id="ch-footer-id-top">CHAR-ID: PSY----- ¬∑ PSYCHER v2.0</div>
        </div>

        <!-- BENTO GRID -->
        <div class="ch-bento">

          <!-- ‚îÄ‚îÄ T1: HERO CORE ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-hero">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#38b6ff,#7b5ea7,#d946ef);"></div>
            <div class="ch-tl">// IDENTYFIKACJA ¬∑ HERO CORE</div>

            <div style="display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:18px;">
              <div class="ch-av-wrap" style="position:relative;width:120px;height:120px;flex-shrink:0;">
                <svg class="ch-av-svg" viewBox="0 0 120 120" width="120" height="120" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <linearGradient id="chG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#38b6ff"/><stop offset="100%" stop-color="#7b5ea7"/></linearGradient>
                    <linearGradient id="chN" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#38b6ff" stop-opacity=".8"/><stop offset="100%" stop-color="#7b5ea7" stop-opacity=".8"/></linearGradient>
                    <linearGradient id="chSc" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="transparent"/><stop offset="25%" stop-color="#38b6ff" stop-opacity=".7"/><stop offset="75%" stop-color="#38b6ff" stop-opacity=".7"/><stop offset="100%" stop-color="transparent"/></linearGradient>
                    <linearGradient id="chBd" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#38b6ff" stop-opacity=".18"/><stop offset="100%" stop-color="#7b5ea7" stop-opacity=".03"/></linearGradient>
                    <filter id="chF" x="-45%" y="-45%" width="190%" height="190%"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                    <clipPath id="chC"><circle cx="60" cy="60" r="53"/></clipPath>
                  </defs>
                  <circle cx="60" cy="60" r="56" fill="#030014"/>
                  <image id="ch-avatar-img" href="" x="7" y="7" width="106" height="106" clip-path="url(#chC)" preserveAspectRatio="xMidYMid slice" style="display:none;"/>
                  <circle cx="60" cy="60" r="56" fill="none" stroke="url(#chG)" stroke-width=".8" stroke-dasharray="4 7" opacity=".4"/>
                  <circle cx="60" cy="60" r="54" fill="none" stroke="url(#chG)" stroke-width="1.6"/>
                  <path d="M60,18 C78,18 90,30 90,46 C90,57 85,65 78,70 L78,79 L42,79 L42,70 C35,65 30,57 30,46 C30,30 42,18 60,18Z" fill="url(#chBd)" stroke="url(#chG)" stroke-width="1.6" filter="url(#chF)" opacity=".5"/>
                  <rect class="ch-asc" x="6" y="59" width="108" height="2" fill="url(#chSc)" rx="1"/>
                  <line x1="60" y1="4" x2="60" y2="11" stroke="#38b6ff" stroke-width="2" stroke-linecap="round"/>
                  <line x1="60" y1="109" x2="60" y2="116" stroke="#38b6ff" stroke-width="2" stroke-linecap="round"/>
                  <line x1="4" y1="60" x2="11" y2="60" stroke="#38b6ff" stroke-width="2" stroke-linecap="round"/>
                  <line x1="109" y1="60" x2="116" y2="60" stroke="#38b6ff" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>

              <div style="width:100%;margin-top:14px;">
                <div class="ch-lvl"><div class="ch-ldot"></div><span id="ch-lvl-text">LVL 0 ¬∑ POCZƒÑTKUJƒÑCY</span></div>
                <div class="ch-cname" id="ch-cname">---</div>
                <div class="ch-carch" id="ch-carch">Profil w budowie</div>
                <div class="ch-ccodes" id="ch-ccodes">UZUPE≈ÅNIJ TESTY ¬∑ BRAK DANYCH</div>
                <div class="ch-rare" id="ch-rare">‚öô OBLICZANIE PROFILU</div>
              </div>
            </div>

            <div class="ch-xp-wrap" style="margin-bottom:18px;">
              <div class="ch-xp-lbl">
                <span style="color:rgba(255,255,255,.22)">PROFIL XP</span>
                <span style="color:rgba(56,182,255,.6)" id="ch-xp-label">0/7 TEST√ìW</span>
              </div>
              <div class="ch-xp-track"><div class="ch-xp-fill" id="ch-xp-fill" style="width:0%"></div></div>
            </div>

            <div class="ch-tl" style="margin-bottom:8px;">// ‚öî ARCHETYP RPG ¬∑ KLASA POSTACI</div>
            <div id="ch-rpg-content">
              <div class="ch-empty-block">
                <div class="ch-empty-icon">‚öî</div>
                <div class="ch-empty-text">Uko≈Ñcz test Enneagram aby odblokowaƒá sw√≥j archetyp RPG</div>
                <button class="ch-go-btn" onclick="goToTests()">Przejd≈∫ do test√≥w ‚Üí</button>
              </div>
            </div>

            <div class="ch-tl" style="margin-top:16px;margin-bottom:8px;">// üé¨ POSTACIE PODOBNE DO CIEBIE</div>
            <div id="ch-pop-content">
              <div class="ch-empty-block">
                <div class="ch-empty-icon">üé¨</div>
                <div class="ch-empty-text">Uko≈Ñcz test Enneagram aby zobaczyƒá postacie z kultury popularnej podobne do Ciebie</div>
                <button class="ch-go-btn" onclick="goToTests()">Przejd≈∫ do test√≥w ‚Üí</button>
              </div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ T2: HEXACO RADAR ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-radar" style="min-height:480px;">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#22d3ee,#38b6ff);"></div>
            <div class="ch-tl">// ATRYBUTY ¬∑ HEXACO-60</div>
            <div style="flex:1;min-height:0;display:flex;align-items:center;justify-content:center;">
              <svg id="ch-hex-radar" viewBox="0 0 300 300" width="100%" style="max-height:340px;" xmlns="http://www.w3.org/2000/svg" overflow="visible">
                <circle cx="150" cy="150" r="96" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                <circle cx="150" cy="150" r="72" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                <circle cx="150" cy="150" r="48" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                <circle cx="150" cy="150" r="24" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                <text x="150" y="154" text-anchor="middle" fill="rgba(56,182,255,.2)" font-family="Share Tech Mono,monospace" font-size="8">BRAK DANYCH</text>
              </svg>
            </div>
            <div id="ch-attr-grid" style="display:none;"></div>
            <div class="ch-hx-bars" id="ch-hx-bars" style="flex-shrink:0;margin-top:10px;padding-top:10px;border-top:1px solid rgba(56,182,255,.07);display:grid;grid-template-columns:repeat(2,1fr);gap:5px 20px;"></div>
            <div id="ch-hexaco-cta" style="margin-top:14px;text-align:center;">
              <button class="ch-go-btn" onclick="goToTests()">Wykonaj test HEXACO-60 aby odblokowaƒá ‚Üí</button>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ T3: ENNEAGRAM ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-enn" style="min-height:480px;">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#7b5ea7,#b08fff);"></div>
            <div class="ch-tl">// TYPOLOGIA ¬∑ ENNEAGRAM</div>
            <div style="flex:1;min-height:0;display:flex;align-items:center;justify-content:center;">
              <svg id="ch-enn-star" viewBox="0 0 200 200" width="100%" style="max-height:260px;" xmlns="http://www.w3.org/2000/svg">
                <circle cx="100" cy="100" r="88" fill="none" stroke="rgba(176,143,255,.07)" stroke-width="1.5"/>
                <text x="100" y="104" text-anchor="middle" fill="rgba(176,143,255,.28)" font-family="Share Tech Mono,monospace" font-size="8">BRAK DANYCH</text>
              </svg>
            </div>
            <div style="flex-shrink:0;text-align:center;margin-top:4px;margin-bottom:10px;">
              <div id="ch-enn-num" style="font-family:'Orbitron',monospace;font-size:2.4rem;font-weight:900;letter-spacing:2px;color:#b08fff;text-shadow:0 0 30px #b08fff88;line-height:1;">?</div>
              <div id="ch-enn-type" style="font-size:13px;font-weight:700;color:rgba(255,255,255,.8);letter-spacing:1px;margin-top:4px;">Nieznany typ</div>
              <div id="ch-enn-sub" style="font-family:'Share Tech Mono',monospace;font-size:7px;letter-spacing:2px;color:rgba(176,143,255,.35);margin-top:2px;text-transform:uppercase;">WYKONAJ TEST</div>
              <div id="ch-enn-desc" style="font-size:9px;color:rgba(255,255,255,.22);line-height:1.5;margin-top:6px;padding:0 4px;">Wykonaj test Enneagram aby odblokowaƒá typologiƒô motywacji.</div>
            </div>
            <div style="flex-shrink:0;border-top:1px solid rgba(176,143,255,.07);padding-top:8px;">
              <div style="display:flex;gap:6px;align-items:center;margin-bottom:6px;flex-wrap:wrap;">
                <div class="ch-hol-ltrs" id="ch-hol-ltrs" style="display:flex;gap:4px;">
                  <div class="ch-hl ch-hl-i">?</div><div class="ch-hl ch-hl-e">?</div><div class="ch-hl ch-hl-a">?</div>
                </div>
                <div class="ch-careers" id="ch-careers" style="flex:1;"><span class="ch-ct">WYKONAJ TEST KARIERY</span></div>
              </div>
              <div class="ch-val-chips" id="ch-val-chips" style="margin-bottom:6px;"><span class="ch-vc ch-vc4">Wykonaj test warto≈õci</span></div>
              <div id="ch-dt-summary" style="font-size:9px;color:rgba(255,255,255,.2);">Wykonaj test Dark Triad SD3 aby odblokowaƒá.</div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ T4: STRENGTHS ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-str">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#fbbf24,#34d399);"></div>
            <div class="ch-tl">// ‚ö° ARSENAL ¬∑ TOP TALENTY ¬∑ STRENGTHS</div>
            <div id="ch-str-content">
              <div class="ch-empty-block">
                <div class="ch-empty-icon">‚ö°</div>
                <div class="ch-empty-text">Wykonaj test Strengths aby odkryƒá swoje talenty</div>
                <button class="ch-go-btn" onclick="goToTests()">Przejd≈∫ do test√≥w ‚Üí</button>
              </div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ T5: DARK TRIAD / SHADOW ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-dt" style="border-color:rgba(239,68,68,.14);">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#ef4444,#f97316,#fbbf24);"></div>
            <div class="ch-tl" style="color:rgba(239,68,68,.45);">// ‚ö† CIEMNA TRIADA ¬∑ SD3 ¬∑ OBSZARY CIENIA</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div id="ch-dt-content">
                <div class="ch-empty-block">
                  <div class="ch-empty-icon">üåë</div>
                  <div class="ch-empty-text">Odblokuj test Dark Triad SD3 Premium aby zobaczyƒá analizƒô cienia</div>
                  <button class="ch-go-btn" onclick="goToTests()">Odblokuj Premium ‚Üí</button>
                </div>
              </div>
              <div id="ch-shadow-content">
                <div class="ch-empty-block">
                  <div class="ch-empty-icon">üåò</div>
                  <div class="ch-empty-text">Obszary cienia pojawiƒÖ siƒô po uko≈Ñczeniu test√≥w Dark Triad i HEXACO</div>
                </div>
              </div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ T6: AI SYNTHESIS ‚îÄ‚îÄ -->
          <div class="ch-tile ch-t-synth">
            <div class="ch-tile-accent" style="background:linear-gradient(90deg,#6366f1,#38b6ff,#7b5ea7,#34d399);"></div>
            <div class="ch-tl">// ü§ñ PSYCHER AI INSIGHT ¬∑ SYNTEZA ¬∑ PROFIL KOMPLETNY</div>
            <div id="ch-insight-content">
              <div class="ch-empty-block">
                <div class="ch-empty-icon">üîÆ</div>
                <div class="ch-empty-text">Synteza AI pojawi siƒô po uko≈Ñczeniu co najmniej 3 test√≥w</div>
                <button class="ch-go-btn" onclick="goToTests()">Uzupe≈Çnij profil ‚Üí</button>
              </div>
            </div>
          </div>

        </div><!-- /ch-bento -->

        <!-- TRAIT CHIPS -->
        <div style="margin-top:13px;" id="ch-traits-content"></div>

        <!-- FOOTER -->
        <div class="ch-footer" style="margin-top:13px;">
          <div class="ch-fid" id="ch-footer-id">CHAR-ID: PSY----- ¬∑ PSYCHER v2.0</div>
          <div class="ch-ftests">PSYCHER v2.0</div>
          <div class="ch-fver" id="ch-footer-date">BUILD DATE</div>
        </div>

      </div><!-- /ch-sheet-wrapper -->
    </main>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://uvzilorpyuqicuwkufky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2emlsb3JweXVxaWN1d2t1Zmt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNDQzNTAsImV4cCI6MjA4NjkyMDM1MH0.jNIkqASHNl_7WbLq0jBZ86kRDmRP2jzIbI-db9l9teA';
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Navigate back to tests
        window.goToTests = function() {
            window.location.href = '/user-profile-tests';
        };

        // Copy shareable URL to clipboard
        window.copyShareUrl = function() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const btn = document.querySelector('.kp-share');
                const orig = btn.textContent;
                btn.textContent = '‚úì SKOPIOWANO!';
                setTimeout(() => { btn.textContent = orig; }, 2000);
            }).catch(() => {
                prompt('Skopiuj link:', window.location.href);
            });
        };

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // LOAD CHARACTER CARD
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadCharacterCard() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                // Not logged in ‚Äî redirect to auth
                window.location.href = '/auth/login';
                return;
            }

            // ‚îÄ‚îÄ Name & ID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const userName = session.user.user_metadata?.full_name
                || session.user.email?.split('@')[0]
                || 'PSYCHER';
            document.getElementById('ch-cname').textContent = userName.toUpperCase().substring(0, 14);

            // ‚îÄ‚îÄ Avatar photo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const chAvatarUrl = session.user.user_metadata?.avatar_url || null;
            if (chAvatarUrl) {
                const chImg = document.getElementById('ch-avatar-img');
                chImg.setAttribute('href', chAvatarUrl);
                chImg.style.display = '';
            }
            const charHash = Math.abs(userName.split('').reduce((a,c) => a + c.charCodeAt(0), 0)) % 9000 + 1000;
            const charId = `PSY-${charHash}-PSYCHER`;
            document.getElementById('ch-footer-id').textContent = `CHAR-ID: ${charId} ¬∑ PSYCHER v2.0`;
            document.getElementById('ch-footer-id-top').textContent = `CHAR-ID: ${charId}`;
            document.getElementById('ch-footer-date').textContent =
                `BUILD ${new Date().toISOString().split('T')[0].replace(/-/g,'.')}`;

            // ‚îÄ‚îÄ Fetch all test results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const { data, error } = await supabase
                .from('user_psychometrics')
                .select('test_type, raw_scores, percentile_scores, completed_at')
                .eq('user_id', session.user.id)
                .in('test_type', ['HEXACO', 'ENNEAGRAM', 'DARK_TRIAD', 'STRENGTHS', 'CAREER', 'VALUES'])
                .order('completed_at', { ascending: false });

            if (error) { console.error('CC load error:', error); return; }

            const latest = {};
            (data || []).forEach(row => { if (!latest[row.test_type]) latest[row.test_type] = row; });

            const doneCount = Object.keys(latest).length;
            const xpPct = Math.round((doneCount / 7) * 100);

            // ‚îÄ‚îÄ XP & Level ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const xpFill = document.getElementById('ch-xp-fill');
            if (xpFill) xpFill.style.width = xpPct + '%';
            const xpLbl = document.getElementById('ch-xp-label');
            if (xpLbl) xpLbl.textContent = `${doneCount}/7 TEST√ìW`;
            const pillEl = document.getElementById('ch-completion-pill');
            if (pillEl) pillEl.textContent = doneCount === 7 ? 'PROFIL UKO≈ÉCZONY ¬∑ 7/7 TEST√ìW' : `PROFIL W BUDOWIE ¬∑ ${doneCount}/7`;
            const levels = ['POCZƒÑTKUJƒÑCY','ODKRYWCA','BADACZ','ANALITYK','PROFILER','SPECJALISTA','EKSPERT','MISTRZ'];
            const lvl = Math.min(doneCount, 7);
            const lvlEl = document.getElementById('ch-lvl-text');
            if (lvlEl) lvlEl.textContent = `LVL ${lvl} ¬∑ ${levels[lvl]}`;

            // Rarity
            const rares = [[100,'üíé TOP 1% POPULACJI'],[90,'‚ú® TOP 5% POPULACJI'],[80,'‚≠ê TOP 10% POPULACJI'],[60,'üîÆ PROFIL KOMPLETNY'],[0,'‚öô PROFIL W BUDOWIE']];
            const rarity = rares.find(r => xpPct >= r[0]);
            const rareEl = document.getElementById('ch-rare');
            if (rareEl) rareEl.textContent = rarity[1];

            // Trait chips accumulator
            const traitChips = [];

            // ‚îÄ‚îÄ HEXACO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (latest.HEXACO) {
                const raw = latest.HEXACO.raw_scores || {};
                const pct = latest.HEXACO.percentile_scores || {};
                const s = Object.keys(pct).length > 0 ? pct
                    : Object.fromEntries(Object.entries(raw).map(([k,v]) => [k, Math.round(((v-1)/4)*100)]));
                const traits = [
                    { key:'conscientiousness', label:'Sumienno≈õƒá',   color:'#34d399', cls:'ch-ag', en:'Conscientiousness',  grad:'#007a50,#34d399' },
                    { key:'openness',           label:'Otwarto≈õƒá',    color:'#38b6ff', cls:'ch-ac', en:'Openness',           grad:'#1a6aff,#38b6ff' },
                    { key:'agreeableness',      label:'Ugodowo≈õƒá',    color:'#b08fff', cls:'ch-av', en:'Agreeableness',      grad:'#4a28b0,#b08fff' },
                    { key:'honesty_humility',   label:'Szczero≈õƒá',    color:'#40e0d0', cls:'ch-at', en:'Honesty-Humility',   grad:'#006060,#40e0d0' },
                    { key:'extraversion',       label:'Ekstrawersja', color:'#e878e0', cls:'ch-ap', en:'Extraversion',       grad:'#7b1fa2,#e878e0' },
                    { key:'emotionality',       label:'Emocjonalno≈õƒá',color:'#f97316', cls:'ch-ao', en:'Emotionality',       grad:'#7a2000,#f97316' },
                ];
                const attrGrid = document.getElementById('ch-attr-grid');
                if (attrGrid) attrGrid.innerHTML = traits.map(t => {
                    const v = Math.round(s[t.key] ?? 50);
                    return `<div class="ch-attr-b ${t.cls}"><div class="ch-a-lbl">${t.label}</div><div class="ch-a-val">${v}</div><div class="ch-a-nm">${t.en}</div></div>`;
                }).join('');
                const hxBars = document.getElementById('ch-hx-bars');
                if (hxBars) hxBars.innerHTML = traits.map(t => {
                    const v = Math.round(s[t.key] ?? 50);
                    return `<div class="ch-hb"><div class="ch-hb-top"><span class="ch-hb-name">${t.label}</span><span class="ch-hb-val" style="color:${t.color}">${v}%</span></div><div class="ch-hb-track"><div class="ch-hb-fill" style="width:${v}%;background:linear-gradient(90deg,${t.grad});box-shadow:0 0 7px ${t.color}66;"></div></div></div>`;
                }).join('');
                const ctaEl = document.getElementById('ch-hexaco-cta');
                if (ctaEl) ctaEl.style.display = 'none';
                // Draw HEXACO Radar SVG
                (function drawHexRadar(hexS) {
                    const radarEl = document.getElementById('ch-hex-radar');
                    if (!radarEl) return;
                    const cx=150,cy=150,R=96,N=6;
                    const dims6=[
                        {key:'conscientiousness',lbl:'Sumienno≈õƒá',  col:'#34d399'},
                        {key:'openness',         lbl:'Otwarto≈õƒá',   col:'#38b6ff'},
                        {key:'agreeableness',    lbl:'Ugodowo≈õƒá',   col:'#b08fff'},
                        {key:'honesty_humility', lbl:'Szczero≈õƒá',   col:'#40e0d0'},
                        {key:'extraversion',     lbl:'Ekstra.',     col:'#e878e0'},
                        {key:'emotionality',     lbl:'Emocje',      col:'#f97316'},
                    ];
                    let svg='';
                    for(let i=0;i<N;i++){const a=(i/N)*2*Math.PI-Math.PI/2;svg+=`<line x1="${cx}" y1="${cy}" x2="${cx+R*Math.cos(a).toFixed(3)}" y2="${cy+R*Math.sin(a).toFixed(3)}" stroke="rgba(56,182,255,.1)" stroke-width="1"/>`;}
                    [0.25,0.5,0.75,1.0].forEach(r=>{svg+=`<circle cx="${cx}" cy="${cy}" r="${R*r}" fill="none" stroke="rgba(56,182,255,.07)" stroke-width="1"/>`;});
                    const pts=dims6.map((d,i)=>{const a=(i/N)*2*Math.PI-Math.PI/2;const r=R*(hexS[d.key]||0)/100;return `${(cx+r*Math.cos(a)).toFixed(2)},${(cy+r*Math.sin(a)).toFixed(2)}`;});
                    svg+=`<polygon points="${pts.join(' ')}" fill="rgba(34,211,238,.10)" stroke="#22d3ee" stroke-width="2" stroke-linejoin="round"/>`;
                    dims6.forEach((d,i)=>{
                        const a=(i/N)*2*Math.PI-Math.PI/2;
                        const r=R*(hexS[d.key]||0)/100;
                        const vx=(cx+r*Math.cos(a)).toFixed(2);const vy=(cy+r*Math.sin(a)).toFixed(2);
                        svg+=`<circle cx="${vx}" cy="${vy}" r="3.5" fill="${d.col}" opacity=".85"/>`;
                        const lr=R+16;const lx=(cx+lr*Math.cos(a)).toFixed(2);const ly=(cy+lr*Math.sin(a)).toFixed(2);
                        const anc=Math.cos(a)>0.15?'start':Math.cos(a)<-0.15?'end':'middle';
                        const val=Math.round(hexS[d.key]||0);
                        svg+=`<text x="${lx}" y="${(parseFloat(ly)-2).toFixed(1)}" text-anchor="${anc}" fill="${d.col}" font-family="Share Tech Mono,monospace" font-size="9" opacity=".8">${d.lbl}</text>`;
                        svg+=`<text x="${lx}" y="${(parseFloat(ly)+9).toFixed(1)}" text-anchor="${anc}" fill="${d.col}" font-family="Orbitron,monospace" font-size="9" font-weight="700">${val}</text>`;
                    });
                    radarEl.innerHTML=svg;
                })(s);
                // Derive archetype
                const con = s.conscientiousness ?? 50, opn = s.openness ?? 50, ext = s.extraversion ?? 50;
                let arch = 'Analityczny Badacz';
                if (con > 75 && opn > 65) arch = 'Strategiczny Innowator';
                else if (opn > 75) arch = 'Kreatywny Wizjoner';
                else if (con > 75) arch = 'Zdyscyplinowany Strateg';
                else if (ext > 70) arch = 'Charyzmatyczny Lider';
                else if (ext < 35) arch = 'G≈Çƒôboki My≈õliciel';
                const archEl = document.getElementById('ch-carch');
                if (archEl) archEl.textContent = arch;
                const codesEl = document.getElementById('ch-ccodes');
                if (codesEl) codesEl.textContent = `HEXACO-60 ¬∑ ${doneCount}/7 TEST√ìW`;
                if (con > 70) traitChips.push({label:'üìã Zdyscyplinowany', cls:'ch-ttg'});
                if (con > 80) traitChips.push({label:'üìê Perfekcjonista',   cls:'ch-ttw'});
                if (opn > 70) traitChips.push({label:'üí° Innowacyjny',     cls:'ch-ttt'});
                if (opn > 80) traitChips.push({label:'üîÆ Wzorce',          cls:'ch-ttc'});
                if (ext > 70) traitChips.push({label:'üé≠ Charyzmatyczny',  cls:'ch-ttp'});
                else if (ext < 35) traitChips.push({label:'üßò Introwertyczny', cls:'ch-ttv'});
                if ((s.agreeableness??50) > 70) traitChips.push({label:'ü§ù Empatyczny', cls:'ch-ttg'});
                if ((s.honesty_humility??50) > 70) traitChips.push({label:'‚öñ Etyczny', cls:'ch-ttc'});
            }

            // ‚îÄ‚îÄ ENNEAGRAM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const ENNLORE = {
                1: { rpg: 'PraworzƒÖdny Dobry Paladin',    epithet: 'Architekt PorzƒÖdku',    pop: ['Hermiona Granger', 'Ned Stark', 'Chidi (The Good Place)'] },
                2: { rpg: 'Kap≈Çan Wsparcia',              epithet: 'Stra≈ºnik Serc',         pop: ['Leslie Knope', 'Samwise Gamgee', 'Ted Lasso'] },
                3: { rpg: 'Bard Ambicji',                 epithet: 'Architekt Sukcesu',     pop: ['Tony Stark', 'Harvey Specter', 'Jay Gatsby'] },
                4: { rpg: 'Mroczny Artysta',              epithet: 'Dziecko Cienia',        pop: ['Joker (2019)', 'Severus Snape', 'Don Draper'] },
                5: { rpg: 'Mistrz Wiedzy Zakazanej',      epithet: 'Architekt Cienia',      pop: ['Sherlock Holmes', 'Dr House', 'Walter White'] },
                6: { rpg: 'Stra≈ºnik Bractwa',             epithet: 'Bastion Lojalno≈õci',    pop: ['Captain America', 'Ron Weasley', 'Samwise Gamgee'] },
                7: { rpg: 'Chaotyczny Dobry Awanturnik',  epithet: 'Wirtuoz Mo≈ºliwo≈õci',    pop: ['Jack Sparrow', 'Tyrion Lannister', 'The Mandalorian'] },
                8: { rpg: 'Warlord Wojenny',              epithet: 'Inkwizytor Woli',       pop: ['Walter White', 'Tony Soprano', 'Daenerys Targaryen'] },
                9: { rpg: 'Mnich Harmonii',               epithet: 'Spok√≥j w Oku Cyklonu',  pop: ['Frodo Baggins', 'Ted Lasso', 'The Dude (Big Lebowski)'] },
            };
            if (latest.ENNEAGRAM) {
                const s = latest.ENNEAGRAM.raw_scores || {};
                let topType = null, topScore = -1;
                for (const [k, v] of Object.entries(s)) { if (Number(v) > topScore) { topScore = Number(v); topType = k; } }
                if (topType) {
                    const ENAMES = {1:'Reformator',2:'Pomocnik',3:'OsiƒÖgacz',4:'Indywidualista',5:'Obserwator',6:'Lojalista',7:'Entuzjasta',8:'Przyw√≥dca',9:'Mediator'};
                    const EDESCS = {
                        1:'Kieruje siƒô zasadami, pragnie poprawiaƒá siebie i ≈õwiat. ≈öwiadomy kwestii etycznych.',
                        2:'Troszczy siƒô o innych i buduje relacje. Realizuje siƒô przez dawanie i wsparcie.',
                        3:'Zorientowany na cel i sukces. Adaptuje sw√≥j wizerunek, by osiƒÖgaƒá wyznaczone cele.',
                        4:'Szuka g≈Çƒôbokiej to≈ºsamo≈õci. Intensywnie prze≈ºywa emocje, pragnie autentyczno≈õci.',
                        5:'Gromadzi wiedzƒô i niezale≈ºno≈õƒá. Analizuje zanim dzia≈Ça, oddziela emocje od my≈õlenia.',
                        6:'Szuka bezpiecze≈Ñstwa i lojalno≈õci. Wysoka czujno≈õƒá wobec zagro≈ºe≈Ñ i sprzeczno≈õci.',
                        7:'Entuzjastyczny i optymistyczny. Szuka nowych do≈õwiadcze≈Ñ, unika b√≥lu i ogranicze≈Ñ.',
                        8:'Silny i zdecydowany. Chroni siebie i s≈Çabszych, nie unika konfrontacji.',
                        9:'DƒÖ≈ºy do harmonii i spokoju. Mediuje napiƒôcia, unika eskalacji konflikt√≥w.'
                    };
                    const ECOLS = ['#6366f1','#38b6ff','#fbbf24','#34d399','#b08fff','#f97316','#0ea5e9','#ef4444','#14b8a6'];
                    const ennCol = ECOLS[(parseInt(topType)-1) % ECOLS.length];
                    const ennNumEl = document.getElementById('ch-enn-num');
                    if (ennNumEl) { ennNumEl.textContent = topType; ennNumEl.style.color = ennCol; ennNumEl.style.textShadow = `0 0 22px ${ennCol}80`; }
                    const ennTypeEl = document.getElementById('ch-enn-type');
                    if (ennTypeEl) ennTypeEl.textContent = ENAMES[topType] || `Typ ${topType}`;
                    const ennSubEl = document.getElementById('ch-enn-sub');
                    if (ennSubEl) ennSubEl.textContent = `TYP ${topType} ¬∑ ENNEAGRAM`;
                    const ennDescEl = document.getElementById('ch-enn-desc');
                    if (ennDescEl) ennDescEl.textContent = EDESCS[topType] || '';
                    window._ch_ennName = ENAMES[topType] || `Typ ${topType}`;
                    traitChips.push({label:`üåÄ ${ENAMES[topType]||'Typ '+topType}`, cls:'ch-ttv'});
                    // Draw Enneagram Star SVG
                    (function drawEnnStar(tType, tCol) {
                        const starEl = document.getElementById('ch-enn-star');
                        if (!starEl) return;
                        const cx=100,cy=100,R=82,N=9;
                        const pt=i=>{const a=(i/N)*2*Math.PI-Math.PI/2;return[(cx+R*Math.cos(a)).toFixed(2),(cy+R*Math.sin(a)).toFixed(2)];};
                        let svg=`<circle cx="${cx}" cy="${cy}" r="${R}" fill="none" stroke="rgba(176,143,255,.08)" stroke-width="1.5"/>`;
                        svg+=`<circle cx="${cx}" cy="${cy}" r="${R*0.55}" fill="none" stroke="rgba(176,143,255,.05)" stroke-width="1"/>`;
                        [[1,4],[4,2],[2,8],[8,5],[5,7],[7,1],[3,6],[6,9],[9,3]].forEach(([a,b])=>{
                            const [x1,y1]=pt(a-1);const [x2,y2]=pt(b-1);
                            svg+=`<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="rgba(176,143,255,.12)" stroke-width="1"/>`;
                        });
                        for(let i=1;i<=9;i++){
                            const [x,y]=pt(i-1);const isActive=String(i)===String(tType);
                            const col=isActive?tCol:'rgba(255,255,255,.14)';
                            const r=isActive?9:5;
                            svg+=`<circle cx="${x}" cy="${y}" r="${r}" fill="${isActive?tCol+'22':'rgba(255,255,255,.03)'}" stroke="${col}" stroke-width="${isActive?2:1}"/>`;
                            if(isActive)svg+=`<circle cx="${x}" cy="${y}" r="${r+5}" fill="none" stroke="${tCol}" stroke-width=".7" opacity=".35"/>`;
                            svg+=`<text x="${x}" y="${(parseFloat(y)+4).toFixed(1)}" text-anchor="middle" fill="${isActive?tCol:'rgba(255,255,255,.35)'}" font-family="Orbitron,monospace" font-size="${isActive?9:7}" font-weight="${isActive?700:400}">${i}</text>`;
                        }
                        starEl.innerHTML=svg;
                    })(topType, ennCol);

                    // RPG Archetype
                    const lore = ENNLORE[parseInt(topType)];
                    if (lore) {
                        const ennCol2 = ECOLS[(parseInt(topType)-1) % ECOLS.length];
                        const rpgEl = document.getElementById('ch-rpg-content');
                        if (rpgEl) rpgEl.innerHTML = `
                            <div style="padding:4px 0 8px;">
                                <div style="font-family:'Orbitron',monospace;font-size:18px;font-weight:700;color:${ennCol2};text-shadow:0 0 20px ${ennCol2}66;letter-spacing:1px;margin-bottom:4px;">${lore.rpg}</div>
                                <div style="font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:2.5px;color:rgba(255,255,255,.35);text-transform:uppercase;margin-bottom:12px;">"${lore.epithet}"</div>
                                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                    <span style="display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:3px;background:rgba(56,182,255,.08);border:1px solid ${ennCol2}33;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;color:${ennCol2};">‚öî ${ENAMES[topType]||'Typ '+topType}</span>
                                    <span style="display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:3px;background:rgba(123,94,167,.1);border:1px solid rgba(123,94,167,.25);font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;color:#b08fff;">TYP ${topType} ¬∑ ENNEAGRAM</span>
                                </div>
                            </div>`;

                        const popEl = document.getElementById('ch-pop-content');
                        if (popEl && lore.pop.length > 0) popEl.innerHTML = `
                            <div style="margin-bottom:10px;font-size:10px;color:rgba(255,255,255,.35);line-height:1.6;">Na podstawie Twojego profilu Enneagram (Typ ${topType}) najbardziej przypominasz:</div>
                            <div style="display:flex;flex-direction:column;gap:7px;">${
                                lore.pop.map((char, i) => {
                                    const colors = ['#38b6ff','#b08fff','#34d399'];
                                    const col = colors[i % colors.length];
                                    const ranks = ['01','02','03'];
                                    return `<div style="display:flex;align-items:center;gap:10px;padding:8px 11px;border-radius:4px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);">
                                        <div style="font-family:'Orbitron',monospace;font-size:10px;font-weight:700;color:${col};min-width:22px;">${ranks[i]}</div>
                                        <div style="flex:1;font-size:12px;font-weight:600;color:rgba(255,255,255,.85);">${char}</div>
                                        <div style="font-family:'Share Tech Mono',monospace;font-size:8px;letter-spacing:1.5px;color:${col}88;">${Math.round(95 - i * 8)}% MATCH</div>
                                    </div>`;
                                }).join('')
                            }</div>
                            <div style="margin-top:10px;padding:8px 11px;border-radius:3px;background:rgba(56,182,255,.04);border:1px solid rgba(56,182,255,.12);font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:1.5px;color:rgba(56,182,255,.45);">
                                DOPASOWANIE NA PODSTAWIE: ENNEAGRAM TYPE ${topType} ¬∑ ${ENAMES[topType]||''}
                            </div>`;
                    }
                }
            }

            // ‚îÄ‚îÄ CAREER (RIASEC) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (latest.CAREER) {
                const s = latest.CAREER.raw_scores || {};
                const code = s.holland_code || '???';
                const top3 = (s.top_3 || []).slice(0,3);
                const clsMap = ['ch-hl-i','ch-hl-e','ch-hl-a'];
                const holLtrs = document.getElementById('ch-hol-ltrs');
                if (holLtrs) holLtrs.innerHTML = [...code].slice(0,3).map((l,i) =>
                    `<div class="ch-hl ${clsMap[i]||'ch-hl-i'}">${l}</div>`).join('');
                const careersEl = document.getElementById('ch-careers');
                if (careersEl && top3.length > 0) careersEl.innerHTML = top3.map(t =>
                    `<span class="ch-ct">${(t.name||t.letter||'?').split(' ')[0].toUpperCase()}</span>`).join('');
            }

            // ‚îÄ‚îÄ VALUES (Schwartz PVQ-40) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (latest.VALUES) {
                const s = latest.VALUES.raw_scores || {};
                const top3 = (s.top_3 || []).slice(0,3);
                const vcClasses = ['ch-vc1','ch-vc2','ch-vc3','ch-vc4'];
                const valEl = document.getElementById('ch-val-chips');
                if (valEl && top3.length > 0) valEl.innerHTML = top3.map((v,i) =>
                    `<span class="ch-vc ${vcClasses[i%vcClasses.length]}">${v.name||v.id||'?'}</span>`).join('');
            }

            // ‚îÄ‚îÄ DARK TRIAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (latest.DARK_TRIAD) {
                const s = latest.DARK_TRIAD.raw_scores || {};
                const dtDims = s.dimensions || {};
                const toV = raw => raw <= 5 ? Math.round(((raw - 1) / 4) * 100) : Math.round(raw);
                const getRaw = (k) => dtDims[k]?.raw_score ?? dtDims[k.charAt(0).toUpperCase()+k.slice(1)]?.raw_score ?? 0;
                const dtDefs = [
                    { key:'psychopathy',      label:'Psychopatia',  ico:'‚ö°', color:'#ef4444', grad:'#6b0012,#e8001c,#ff2d55', tags:['tolerancja ryzyka','impulsywno≈õƒá','brak empatii'] },
                    { key:'machiavellianism', label:'Makiawelizm',  ico:'üé≠', color:'#f97316', grad:'#7a1a00,#ff6230,#ff9060',  tags:['my≈õlenie strategiczne','cynizm','manipulacja'] },
                    { key:'narcissism',       label:'Narcyzm',      ico:'üëë', color:'#fbbf24', grad:'#7a4000,#ffaa00,#ffd060',  tags:['charyzma','potrzeba uznania','wyjƒÖtkowo≈õƒá'] },
                ];
                const pPct = toV(getRaw('psychopathy')), mPct = toV(getRaw('machiavellianism')), nPct = toV(getRaw('narcissism'));
                const avgDT = Math.round((pPct + mPct + nPct) / 3);
                const dtSumEl = document.getElementById('ch-dt-summary');
                if (dtSumEl) {
                    const dtCol = avgDT > 70 ? '#ef4444' : avgDT > 50 ? '#f97316' : '#34d399';
                    dtSumEl.innerHTML = `<span style="color:${dtCol};font-weight:700;font-family:'Orbitron',monospace;font-size:13px;">${avgDT}%</span> ≈õr. ¬∑ Ps: ${pPct}% / Mach: ${mPct}% / Narc: ${nPct}%`;
                }
                const dtContentEl = document.getElementById('ch-dt-content');
                if (dtContentEl) {
                    dtContentEl.innerHTML = `<div class="ch-dt-bars">` + dtDefs.map(t => {
                        const raw = getRaw(t.key);
                        const pct = toV(raw);
                        const displayVal = raw <= 5 ? raw.toFixed(2) : raw;
                        const maxLabel = raw <= 5 ? '/5' : '%';
                        return `<div class="ch-dt-row">
                            <div class="ch-dt-head">
                                <div class="ch-dt-name" style="color:${t.color}">${t.ico} ${t.label}</div>
                                <div class="ch-dt-sw">
                                    <div class="ch-dt-sc" style="color:${t.color}">${displayVal}</div>
                                    <div class="ch-dt-mx">${maxLabel}</div>
                                    <div class="ch-dt-pc" style="color:${t.color}88">&nbsp;${pct}%</div>
                                </div>
                            </div>
                            <div class="ch-dt-track"><div class="ch-dt-fill" style="width:${pct}%;background:linear-gradient(90deg,${t.grad});box-shadow:0 0 12px ${t.color}88;"></div></div>
                            <div class="ch-dt-tags">${t.tags.map(tag=>`<span class="ch-dtag">${tag}</span>`).join('')}</div>
                        </div>`;
                    }).join('') + `</div>
                    <div style="margin-top:10px;padding:9px 11px;border-radius:3px;background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.16);">
                        <div style="font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:1.5px;color:rgba(239,68,68,.55);margin-bottom:3px;">‚ö† ALERT SYSTEMOWY</div>
                        <div style="font-size:10px;color:rgba(255,255,255,.35);line-height:1.55;">${avgDT > 60 ? 'Podwy≈ºszona Ciemna Triada. Rozwa≈º ≈õwiadome zarzƒÖdzanie relacjami.' : 'Wyniki mieszczƒÖ siƒô w normie populacyjnej.'}</div>
                    </div>`;
                }
                const shadows = [];
                if (pPct > 60) shadows.push({ ico:'‚ö°', title:`Impulsywno≈õƒá i ryzyko [PSYCHOPATIA ${pPct}%]`, desc:'Silna tendencja do ryzykownych decyzji bez pe≈Çnej analizy konsekwencji.' });
                if (mPct > 60) shadows.push({ ico:'üé≠', title:`Manipulacyjno≈õƒá w relacjach [MAKIAWELIZM ${mPct}%]`, desc:'Sk≈Çonno≈õƒá do instrumentalnego traktowania innych.' });
                if (nPct > 70) shadows.push({ ico:'üëë', title:`Nadmierne ego [NARCYZM ${nPct}%]`, desc:'Silna potrzeba podziwu i uznania.' });
                if (shadows.length > 0) {
                    const shadowEl = document.getElementById('ch-shadow-content');
                    if (shadowEl) shadowEl.innerHTML = `<div class="ch-sh-list">` + shadows.map(sh =>
                        `<div class="ch-sh-item"><div class="ch-shico">${sh.ico}</div><div class="ch-shbd"><div class="ch-shtt">${sh.title}</div><div class="ch-sht">${sh.desc}</div></div></div>`
                    ).join('') + `</div>`;
                }
                if (mPct > 60) traitChips.push({label:'‚ôü Strategiczny', cls:'ch-ttc'});
                if (pPct > 60) traitChips.push({label:'‚ö° Risk taker',  cls:'ch-tto'});
                if (nPct > 60) traitChips.push({label:'üëÅ Pewny siebie', cls:'ch-ttp'});
            }

            // ‚îÄ‚îÄ STRENGTHS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (latest.STRENGTHS) {
                const s = latest.STRENGTHS.raw_scores || {};
                const top5 = (s.top_5 || []).slice(0, 5);
                const CAT_COLORS = { strategic_thinking:'#34d399', executing:'#b08fff', influencing:'#fbbf24', relationship_building:'#60a5fa' };
                if (top5.length > 0) {
                    const domCat = top5.reduce((acc, t) => { acc[t.category] = (acc[t.category]||0)+1; return acc; }, {});
                    const topCat = Object.entries(domCat).sort((a,b)=>b[1]-a[1])[0]?.[0];
                    const strEl = document.getElementById('ch-str-content');
                    if (strEl) strEl.innerHTML = `<div class="ch-str-list">` +
                        top5.map((t,i) => {
                            const col = CAT_COLORS[t.category] || '#38b6ff';
                            return `<div class="ch-str-item">
                                <div class="ch-srk">0${i+1}</div>
                                <div class="ch-sinf"><div class="ch-snm">${t.name||t.name_en||'?'}</div><div class="ch-sct">${(t.category||'').replace(/_/g,' ').toUpperCase()}</div></div>
                                <div class="ch-sbar"><div class="ch-sbf" style="width:${95-i*7}%;background:linear-gradient(90deg,#3d2a9e,${col});"></div></div>
                            </div>`;
                        }).join('') + `</div>` +
                        (topCat ? `<div style="margin-top:11px;padding:9px 11px;border-radius:4px;background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.13);">
                            <div style="font-size:11px;font-weight:700;color:${CAT_COLORS[topCat]||'#38b6ff'};margin-bottom:2px;">${topCat.replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase())} Dominuje</div>
                            <div style="font-size:9px;color:rgba(255,255,255,.35);">${domCat[topCat]}/${top5.length} talent√≥w w klastrze</div>
                        </div>` : '') +
                        `<button class="ch-go-btn" onclick="window.location.href='/test/strengths/results'" style="margin-top:10px;">Zobacz pe≈Çne wyniki ‚Üí</button>`;
                    top5.slice(0,3).forEach(t => traitChips.push({label:`‚≠ê ${t.name||t.name_en||'?'}`, cls:'ch-ttg'}));
                }
            }

            // ‚îÄ‚îÄ TRAIT CHIPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (traitChips.length > 0) {
                const traitsEl = document.getElementById('ch-traits-content');
                if (traitsEl) traitsEl.innerHTML = `<div class="ch-tflow">${traitChips.map(t => `<span class="ch-tt ${t.cls}">${t.label}</span>`).join('')}</div>`;
            }

            // ‚îÄ‚îÄ AI INSIGHT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (doneCount >= 3) {
                const insights = [];
                if (latest.HEXACO && latest.STRENGTHS) {
                    const s = latest.HEXACO.raw_scores || {};
                    const con = s.conscientiousness??50, opn = s.openness??50;
                    insights.push({ color:'#38b6ff', title:'PROFIL ZAWODOWY',
                        text:`Kombinacja <strong>HEXACO + Strengths</strong> wskazuje na profil ${opn>70?'innowatora i architekta system√≥w':con>70?'doskona≈Çego wykonawcy i lidera':'wszechstronnego specjalisty'} ‚Äî osoby zdolnej do syntezy wiedzy i przek≈Çadania jej na efekty.`
                    });
                }
                if (latest.DARK_TRIAD) {
                    const s2 = latest.DARK_TRIAD.raw_scores || {};
                    const dtDims2 = s2.dimensions || {};
                    const toV2 = raw => raw <= 5 ? Math.round(((raw - 1) / 4) * 100) : Math.round(raw);
                    const getR = k => dtDims2[k]?.raw_score ?? dtDims2[k.charAt(0).toUpperCase()+k.slice(1)]?.raw_score ?? 0;
                    const pP2 = toV2(getR('psychopathy')), mP2 = toV2(getR('machiavellianism'));
                    if (pP2 > 60 || mP2 > 60) insights.push({ color:'#ef4444', title:'PUNKT KRYTYCZNY',
                        text:`Podwy≈ºszona Ciemna Triada (<strong>Psychopatia ${pP2}% + Makiawelizm ${mP2}%</strong>) w po≈ÇƒÖczeniu z analitycznym profilem tworzy osobƒô o wyjƒÖtkowej skuteczno≈õci. ≈öwiadome zarzƒÖdzanie relacjami jest kluczem.`
                    });
                }
                if (latest.ENNEAGRAM && window._ch_ennName) insights.push({ color:'#b08fff', title:'≈öCIE≈ªKA ROZWOJU',
                    text:`Enneagram <strong>${window._ch_ennName}</strong> wskazuje specyficznƒÖ ≈õcie≈ºkƒô wzrostu. Zrozumienie w≈Çasnych mechanizm√≥w obronnych to klucz do pe≈Çnego potencja≈Çu.`
                });
                if (insights.length > 0) {
                    const insightEl = document.getElementById('ch-insight-content');
                    if (insightEl) insightEl.innerHTML = insights.map(ins => {
                        const rgb = ins.color === '#38b6ff' ? '56,182,255' : ins.color === '#ef4444' ? '239,68,68' : '176,143,255';
                        return `<div class="ch-iblk" style="background:rgba(${rgb},.04);border:1px solid rgba(${rgb},.12);">
                            <div class="ch-ib-hd" style="color:rgba(${rgb},.65)">${ins.title}</div>
                            <div class="ch-ib-tx">${ins.text}</div>
                        </div>`;
                    }).join('');
                }
            }
        }

        // Auto-load on page ready
        document.addEventListener('DOMContentLoaded', loadCharacterCard);
    </script>

</body>
</html>
