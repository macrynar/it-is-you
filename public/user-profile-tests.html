<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psycher - Testy Psychometryczne</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-deep':         '#030014',
                        'bg-surface':      '#0f0728',
                        'neon-primary':    '#7000ff',
                        'neon-cyan':       '#00f0ff',
                        'neon-pink':       '#ff005c',
                        'brand-primary':   '#7000ff',
                        'brand-secondary': '#00f0ff',
                        'brand-accent':    '#ff005c',
                        'bg-main':         '#030014',
                        'status-success':  '#10b981',
                        'status-danger':   '#ff005c',
                        'text-main':       '#f8fafc',
                        'text-muted':      '#94a3b8',
                    },
                    boxShadow: {
                        'glow-primary':    '0 0 20px -5px rgba(112,0,255,0.5)',
                        'glow-primary-lg': '0 0 40px -5px rgba(112,0,255,0.6)',
                        'glow-cyan':       '0 0 20px -5px rgba(0,240,255,0.5)',
                        'glow-pink':       '0 0 20px -5px rgba(255,0,92,0.5)',
                        'glow-danger':     '0 0 20px -5px rgba(255,0,92,0.5)',
                    },
                    backgroundImage: {
                        'neural-gradient': 'radial-gradient(circle at 50% 0%, #2a1b5e 0%, transparent 60%), radial-gradient(circle at 100% 0%, #1a0b38 0%, transparent 40%)',
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes blink {
            0%, 90%, 100% { opacity: 1; transform: scale(1); }
            95% { opacity: 0.3; transform: scale(0.5); }
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3), 0 0 40px rgba(139, 92, 246, 0.1); }
            50% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 60px rgba(139, 92, 246, 0.2); }
        }
        
        :root {
            --bg-deep:      #030014;
            --bg-surface:   #0f0728;
            --neon-primary: #7000ff;
            --neon-cyan:    #00f0ff;
            --neon-pink:    #ff005c;
            --glass-border: rgba(255,255,255,0.08);
            --glass-shine:  rgba(255,255,255,0.10);
        }

        body {
            background-color: var(--bg-deep);
            background-image:
                radial-gradient(circle at 50% 0%, #2a1b5e 0%, transparent 60%),
                radial-gradient(circle at 100% 0%, #1a0b38 0%, transparent 40%),
                radial-gradient(circle at 0% 80%, #0d0626 0%, transparent 50%);
            background-attachment: fixed;
        }
        
        .grid-bg {
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        /* Neural Glass 2.0 — card-neural & glass-card alias */
        .card-neural, .glass-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, rgba(20,10,40,0.75) 0%, rgba(10,5,20,0.45) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 24px -1px rgba(0,0,0,0.35), inset 0 1px 0 0 var(--glass-shine);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        }

        .card-neural::before, .glass-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(112,0,255,0.04) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .card-neural:hover, .glass-card:hover {
            border-color: rgba(112, 0, 255, 0.35);
            box-shadow:
                0 0 40px -8px rgba(112,0,255,0.22),
                0 8px 32px -8px rgba(0,0,0,0.4),
                inset 0 1px 0 0 rgba(255,255,255,0.18);
            transform: translateY(-3px);
        }

        /* Test-specific hover accents */
        .glass-card.test-hexaco:hover,
        .glass-card.test-strengths:hover,
        .glass-card.test-career:hover,
        .glass-card.test-values:hover {
            border-color: rgba(112, 0, 255, 0.4);
            box-shadow: 0 0 40px -8px rgba(112,0,255,0.3), inset 0 1px 0 0 rgba(255,255,255,0.18);
        }

        .glass-card.test-enneagram:hover {
            border-color: rgba(0, 240, 255, 0.35);
            box-shadow: 0 0 40px -8px rgba(0,240,255,0.25), inset 0 1px 0 0 rgba(255,255,255,0.18);
        }

        .glass-card.test-dark-triad:hover {
            border-color: rgba(255, 0, 92, 0.35);
            box-shadow: 0 0 40px -8px rgba(255,0,92,0.25), inset 0 1px 0 0 rgba(255,255,255,0.18);
        }

        .glass-card-active { /* default state is clean */ }

        .glass-card-locked {
            opacity: 0.55;
            position: relative;
        }

        .glass-card-locked::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(4px);
            border-radius: 1rem;
            pointer-events: none;
        }

        .glass-card-locked:hover {
            transform: none;
            border-color: var(--glass-border);
            box-shadow: none;
        }
        
        .neon-badge {
            background: rgba(100,116,139,0.12);
            border: 1px solid rgba(100,116,139,0.2);
            color: #94a3b8;
            font-size: 0.6rem;
            padding: 0.2rem 0.65rem;
            border-radius: 0.35rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.07em;
        }

        .neon-badge-success {
            background: rgba(16,185,129,0.12);
            border: 1px solid rgba(16,185,129,0.25);
            color: #6ee7b7;
        }
        
        .brand-font {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            letter-spacing: -0.02em;
        }
        
        .card-icon-wrapper {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.07);
            transition: all 0.3s ease;
        }

        .glass-card:hover .card-icon-wrapper,
        .card-neural:hover .card-icon-wrapper {
            background: rgba(112,0,255,0.12);
            border-color: rgba(112,0,255,0.3);
        }
        
        /* Theme Toggle Animation */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 32px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: rgba(15, 7, 40, 0.9);
            border-color: rgba(112, 0, 255, 0.5);
        }

        .theme-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #7000ff, #00f0ff);
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(112, 0, 255, 0.5);
        }
        
        .theme-toggle.light .theme-toggle-slider {
            transform: translateX(28px);
            background: linear-gradient(135deg, #F59E0B, #EAB308);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
        }
        
        .theme-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            transition: opacity 0.3s ease;
        }
        
        .theme-icon-moon {
            left: 8px;
            opacity: 1;
        }
        
        .theme-icon-sun {
            right: 8px;
            opacity: 0.4;
        }
        
        .theme-toggle.light .theme-icon-moon {
            opacity: 0.4;
        }
        
        .theme-toggle.light .theme-icon-sun {
            opacity: 1;
        }
        
        /* Light Mode Styles */
        body.light-mode {
            background: #F8FAFC;
            background-image: 
                radial-gradient(at 50% 0%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
            color: #0F172A;
        }
        
        body.light-mode .grid-bg {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.02) 1px, transparent 1px);
        }
        
        body.light-mode nav {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(0, 0, 0, 0.1);
        }
        
        body.light-mode .glass-card {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(0, 0, 0, 0.1);
            color: #0F172A;
        }
        
        body.light-mode .glass-card:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        body.light-mode .text-white {
            color: #0F172A !important;
        }
        
        body.light-mode .text-slate-300,
        body.light-mode .text-slate-400 {
            color: #475569 !important;
        }
        
        body.light-mode .text-slate-500 {
            color: #64748B !important;
        }
        
        body.light-mode .text-slate-600 {
            color: #475569 !important;
        }
        
        body.light-mode .bg-slate-800\/50,
        body.light-mode .bg-slate-900\/40 {
            background: rgba(241, 245, 249, 0.8) !important;
        }
        
        body.light-mode .border-white\/10,
        body.light-mode .border-slate-700 {
            border-color: rgba(0, 0, 0, 0.1) !important;
        }
        
        body.light-mode .bg-black\/30 {
            background: rgba(255, 255, 255, 0.8) !important;
        }

        /* Neural Glass 2.0 — btn-neural (CDN Tailwind doesn't know this class) */
        .btn-neural {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            color: #fff;
            background: linear-gradient(90deg, #5b21b6 0%, #7c3aed 100%);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 0 20px -5px rgba(124,58,237,0.55), inset 0 1px 0 0 rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.25s ease;
            white-space: nowrap;
            text-decoration: none;
        }
        .btn-neural:hover {
            background: linear-gradient(90deg, #6d28d9 0%, #8b5cf6 100%);
            box-shadow: 0 0 35px -5px rgba(124,58,237,0.75), inset 0 1px 0 0 rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }
        .btn-neural:active { transform: translateY(0); }

        /* ════════════════════════════════════
           IIY MODULE CARDS
        ════════════════════════════════════ */
        .iiy-modules {
          padding: 0 0 60px;
          font-family: 'Space Grotesk', sans-serif;
        }
        .iiy-modules-header {
          display: flex;
          align-items: center;
          gap: 14px;
          margin-bottom: 28px;
        }
        .iiy-modules-title {
          font-size: 11px;
          font-weight: 600;
          letter-spacing: 3px;
          text-transform: uppercase;
          color: rgba(255,255,255,0.4);
          white-space: nowrap;
        }
        .iiy-modules-header::after {
          content: '';
          flex: 1;
          height: 1px;
          background: linear-gradient(90deg, rgba(56,182,255,0.25), transparent);
        }
        .iiy-modules-count {
          font-size: 11px;
          letter-spacing: 2px;
          color: rgba(56,182,255,0.5);
          white-space: nowrap;
        }
        .iiy-cards-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 20px;
        }
        @media (max-width: 1024px) { .iiy-cards-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 640px)  { .iiy-cards-grid { grid-template-columns: 1fr; } }

        /* CARD BASE */
        .iiy-card {
          position: relative;
          border-radius: 16px;
          padding: 24px;
          display: flex;
          flex-direction: column;
          overflow: hidden;
          isolation: isolate;
          cursor: pointer;
          transition: transform 0.3s cubic-bezier(.22,.68,0,1.15), box-shadow 0.3s ease;
          background: rgba(16, 20, 56, 0.6);
          backdrop-filter: blur(24px) saturate(180%);
          -webkit-backdrop-filter: blur(24px) saturate(180%);
          box-shadow:
            inset 0 1px 0 rgba(255,255,255,0.1),
            inset 0 -1px 0 rgba(255,255,255,0.04),
            0 0 0 1px rgba(255,255,255,0.07),
            0 8px 32px -4px rgba(0,0,0,0.6),
            0 2px 8px -2px rgba(0,0,0,0.4);
        }
        .iiy-card::before {
          content: '';
          position: absolute;
          inset: 0;
          border-radius: 16px;
          padding: 1px;
          background: linear-gradient(145deg, rgba(255,255,255,0.18) 0%, rgba(56,182,255,0.2) 30%, rgba(123,94,167,0.15) 65%, rgba(255,255,255,0.04) 100%);
          -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
          -webkit-mask-composite: xor;
          mask-composite: exclude;
          pointer-events: none;
          transition: opacity 0.3s ease;
        }
        .iiy-card::after {
          content: '';
          position: absolute;
          width: 200px; height: 200px;
          border-radius: 50%;
          filter: blur(60px);
          pointer-events: none;
          z-index: -1;
          transition: opacity 0.4s ease, transform 0.4s ease;
          opacity: 0.18;
          bottom: -60px; right: -40px;
        }
        .iiy-card:hover { transform: translateY(-6px) scale(1.01); }
        .iiy-card:hover::after { opacity: 0.35; transform: scale(1.15); }
        .iiy-card:hover .iiy-card-glow { opacity: 1; }

        /* ACCENT COLORS */
        .iiy-card.cyan::after { background: #38b6ff; }
        .iiy-card.cyan:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(56,182,255,0.35), 0 0 30px -4px rgba(56,182,255,0.3), 0 0 60px -8px rgba(56,182,255,0.15), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.cyan .iiy-card-icon-wrap  { background: rgba(56,182,255,0.15); border-color: rgba(56,182,255,0.3); }
        .iiy-card.cyan .iiy-card-icon       { color: #38b6ff; }
        .iiy-card.cyan .iiy-card-tag        { color: #38b6ff; border-color: rgba(56,182,255,0.35); background: rgba(56,182,255,0.1); }
        .iiy-card.cyan .iiy-card-meta       { color: rgba(56,182,255,0.6); }

        .iiy-card.violet::after { background: #7b5ea7; }
        .iiy-card.violet:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(123,94,167,0.4), 0 0 30px -4px rgba(123,94,167,0.3), 0 0 60px -8px rgba(123,94,167,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.violet .iiy-card-icon-wrap { background: rgba(123,94,167,0.18); border-color: rgba(123,94,167,0.35); }
        .iiy-card.violet .iiy-card-icon      { color: #b08fff; }
        .iiy-card.violet .iiy-card-tag       { color: #b08fff; border-color: rgba(123,94,167,0.4); background: rgba(123,94,167,0.12); }
        .iiy-card.violet .iiy-card-meta      { color: rgba(160,120,255,0.6); }

        .iiy-card.pink::after { background: #c850c0; }
        .iiy-card.pink:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(200,80,192,0.4), 0 0 30px -4px rgba(200,80,192,0.3), 0 0 60px -8px rgba(200,80,192,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.pink .iiy-card-icon-wrap { background: rgba(200,80,192,0.15); border-color: rgba(200,80,192,0.3); }
        .iiy-card.pink .iiy-card-icon      { color: #e878e0; }
        .iiy-card.pink .iiy-card-tag       { color: #e878e0; border-color: rgba(200,80,192,0.35); background: rgba(200,80,192,0.1); }
        .iiy-card.pink .iiy-card-meta      { color: rgba(220,100,210,0.6); }

        /* fuchsia — Enneagram */
        .iiy-card.fuchsia::after { background: #d946ef; }
        .iiy-card.fuchsia:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(217,70,239,0.4), 0 0 30px -4px rgba(217,70,239,0.3), 0 0 60px -8px rgba(217,70,239,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.fuchsia .iiy-card-icon-wrap { background: rgba(217,70,239,0.15); border-color: rgba(217,70,239,0.3); }
        .iiy-card.fuchsia .iiy-card-icon      { color: #e879f9; }
        .iiy-card.fuchsia .iiy-card-tag       { color: #e879f9; border-color: rgba(217,70,239,0.35); background: rgba(217,70,239,0.1); }
        .iiy-card.fuchsia .iiy-card-meta      { color: rgba(232,121,249,0.6); }
        .iiy-card.fuchsia .iiy-card-methodology { color: rgba(232,121,249,0.8); }

        /* rose — Dark Triad */
        .iiy-card.rose::after { background: #f43f5e; }
        .iiy-card.rose:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(244,63,94,0.4), 0 0 30px -4px rgba(244,63,94,0.3), 0 0 60px -8px rgba(244,63,94,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.rose .iiy-card-icon-wrap { background: rgba(244,63,94,0.15); border-color: rgba(244,63,94,0.3); }
        .iiy-card.rose .iiy-card-icon      { color: #fb7185; }
        .iiy-card.rose .iiy-card-tag       { color: #fb7185; border-color: rgba(244,63,94,0.35); background: rgba(244,63,94,0.1); }
        .iiy-card.rose .iiy-card-meta      { color: rgba(251,113,133,0.6); }
        .iiy-card.rose .iiy-card-methodology { color: rgba(251,113,133,0.8); }
        .iiy-card.rose .iiy-badge-premium  { color: #fb7185; background: rgba(244,63,94,0.1); border-color: rgba(244,63,94,0.35); box-shadow: 0 0 10px -2px rgba(244,63,94,0.4); }

        /* amber — Mocne Strony */
        .iiy-card.amber::after { background: #f59e0b; }
        .iiy-card.amber:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(245,158,11,0.4), 0 0 30px -4px rgba(245,158,11,0.3), 0 0 60px -8px rgba(245,158,11,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.amber .iiy-card-icon-wrap { background: rgba(245,158,11,0.15); border-color: rgba(245,158,11,0.3); }
        .iiy-card.amber .iiy-card-icon      { color: #fbbf24; }
        .iiy-card.amber .iiy-card-tag       { color: #fbbf24; border-color: rgba(245,158,11,0.35); background: rgba(245,158,11,0.1); }
        .iiy-card.amber .iiy-card-meta      { color: rgba(251,191,36,0.6); }
        .iiy-card.amber .iiy-card-methodology { color: rgba(251,191,36,0.8); }

        /* emerald — Kariera */
        .iiy-card.emerald::after { background: #10b981; }
        .iiy-card.emerald:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(16,185,129,0.4), 0 0 30px -4px rgba(16,185,129,0.3), 0 0 60px -8px rgba(16,185,129,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.emerald .iiy-card-icon-wrap { background: rgba(16,185,129,0.15); border-color: rgba(16,185,129,0.3); }
        .iiy-card.emerald .iiy-card-icon      { color: #34d399; }
        .iiy-card.emerald .iiy-card-tag       { color: #34d399; border-color: rgba(16,185,129,0.35); background: rgba(16,185,129,0.1); }
        .iiy-card.emerald .iiy-card-meta      { color: rgba(52,211,153,0.6); }
        .iiy-card.emerald .iiy-card-methodology { color: rgba(52,211,153,0.8); }

        /* teal — Wartości */
        .iiy-card.teal::after { background: #14b8a6; }
        .iiy-card.teal:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 0 0 1px rgba(20,184,166,0.4), 0 0 30px -4px rgba(20,184,166,0.3), 0 0 60px -8px rgba(20,184,166,0.18), 0 16px 48px -6px rgba(0,0,0,0.7); }
        .iiy-card.teal .iiy-card-icon-wrap { background: rgba(20,184,166,0.15); border-color: rgba(20,184,166,0.3); }
        .iiy-card.teal .iiy-card-icon      { color: #2dd4bf; }
        .iiy-card.teal .iiy-card-tag       { color: #2dd4bf; border-color: rgba(20,184,166,0.35); background: rgba(20,184,166,0.1); }
        .iiy-card.teal .iiy-card-meta      { color: rgba(45,212,191,0.6); }
        .iiy-card.teal .iiy-card-methodology { color: rgba(45,212,191,0.8); }

        /* GLOW LINE */
        .iiy-card-glow {
          position: absolute; bottom: 0; left: 20%; right: 20%; height: 1px;
          border-radius: 100px; pointer-events: none; opacity: 0; transition: opacity 0.3s ease;
        }
        .cyan     .iiy-card-glow { background: #38b6ff;  box-shadow: 0 0 12px 3px rgba(56,182,255,0.6); }
        .violet   .iiy-card-glow { background: #b08fff;  box-shadow: 0 0 12px 3px rgba(123,94,167,0.7); }
        .pink     .iiy-card-glow { background: #e878e0;  box-shadow: 0 0 12px 3px rgba(200,80,192,0.7); }
        .fuchsia  .iiy-card-glow { background: #e879f9;  box-shadow: 0 0 12px 3px rgba(217,70,239,0.7); }
        .rose     .iiy-card-glow { background: #fb7185;  box-shadow: 0 0 12px 3px rgba(244,63,94,0.7); }
        .amber    .iiy-card-glow { background: #fbbf24;  box-shadow: 0 0 12px 3px rgba(245,158,11,0.6); }
        .emerald  .iiy-card-glow { background: #34d399;  box-shadow: 0 0 12px 3px rgba(16,185,129,0.6); }
        .teal     .iiy-card-glow { background: #2dd4bf;  box-shadow: 0 0 12px 3px rgba(20,184,166,0.6); }

        /* TOP ROW */
        .iiy-card-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .iiy-card-icon-wrap {
          width: 44px; height: 44px; border-radius: 12px; border: 1px solid;
          display: flex; align-items: center; justify-content: center;
          transition: transform 0.3s ease; flex-shrink: 0;
        }
        .iiy-card:hover .iiy-card-icon-wrap { transform: scale(1.08) rotate(-3deg); }
        .iiy-card-icon { font-size: 18px; line-height: 1; display: flex; }
        .iiy-card-tag {
          font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
          text-transform: uppercase; padding: 5px 11px; border-radius: 100px; border: 1px solid;
        }

        /* BODY */
        .iiy-card-title { font-size: 20px; font-weight: 700; color: #fff; letter-spacing: -0.3px; margin-bottom: 6px; transition: text-shadow 0.3s ease; }
        .iiy-card:hover .iiy-card-title { text-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .iiy-card-methodology { font-size: 10px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 6px; }
        .iiy-card.cyan .iiy-card-methodology   { color: rgba(56,182,255,0.8); }
        .iiy-card.violet .iiy-card-methodology { color: rgba(160,120,255,0.8); }
        .iiy-card.pink .iiy-card-methodology   { color: rgba(220,100,210,0.8); }
        .iiy-card-desc { font-size: 13px; color: rgba(255,255,255,0.45); margin-bottom: 20px; line-height: 1.5; }

        /* META */
        .iiy-card-meta { display: flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 500; margin-bottom: 20px; }
        .iiy-card-meta-dot { width: 3px; height: 3px; border-radius: 50%; background: currentColor; opacity: 0.5; }

        /* PROGRESS */
        .iiy-card-progress { margin-bottom: 20px; }
        .iiy-card-progress-track { height: 3px; border-radius: 100px; background: rgba(255,255,255,0.08); overflow: hidden; margin-bottom: 6px; }
        .iiy-card-progress-fill { height: 100%; border-radius: 100px; background: linear-gradient(90deg, #38b6ff, #7b5ea7); box-shadow: 0 0 8px rgba(56,182,255,0.5); position: relative; transition: width 0.8s ease; }
        .iiy-card-progress-fill::after { content: ''; position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 6px; height: 6px; border-radius: 50%; background: #fff; box-shadow: 0 0 6px rgba(56,182,255,0.8); }
        .iiy-card-progress-fill.zero::after { display: none; }
        .iiy-card-progress-label { font-size: 10px; color: rgba(255,255,255,0.3); text-align: right; }

        /* DIVIDER */
        .iiy-card-divider { height: 1px; background: rgba(255,255,255,0.07); margin: 0 -24px 20px; }

        /* CTA BUTTON */
        .iiy-card-btn {
          margin-top: auto; width: 100%; padding: 13px 24px; border-radius: 10px; border: none;
          cursor: pointer; font-family: 'Space Grotesk', sans-serif; font-size: 13px; font-weight: 600;
          letter-spacing: 0.5px; text-transform: uppercase;
          display: flex; align-items: center; justify-content: center; gap: 8px;
          transition: transform 0.2s cubic-bezier(.22,.68,0,1.2), box-shadow 0.25s ease, background 0.25s ease;
          position: relative; overflow: hidden;
        }
        .iiy-card-btn::after { content: ''; position: absolute; top: 0; left: -80%; width: 45%; height: 100%; background: linear-gradient(115deg, transparent, rgba(255,255,255,0.12), transparent); transition: left 0.5s ease; }
        .iiy-card-btn:hover::after { left: 140%; }
        .iiy-card-btn.ghost { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.55); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1); }
        .iiy-card-btn.ghost:hover { background: rgba(255,255,255,0.09); color: rgba(255,255,255,0.8); transform: translateY(-1px); }
        .iiy-card-btn.primary { background: linear-gradient(110deg, #3d2a9e 0%, #6a3fd4 50%, #38b6ff 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(56,182,255,0.2), 0 0 20px -2px rgba(56,182,255,0.25), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(56,182,255,0.5), 0 0 24px -2px rgba(56,182,255,0.4), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-pink    { background: linear-gradient(110deg, #7b1fa2 0%, #c850c0 50%, #ff6b9d 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(200,80,192,0.25), 0 0 20px -2px rgba(200,80,192,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-pink:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(200,80,192,0.6), 0 0 28px -2px rgba(200,80,192,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-fuchsia { background: linear-gradient(110deg, #7c1f8a 0%, #d946ef 55%, #e879f9 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(217,70,239,0.25), 0 0 20px -2px rgba(217,70,239,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-fuchsia:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(217,70,239,0.6), 0 0 28px -2px rgba(217,70,239,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-rose    { background: linear-gradient(110deg, #9f1239 0%, #f43f5e 55%, #fb7185 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(244,63,94,0.3), 0 0 20px -2px rgba(244,63,94,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-rose:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(244,63,94,0.6), 0 0 28px -2px rgba(244,63,94,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-amber   { background: linear-gradient(110deg, #92400e 0%, #d97706 55%, #fbbf24 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(245,158,11,0.3), 0 0 20px -2px rgba(245,158,11,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-amber:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(245,158,11,0.6), 0 0 28px -2px rgba(245,158,11,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-emerald { background: linear-gradient(110deg, #064e3b 0%, #059669 55%, #34d399 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(16,185,129,0.25), 0 0 20px -2px rgba(16,185,129,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-emerald:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(16,185,129,0.6), 0 0 28px -2px rgba(16,185,129,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        .iiy-card-btn.primary-teal    { background: linear-gradient(110deg, #134e4a 0%, #0d9488 55%, #2dd4bf 100%); color: #fff; box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 0 0 1px rgba(20,184,166,0.25), 0 0 20px -2px rgba(20,184,166,0.3), 0 4px 16px -2px rgba(0,0,0,0.5); }
        .iiy-card-btn.primary-teal:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25), 0 0 0 1px rgba(20,184,166,0.6), 0 0 28px -2px rgba(20,184,166,0.5), 0 8px 24px -4px rgba(0,0,0,0.6); }
        /* Premium lock button — purple-golden gradient */
        .iiy-card-btn.premium-lock {
          background: linear-gradient(110deg, #4f22a0 0%, #7c3aed 40%, #d97706 100%);
          color: #fff;
          box-shadow: inset 0 1px 0 rgba(255,255,255,0.18),
                      0 0 0 1px rgba(245,158,11,0.3),
                      0 0 22px -4px rgba(245,158,11,0.35),
                      0 4px 16px -2px rgba(0,0,0,0.5);
        }
        .iiy-card-btn.premium-lock:hover {
          transform: translateY(-2px);
          box-shadow: inset 0 1px 0 rgba(255,255,255,0.25),
                      0 0 0 1px rgba(245,158,11,0.55),
                      0 0 30px -4px rgba(245,158,11,0.5),
                      0 8px 24px -4px rgba(0,0,0,0.6);
        }
        /* Small PREMIUM badge inside the Dark Triad card top */
        .iiy-badge-premium {
          font-size: 9px; font-weight: 800; letter-spacing: 1.4px; text-transform: uppercase;
          padding: 3px 10px; border-radius: 999px;
          color: #fbbf24;
          background: rgba(245,158,11,0.12);
          border: 1px solid rgba(245,158,11,0.4);
          box-shadow: 0 0 10px -2px rgba(245,158,11,0.4);
          white-space: nowrap;
        }
        .iiy-card-btn-arrow { font-size: 16px; transition: transform 0.2s ease; }
        .iiy-card-btn:hover .iiy-card-btn-arrow { transform: translateX(4px); }

        /* ── iiy-logo ── */
        .iiy-logo, .iiy-logo * { box-sizing: border-box; margin: 0; padding: 0; }
        .iiy-logo { display: inline-flex; align-items: center; gap: 20px; text-decoration: none; user-select: none; }
        .iiy-logo .iiy-signet svg { display: block; width: 80px; height: 80px; }
        .iiy-logo .iiy-wordmark { display: flex; flex-direction: column; }
        .iiy-logo .iiy-title { font-family: 'Orbitron', monospace; font-weight: 900; font-size: 34px; letter-spacing: 12px; line-height: 1; text-transform: uppercase; background: linear-gradient(160deg, #ffffff 0%, #a8c8ff 35%, #38b6ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; filter: drop-shadow(0 0 16px rgba(56,182,255,0.45)); animation: iiy-glitch 9s infinite; }
        @keyframes iiy-glitch { 0%, 87%, 100% { transform: none; filter: drop-shadow(0 0 16px rgba(56,182,255,0.45)); } 88% { transform: translate(-2px,0) skewX(-2deg); filter: drop-shadow(-3px 0 #7b5ea7) drop-shadow(3px 0 #38b6ff); } 89% { transform: translate(2px,0); filter: drop-shadow(3px 0 #7b5ea7) drop-shadow(-3px 0 #38b6ff); } 90% { transform: none; filter: drop-shadow(0 0 16px rgba(56,182,255,0.45)); } }
        .iiy-logo .iiy-divider { height: 1px; margin: 6px 0 5px; background: linear-gradient(90deg, #38b6ff 0%, #7b5ea7 55%, transparent 100%); opacity: 0.8; }
        .iiy-logo .iiy-sub { font-family: 'Share Tech Mono', monospace; font-size: 8.5px; letter-spacing: 3.5px; color: rgba(100,160,230,0.5); text-transform: uppercase; }
        .iiy-ring-ticks { animation: iiy-spin 20s linear infinite; transform-origin: 48px 48px; }
        @keyframes iiy-spin { to { transform: rotate(360deg); } }
        .iiy-eye-l { animation: iiy-eye 3.5s ease-in-out infinite; }
        .iiy-eye-r { animation: iiy-eye 3.5s ease-in-out infinite 0.2s; }
        @keyframes iiy-eye { 0%, 70%, 100% { opacity: 1; } 76% { opacity: 0.05; } }
        .iiy-scan { animation: iiy-scan 2.8s ease-in-out infinite; }
        @keyframes iiy-scan { 0% { transform: translateY(-22px); opacity: 0; } 8% { opacity: 0.55; } 92% { opacity: 0.55; } 100% { transform: translateY(22px); opacity: 0; } }
        .iiy-core { animation: iiy-pulse 2.2s ease-in-out infinite; transform-origin: 48px 61px; }
        @keyframes iiy-pulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.9); opacity: 1; } }
        .iiy-logo.iiy-sm { gap: 14px; }
        .iiy-logo.iiy-sm .iiy-signet svg { width: 44px; height: 44px; }
        .iiy-logo.iiy-sm .iiy-title { font-size: 19px; letter-spacing: 7px; }
        .iiy-logo.iiy-sm .iiy-sub { font-size: 7px; letter-spacing: 2.5px; }
        .iiy-logo.iiy-sm .iiy-divider { margin: 4px 0 3px; }

        /* ── Nav Tabs ─────────────────────────────────────────── */
        .iiy-nav-tabs {
            display: flex;
            align-items: center;
            gap: 2px;
            background: rgba(255,255,255,.04);
            border: 1px solid rgba(255,255,255,.07);
            border-radius: 12px;
            padding: 4px;
        }
        .iiy-tab-btn {
            padding: 8px 20px;
            border-radius: 9px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,.45);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
            letter-spacing: .2px;
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            white-space: nowrap;
        }
        .iiy-tab-btn:hover { color: rgba(255,255,255,.8); background: rgba(255,255,255,.05); }
        .iiy-tab-btn.active {
            background: linear-gradient(135deg, rgba(99,102,241,.3), rgba(56,182,255,.2));
            color: #fff;
            box-shadow: inset 0 1px 0 rgba(255,255,255,.12), 0 0 0 1px rgba(99,102,241,.3);
        }
        /* ── Character Card ───────────────────────────────────── */
        .cc-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        @media (max-width: 900px) { .cc-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 560px) { .cc-grid { grid-template-columns: 1fr; } }
        .cc-card {
            border-radius: 18px;
            position: relative;
            overflow: hidden;
            background: rgba(15,23,42,.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,.08);
            padding: 20px;
            transition: transform .25s, box-shadow .25s;
        }
        .cc-card:hover { transform: translateY(-4px); }
        .cc-card.cc-done { border-color: rgba(56,182,255,.22); }
        .cc-card.cc-done:hover { box-shadow: 0 0 0 1px rgba(56,182,255,.3), 0 0 28px -6px rgba(56,182,255,.2), 0 12px 32px -6px rgba(0,0,0,.5); }
        .cc-card.cc-empty { opacity: .55; }
        .cc-card-label { font-size: 9px; font-weight: 700; letter-spacing: 1.4px; text-transform: uppercase; margin-bottom: 6px; }
        .cc-card-title { font-size: 17px; font-weight: 700; color: #fff; margin-bottom: 14px; }
        .cc-mini-bar-track { height: 4px; background: rgba(255,255,255,.07); border-radius: 100px; overflow: hidden; margin-bottom: 3px; }
        .cc-mini-bar-fill { height: 100%; border-radius: 100px; }
        .cc-row-label { font-size: 10px; color: rgba(255,255,255,.38); margin-bottom: 2px; }
        .cc-big-val { font-size: 2.6rem; font-weight: 900; line-height: 1; }
        .cc-chip { display: inline-flex; align-items: center; gap: 4px; padding: 3px 9px; border-radius: 100px; font-size: .68rem; font-weight: 600; margin: 2px; }
        .cc-empty-icon { font-size: 2rem; margin-bottom: 8px; opacity: .4; }
        .cc-empty-text { font-size: .78rem; color: rgba(255,255,255,.3); }
        .cc-go-btn {
            display: inline-block;
            margin-top: 12px;
            padding: 7px 14px;
            border-radius: 8px;
            border: 1px solid rgba(99,102,241,.4);
            background: rgba(99,102,241,.12);
            color: #a5b4fc;
            font-size: .75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
            font-family: inherit;
        }
        .cc-go-btn:hover { background: rgba(99,102,241,.22); color: #fff; }

        /* ═══════════════════════════════════════════════
           KARTA POSTACI — CHARACTER SHEET (ch-*)
        ═══════════════════════════════════════════════ */
        .ch-sheet-wrapper { font-family: 'Space Grotesk', sans-serif; padding-bottom: 48px; }
        /* Top status bar */
        .ch-topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; padding:9px 16px; background:rgba(8,14,40,.72); border:1px solid rgba(56,182,255,.10); border-radius:8px; backdrop-filter:blur(14px); flex-wrap:wrap; gap:8px; }
        .ch-tb-pill { display:inline-flex; align-items:center; gap:7px; padding:4px 12px; border-radius:3px; background:rgba(52,211,153,.07); border:1px solid rgba(52,211,153,.22); font-family:'Share Tech Mono',monospace; font-size:9.5px; letter-spacing:2px; color:#34d399; }
        .ch-tb-dot { width:5px; height:5px; border-radius:50%; background:#34d399; box-shadow:0 0 8px #34d399; animation:ch-blink 1.8s ease-in-out infinite; }
        @keyframes ch-blink { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.5)} }
        .ch-tb-meta { font-family:'Share Tech Mono',monospace; font-size:8.5px; color:rgba(56,182,255,.28); letter-spacing:2px; text-align:right; line-height:1.9; }
        /* Panel base */
        .ch-panel { background:rgba(8,14,38,.84); backdrop-filter:blur(28px) saturate(160%); -webkit-backdrop-filter:blur(28px) saturate(160%); border:1px solid rgba(56,182,255,.11); border-radius:6px; position:relative; overflow:hidden; }
        .ch-panel::before,.ch-panel::after { content:''; position:absolute; width:13px; height:13px; border-color:#38b6ff; border-style:solid; opacity:.38; pointer-events:none; }
        .ch-panel::before { top:0; left:0; border-width:1.5px 0 0 1.5px; }
        .ch-panel::after  { bottom:0; right:0; border-width:0 1.5px 1.5px 0; }
        .ch-pi { padding:18px 20px; }
        .ch-pl { font-family:'Share Tech Mono',monospace; font-size:8.5px; letter-spacing:3px; color:rgba(56,182,255,.40); margin-bottom:14px; display:flex; align-items:center; gap:9px; }
        .ch-pl::after { content:''; flex:1; height:1px; background:linear-gradient(90deg,rgba(56,182,255,.18),transparent); }
        /* HERO layout */
        .ch-hero { display:grid; grid-template-columns:232px 1fr 252px; gap:13px; margin-bottom:13px; }
        @media (max-width:1100px) { .ch-hero { grid-template-columns:1fr 1fr; } .ch-type-panel{grid-column:1/-1;} }
        @media (max-width:680px)  { .ch-hero { grid-template-columns:1fr; } }
        /* Avatar panel */
        .ch-av-panel .ch-pi { display:flex; flex-direction:column; align-items:center; text-align:center; padding:22px 16px 18px; }
        .ch-av-wrap { position:relative; width:118px; height:118px; margin-bottom:15px; }
        .ch-av-svg { width:118px; height:118px; }
        .ch-sp  { animation:ch-sp  24s linear infinite; transform-origin:60px 60px; }
        .ch-spr { animation:ch-spr 16s linear infinite; transform-origin:60px 60px; }
        @keyframes ch-sp  { to{transform:rotate(360deg)}  }
        @keyframes ch-spr { to{transform:rotate(-360deg)} }
        .ch-asc { animation:ch-asc 3.4s ease-in-out infinite; }
        @keyframes ch-asc { 0%{transform:translateY(-33px);opacity:0} 6%{opacity:.6} 94%{opacity:.6} 100%{transform:translateY(33px);opacity:0} }
        .ch-an { animation:ch-an 2.6s ease-in-out infinite; }
        .ch-an:nth-child(2n){animation-delay:.5s} .ch-an:nth-child(3n){animation-delay:1s} .ch-an:nth-child(4n){animation-delay:1.5s} .ch-an:nth-child(5n){animation-delay:.8s}
        @keyframes ch-an { 0%,100%{opacity:.22} 50%{opacity:1} }
        .ch-al { animation:ch-al 2.6s ease-in-out infinite; }
        .ch-al:nth-child(2n){animation-delay:.4s} .ch-al:nth-child(3n){animation-delay:.9s} .ch-al:nth-child(4n){animation-delay:1.4s}
        @keyframes ch-al { 0%,100%{opacity:.06} 50%{opacity:.58} }
        .ch-lvl { display:inline-flex; align-items:center; gap:6px; padding:4px 11px; border-radius:2px; background:linear-gradient(110deg,rgba(99,102,241,.14),rgba(56,182,255,.11)); border:1px solid rgba(99,102,241,.28); font-family:'Share Tech Mono',monospace; font-size:9px; letter-spacing:2px; color:#a5b4fc; margin-bottom:11px; }
        .ch-ldot { width:4px; height:4px; border-radius:50%; background:#a5b4fc; box-shadow:0 0 6px #a5b4fc; }
        .ch-cname { font-family:'Orbitron',monospace; font-size:17px; font-weight:900; letter-spacing:2.5px; text-transform:uppercase; color:#fff; margin-bottom:4px; text-shadow:0 0 18px rgba(56,182,255,.22); word-break:break-all; }
        .ch-carch { font-family:'Share Tech Mono',monospace; font-size:10px; letter-spacing:2px; color:#38b6ff; text-shadow:0 0 10px rgba(56,182,255,.4); margin-bottom:3px; }
        .ch-ccodes { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:1.5px; color:rgba(255,255,255,.22); margin-bottom:11px; }
        .ch-rare { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:2px; background:rgba(176,143,255,.07); border:1px solid rgba(176,143,255,.2); font-family:'Share Tech Mono',monospace; font-size:8.5px; letter-spacing:1.5px; color:#b08fff; margin-bottom:13px; }
        .ch-dvd { width:100%; height:1px; background:linear-gradient(90deg,transparent,rgba(56,182,255,.14),transparent); margin:10px 0; }
        .ch-xp-wrap { width:100%; }
        .ch-xp-lbl { display:flex; justify-content:space-between; margin-bottom:4px; font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:1.5px; }
        .ch-xp-track { height:4px; background:rgba(255,255,255,.05); border-radius:2px; overflow:visible; position:relative; }
        .ch-xp-fill { height:100%; border-radius:2px; background:linear-gradient(90deg,#3d2a9e,#38b6ff); box-shadow:0 0 10px rgba(56,182,255,.5); position:relative; transition:width 1s ease-out; }
        .ch-xp-fill::after { content:''; position:absolute; right:-1px; top:50%; transform:translateY(-50%); width:8px; height:8px; border-radius:50%; background:#fff; box-shadow:0 0 8px rgba(56,182,255,.8); }
        /* Attribute grid (HEXACO) */
        .ch-attr-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:16px; }
        .ch-attr-b { padding:10px 9px; border-radius:4px; position:relative; overflow:hidden; cursor:default; transition:transform .22s; }
        .ch-attr-b:hover { transform:translateY(-2px); }
        .ch-attr-b::before { content:''; position:absolute; inset:0; background:linear-gradient(160deg,rgba(255,255,255,.04) 0%,transparent 60%); pointer-events:none; }
        .ch-a-lbl { font-family:'Share Tech Mono',monospace; font-size:7px; letter-spacing:1.5px; color:rgba(255,255,255,.26); margin-bottom:2px; text-transform:uppercase; }
        .ch-a-val { font-family:'Orbitron',monospace; font-size:25px; font-weight:700; line-height:1; margin-bottom:1px; }
        .ch-a-nm  { font-size:8px; font-weight:600; color:rgba(255,255,255,.28); }
        .ch-ag { background:rgba(0,229,160,.07);   border:1px solid rgba(0,229,160,.18);   } .ch-ag .ch-a-val{color:#34d399;text-shadow:0 0 12px rgba(0,229,160,.4);}   .ch-ag:hover{box-shadow:0 0 16px -4px rgba(0,229,160,.25);}
        .ch-ac { background:rgba(56,182,255,.07);  border:1px solid rgba(56,182,255,.18);  } .ch-ac .ch-a-val{color:#38b6ff;text-shadow:0 0 12px rgba(56,182,255,.45);}  .ch-ac:hover{box-shadow:0 0 16px -4px rgba(56,182,255,.25);}
        .ch-av { background:rgba(176,143,255,.07); border:1px solid rgba(176,143,255,.18); } .ch-av .ch-a-val{color:#b08fff;text-shadow:0 0 12px rgba(176,143,255,.4);}  .ch-av:hover{box-shadow:0 0 16px -4px rgba(176,143,255,.2);}
        .ch-at { background:rgba(64,224,208,.07);  border:1px solid rgba(64,224,208,.18);  } .ch-at .ch-a-val{color:#40e0d0;text-shadow:0 0 12px rgba(64,224,208,.38);} .ch-at:hover{box-shadow:0 0 16px -4px rgba(64,224,208,.18);}
        .ch-ap { background:rgba(232,120,224,.07); border:1px solid rgba(232,120,224,.18); } .ch-ap .ch-a-val{color:#e878e0;text-shadow:0 0 12px rgba(232,120,224,.35);}  .ch-ap:hover{box-shadow:0 0 16px -4px rgba(232,120,224,.18);}
        .ch-ao { background:rgba(249,115,22,.07);  border:1px solid rgba(249,115,22,.18);  } .ch-ao .ch-a-val{color:#f97316;text-shadow:0 0 12px rgba(249,115,22,.35);}  .ch-ao:hover{box-shadow:0 0 16px -4px rgba(249,115,22,.18);}
        /* HEXACO detail bars */
        .ch-hx-bars { display:grid; grid-template-columns:1fr 1fr; gap:6px 20px; }
        .ch-hb { display:flex; flex-direction:column; gap:4px; }
        .ch-hb-top { display:flex; justify-content:space-between; align-items:center; }
        .ch-hb-name { font-size:10px; font-weight:600; color:rgba(255,255,255,.44); }
        .ch-hb-val  { font-family:'Share Tech Mono',monospace; font-size:10px; font-weight:700; }
        .ch-hb-track { height:4px; background:rgba(255,255,255,.06); border-radius:100px; overflow:hidden; }
        .ch-hb-fill  { height:100%; border-radius:100px; }
        /* Typology panel */
        .ch-type-panel .ch-pi { display:flex; flex-direction:column; gap:10px; }
        .ch-arch-blk { border-radius:4px; padding:12px 13px; }
        .ch-arch-lbl { font-family:'Share Tech Mono',monospace; font-size:7.5px; letter-spacing:2.5px; color:rgba(255,255,255,.22); margin-bottom:6px; text-transform:uppercase; }
        .ch-enn-blk { background:rgba(56,182,255,.05);   border:1px solid rgba(56,182,255,.13);  }
        .ch-hol-blk { background:rgba(123,94,167,.06);   border:1px solid rgba(123,94,167,.15);  }
        .ch-val-blk { background:rgba(245,158,11,.04);   border:1px solid rgba(245,158,11,.13);  }
        .ch-cog-blk { background:rgba(255,255,255,.025); border:1px solid rgba(255,255,255,.07); }
        .ch-enn-row  { display:flex; align-items:center; gap:10px; margin-bottom:6px; }
        .ch-enn-num  { font-family:'Orbitron',monospace; font-size:38px; font-weight:900; color:#38b6ff; text-shadow:0 0 22px rgba(56,182,255,.5); line-height:1; }
        .ch-enn-type { font-size:13px; font-weight:700; color:rgba(255,255,255,.85); }
        .ch-enn-sub  { font-family:'Share Tech Mono',monospace; font-size:7.5px; color:rgba(255,255,255,.25); letter-spacing:1px; margin-top:2px; }
        .ch-enn-desc { font-size:10px; color:rgba(255,255,255,.38); line-height:1.6; }
        .ch-hol-ltrs { display:flex; gap:5px; margin-bottom:8px; }
        .ch-hl       { font-family:'Orbitron',monospace; font-size:15px; font-weight:700; width:29px; height:29px; border-radius:3px; display:flex; align-items:center; justify-content:center; }
        .ch-hl-i     { background:rgba(56,182,255,.12);  color:#38b6ff; border:1px solid rgba(56,182,255,.28); }
        .ch-hl-e     { background:rgba(0,229,160,.10);   color:#34d399; border:1px solid rgba(0,229,160,.24); }
        .ch-hl-a     { background:rgba(232,120,224,.10); color:#e878e0; border:1px solid rgba(232,120,224,.24);}
        .ch-careers  { display:flex; flex-wrap:wrap; gap:4px; }
        .ch-ct       { font-family:'Share Tech Mono',monospace; font-size:7.5px; padding:3px 7px; border-radius:2px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); color:rgba(255,255,255,.38); }
        .ch-val-chips { display:flex; flex-wrap:wrap; gap:4px; }
        .ch-vc  { font-size:9.5px; font-weight:600; padding:3px 8px; border-radius:2px; }
        .ch-vc1 { background:rgba(56,182,255,.09);  border:1px solid rgba(56,182,255,.22);  color:#38b6ff; }
        .ch-vc2 { background:rgba(0,229,160,.07);   border:1px solid rgba(0,229,160,.2);    color:#34d399; }
        .ch-vc3 { background:rgba(245,158,11,.08);  border:1px solid rgba(245,158,11,.2);   color:#f59e0b; }
        .ch-vc4 { background:rgba(176,143,255,.08); border:1px solid rgba(176,143,255,.2);  color:#b08fff; }
        /* MID row */
        .ch-mid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:13px; margin-bottom:13px; }
        @media (max-width:900px) { .ch-mid { grid-template-columns:1fr 1fr; } }
        @media (max-width:600px) { .ch-mid { grid-template-columns:1fr; } }
        /* Dark Triad panel */
        .ch-dt-panel { border-color:rgba(239,68,68,.15) !important; }
        .ch-dt-panel::before { border-color:rgba(239,68,68,.42); }
        .ch-dt-panel::after  { border-color:rgba(239,68,68,.42); }
        .ch-dt-bars  { display:flex; flex-direction:column; gap:14px; }
        .ch-dt-row   { display:flex; flex-direction:column; gap:5px; }
        .ch-dt-head  { display:flex; align-items:center; justify-content:space-between; }
        .ch-dt-name  { display:flex; align-items:center; gap:7px; font-size:12.5px; font-weight:700; }
        .ch-dt-sw    { display:flex; align-items:baseline; gap:2px; }
        .ch-dt-sc    { font-family:'Orbitron',monospace; font-size:18px; font-weight:700; }
        .ch-dt-mx    { font-family:'Share Tech Mono',monospace; font-size:8px; color:rgba(255,255,255,.28); }
        .ch-dt-pc    { font-family:'Share Tech Mono',monospace; font-size:8px; }
        .ch-dt-track { height:9px; border-radius:2px; background:rgba(255,255,255,.04); overflow:hidden; }
        .ch-dt-fill  { height:100%; border-radius:2px; transition:width 1s ease-out; }
        .ch-dt-tags  { display:flex; flex-wrap:wrap; gap:3px; }
        .ch-dtag     { font-family:'Share Tech Mono',monospace; font-size:7px; letter-spacing:.5px; padding:2px 6px; border-radius:2px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); color:rgba(255,255,255,.3); }
        /* Strengths panel */
        .ch-str-list { display:flex; flex-direction:column; gap:6px; }
        .ch-str-item { display:flex; align-items:center; gap:8px; padding:7px 10px; border-radius:4px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07); transition:background .2s,border-color .2s,transform .18s; }
        .ch-str-item:hover { background:rgba(56,182,255,.05); border-color:rgba(56,182,255,.18); transform:translateX(3px); }
        .ch-srk { font-family:'Share Tech Mono',monospace; font-size:9px; color:rgba(255,255,255,.18); width:14px; flex-shrink:0; text-align:center; }
        .ch-sinf { flex:1; }
        .ch-snm  { font-size:11px; font-weight:700; color:rgba(255,255,255,.78); }
        .ch-sct  { font-family:'Share Tech Mono',monospace; font-size:7px; color:rgba(255,255,255,.27); }
        .ch-sbar { width:30px; height:3px; background:rgba(255,255,255,.06); border-radius:100px; flex-shrink:0; overflow:hidden; }
        .ch-sbf  { height:100%; border-radius:100px; }
        /* Trait chips */
        .ch-tflow { display:flex; flex-wrap:wrap; gap:6px; }
        .ch-tt  { display:flex; align-items:center; gap:4px; padding:4px 10px; border-radius:2px; font-size:10px; font-weight:600; cursor:default; transition:transform .18s; }
        .ch-tt:hover { transform:translateY(-2px); }
        .ch-ttc { background:rgba(56,182,255,.09);  border:1px solid rgba(56,182,255,.22);  color:#38b6ff; }
        .ch-ttv { background:rgba(176,143,255,.09); border:1px solid rgba(176,143,255,.22); color:#b08fff; }
        .ch-ttg { background:rgba(0,229,160,.08);   border:1px solid rgba(0,229,160,.2);    color:#34d399; }
        .ch-tto { background:rgba(249,115,22,.08);  border:1px solid rgba(249,115,22,.2);   color:#f97316; }
        .ch-ttp { background:rgba(232,120,224,.08); border:1px solid rgba(232,120,224,.2);  color:#e878e0; }
        .ch-ttw { background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);  color:rgba(255,255,255,.5); }
        .ch-ttt { background:rgba(64,224,208,.08);  border:1px solid rgba(64,224,208,.2);   color:#40e0d0; }
        /* Bottom row */
        .ch-bot { display:grid; grid-template-columns:1fr 1fr; gap:13px; }
        @media (max-width:700px) { .ch-bot { grid-template-columns:1fr; } }
        .ch-shadow-panel { border-color:rgba(239,68,68,.12) !important; }
        .ch-shadow-panel::before { border-color:rgba(239,68,68,.42); }
        .ch-shadow-panel::after  { border-color:rgba(239,68,68,.42); }
        .ch-sh-list  { display:flex; flex-direction:column; gap:8px; }
        .ch-sh-item  { display:flex; align-items:flex-start; gap:10px; padding:10px 12px; border-radius:4px; background:rgba(239,68,68,.04); border:1px solid rgba(239,68,68,.10); transition:background .2s,border-color .2s; }
        .ch-sh-item:hover { background:rgba(239,68,68,.07); border-color:rgba(239,68,68,.2); }
        .ch-shico { font-size:16px; flex-shrink:0; margin-top:1px; }
        .ch-shbd  { flex:1; }
        .ch-shtt  { font-size:11px; font-weight:700; color:rgba(255,100,100,.82); margin-bottom:2px; }
        .ch-sht   { font-size:10px; color:rgba(255,255,255,.35); line-height:1.6; }
        .ch-iblk  { padding:12px 13px; border-radius:4px; margin-bottom:9px; }
        .ch-iblk:last-child { margin-bottom:0; }
        .ch-ib-hd { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; margin-bottom:5px; text-transform:uppercase; }
        .ch-ib-tx { font-size:10.5px; color:rgba(255,255,255,.42); line-height:1.7; }
        .ch-ib-tx strong { color:rgba(255,255,255,.8); font-weight:600; }
        .ch-footer { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-top:13px; padding:10px 14px; border-radius:4px; background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.05); }
        .ch-fid    { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; color:rgba(56,182,255,.28); }
        .ch-ftests { font-family:'Share Tech Mono',monospace; font-size:7.5px; color:rgba(255,255,255,.12); letter-spacing:.8px; text-align:center; }
        .ch-fver   { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2px; color:rgba(123,94,167,.35); }
        .ch-empty-block { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px 10px; text-align:center; opacity:.55; }
        .ch-empty-icon { font-size:2rem; margin-bottom:8px; }
        .ch-empty-text { font-size:.78rem; color:rgba(255,255,255,.3); margin-bottom:10px; }
        .ch-go-btn { display:inline-block; padding:6px 13px; border-radius:6px; border:1px solid rgba(99,102,241,.4); background:rgba(99,102,241,.12); color:#a5b4fc; font-size:.72rem; font-weight:600; cursor:pointer; transition:all .2s; font-family:inherit; }
        .ch-go-btn:hover { background:rgba(99,102,241,.22); color:#fff; }

        /* ════════ BENTO GRID REDESIGN ════════ */
        .ch-bento { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; }
        .ch-tile  { background:rgba(8,14,38,.88); backdrop-filter:blur(28px) saturate(160%); -webkit-backdrop-filter:blur(28px) saturate(160%); border:1px solid rgba(56,182,255,.11); border-radius:14px; position:relative; overflow:hidden; padding:20px; }
        .ch-tile::before,.ch-tile::after { content:''; position:absolute; width:13px; height:13px; border-color:#38b6ff; border-style:solid; opacity:.22; pointer-events:none; z-index:0; }
        .ch-tile::before { top:0; left:0; border-width:1.5px 0 0 1.5px; }
        .ch-tile::after  { bottom:0; right:0; border-width:0 1.5px 1.5px 0; }
        .ch-tile-accent { position:absolute; top:0; left:0; right:0; height:2px; border-radius:14px 14px 0 0; z-index:1; }
        .ch-t-hero  { grid-column:span 2; grid-row:span 2; }
        .ch-t-radar { grid-column:span 1; grid-row:span 2; }
        .ch-t-enn   { grid-column:span 1; grid-row:span 2; }
        .ch-t-str   { grid-column:span 2; }
        .ch-t-dt    { grid-column:span 2; }
        .ch-t-synth { grid-column:1/-1; }
        .ch-tl { font-family:'Share Tech Mono',monospace; font-size:8px; letter-spacing:2.5px; color:rgba(56,182,255,.38); text-transform:uppercase; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
        .ch-tl::after { content:''; flex:1; height:1px; background:linear-gradient(90deg,rgba(56,182,255,.18),transparent); }
        @media (max-width:1100px) { .ch-bento { grid-template-columns:repeat(2,1fr); } .ch-t-hero { grid-column:1/-1; grid-row:auto; } .ch-t-str,.ch-t-dt { grid-column:span 2; } }
        @media (max-width:680px)  { .ch-bento { grid-template-columns:1fr; } .ch-t-radar,.ch-t-enn,.ch-t-str,.ch-t-dt { grid-column:1/-1; grid-row:auto; } }
        /* ════════ END BENTO CSS ════════ */
    </style>
</head>
<body class="min-h-screen text-white grid-bg">

    <!-- NAVIGATION -->
    <nav class="border-b border-white/5 bg-bg-surface/80 backdrop-blur-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="https://it-is-you1.vercel.app/" class="iiy-logo iiy-sm">
                  <div class="iiy-signet">
                    <svg viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                      <defs>
                        <linearGradient id="iiy-hg2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#38b6ff"/><stop offset="50%" stop-color="#7b5ea7"/><stop offset="100%" stop-color="#38b6ff"/></linearGradient>
                        <linearGradient id="iiy-bg2" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#38b6ff" stop-opacity="0.45"/><stop offset="100%" stop-color="#1a1d4a" stop-opacity="0.08"/></linearGradient>
                        <filter id="iiy-glow2" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                        <clipPath id="iiy-clip2"><polygon points="48,5 87,27 87,69 48,91 9,69 9,27"/></clipPath>
                      </defs>
                      <polygon points="48,5 87,27 87,69 48,91 9,69 9,27" fill="#11143a"/>
                      <g class="iiy-ring-ticks" filter="url(#iiy-glow2)">
                        <line x1="48" y1="5" x2="48" y2="12" stroke="#38b6ff" stroke-width="1.8"/><line x1="87" y1="27" x2="81" y2="30" stroke="#38b6ff" stroke-width="1.8"/><line x1="87" y1="69" x2="81" y2="66" stroke="#38b6ff" stroke-width="1.8"/><line x1="48" y1="91" x2="48" y2="84" stroke="#38b6ff" stroke-width="1.8"/><line x1="9" y1="69" x2="15" y2="66" stroke="#38b6ff" stroke-width="1.8"/><line x1="9" y1="27" x2="15" y2="30" stroke="#38b6ff" stroke-width="1.8"/>
                        <line x1="68" y1="8" x2="66" y2="12" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/><line x1="28" y1="8" x2="30" y2="12" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/><line x1="90" y1="48" x2="84" y2="48" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/><line x1="6" y1="48" x2="12" y2="48" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/><line x1="68" y1="88" x2="66" y2="84" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/><line x1="28" y1="88" x2="30" y2="84" stroke="#7b5ea7" stroke-width="1" opacity="0.6"/>
                      </g>
                      <polygon points="48,5 87,27 87,69 48,91 9,69 9,27" fill="none" stroke="url(#iiy-hg2)" stroke-width="1.8"/>
                      <g clip-path="url(#iiy-clip2)">
                        <line class="iiy-scan" x1="12" y1="48" x2="84" y2="48" stroke="#38b6ff" stroke-width="1.2" opacity="0.5"/>
                        <circle cx="48" cy="30" r="12" fill="#11143a" stroke="#38b6ff" stroke-width="1.2"/>
                        <rect x="37" y="26.5" width="22" height="6" rx="3" fill="#0d0f2b" stroke="#38b6ff" stroke-width="0.7"/>
                        <ellipse class="iiy-eye-l" cx="43" cy="29.5" rx="3.5" ry="1.8" fill="#7b5ea7" filter="url(#iiy-glow2)"/>
                        <ellipse class="iiy-eye-r" cx="53" cy="29.5" rx="3.5" ry="1.8" fill="#7b5ea7" filter="url(#iiy-glow2)"/>
                        <rect x="44.5" y="42" width="7" height="6" rx="1" fill="#11143a" stroke="#38b6ff" stroke-width="0.8"/>
                        <path d="M28 90 L31 50 Q48 44 65 50 L68 90 Z" fill="url(#iiy-bg2)" stroke="#38b6ff" stroke-width="0.9"/>
                        <line x1="48" y1="50" x2="48" y2="74" stroke="#38b6ff" stroke-width="0.5" opacity="0.35"/>
                        <rect x="39" y="55" width="18" height="12" rx="1.5" fill="none" stroke="#38b6ff" stroke-width="0.6" opacity="0.5"/>
                        <line x1="31" y1="52" x2="31" y2="65" stroke="#7b5ea7" stroke-width="1.4" opacity="0.9"/>
                        <line x1="65" y1="52" x2="65" y2="65" stroke="#7b5ea7" stroke-width="1.4" opacity="0.9"/>
                        <circle class="iiy-core" cx="48" cy="61" r="2.8" fill="#38b6ff" filter="url(#iiy-glow2)"/>
                      </g>
                    </svg>
                  </div>
                  <div class="iiy-wordmark">
                    <div class="iiy-title">PSYCHER</div>
                    <div class="iiy-divider"></div>
                    <div class="iiy-sub">Psychometric AI Engine</div>
                  </div>
                </a>

                <!-- Center Nav Tabs -->
                <div class="iiy-nav-tabs">
                    <button class="iiy-tab-btn active" id="tab-btn-tests" onclick="switchTab('tests')">
                        🧪 Testy
                    </button>
                    <button class="iiy-tab-btn" id="tab-btn-character" onclick="switchTab('character')">
                        🃏 Karta Postaci
                    </button>
                </div>

                <!-- User Actions -->
                <div class="flex items-center gap-4">
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Przełącz motyw">
                        <div class="theme-toggle-slider"></div>
                        <!-- Moon Icon (Dark Mode) -->
                        <svg class="theme-icon theme-icon-moon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                        <!-- Sun Icon (Light Mode) -->
                        <svg class="theme-icon theme-icon-sun" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </button>
                    
                    <button onclick="logout()" class="px-4 py-2 bg-bg-surface/50 hover:bg-bg-surface text-white rounded-lg text-sm border border-white/10 hover:border-brand-primary/50 transition-all backdrop-blur-sm">
                        Wyloguj
                    </button>
                    <a href="/settings" class="px-4 py-2 bg-bg-surface/50 hover:bg-bg-surface text-white rounded-lg text-sm border border-white/10 hover:border-brand-primary/50 transition-all backdrop-blur-sm" style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;" title="Ustawienia konta">
                        ⚙️ Ustawienia
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="max-w-7xl mx-auto px-6 py-10">

        <!-- TAB: TESTY (default) -->
        <div id="tab-tests">

        <!-- PROFILE HERO -->
        <div id="profile-hero" style="animation: fadeUp 0.8s ease-out; background: rgba(15,23,42,0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.07); border-radius: 20px; padding: 28px 32px; margin-bottom: 48px; position: relative; overflow: hidden;">
            <!-- Background glow blobs -->
            <div style="position:absolute;top:-60px;right:-60px;width:280px;height:280px;background:radial-gradient(circle,rgba(99,102,241,0.12) 0%,transparent 70%);pointer-events:none;"></div>
            <div style="position:absolute;bottom:-80px;left:-40px;width:240px;height:240px;background:radial-gradient(circle,rgba(56,182,255,0.08) 0%,transparent 70%);pointer-events:none;"></div>

            <div style="position:relative;z-index:1;display:flex;flex-wrap:wrap;align-items:center;gap:24px;">

                <!-- Avatar -->
                <div style="position:relative;flex-shrink:0;">
                    <div id="user-avatar" style="width:80px;height:80px;border-radius:50%;overflow:hidden;border:3px solid rgba(99,102,241,0.4);box-shadow:0 0 24px rgba(99,102,241,0.25);background:linear-gradient(135deg,#6366f1,#0ea5e9);display:flex;align-items:center;justify-content:center;">
                        <img id="user-avatar-img" src="" alt="avatar" style="width:100%;height:100%;object-fit:cover;display:none;" />
                        <span id="user-initials" style="font-size:28px;font-weight:700;color:#fff;font-family:'Space Grotesk',sans-serif;">?</span>
                    </div>
                    <div id="profile-level" style="position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;font-size:11px;font-weight:700;padding:2px 10px;border-radius:999px;white-space:nowrap;border:2px solid #0a0f1e;">Lvl 0</div>
                </div>

                <!-- Name / email / badge -->
                <div style="flex-shrink:0;">
                    <h2 id="user-name" style="font-size:26px;font-weight:700;color:#fff;font-family:'Space Grotesk',sans-serif;margin:0 0 4px;">Ładowanie...</h2>
                    <p id="user-email" style="color:#94a3b8;font-size:13px;margin:0 0 12px;">---</p>
                    <div id="premium-badge" style="display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:999px;border:1px solid rgba(148,163,184,0.3);background:rgba(30,41,59,0.5);color:#94a3b8;font-size:11px;font-weight:700;letter-spacing:0.05em;text-transform:uppercase;">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <span id="badge-text">Free Account</span>
                    </div>
                </div>

                <!-- Progress block -->
                <div style="flex:1;min-width:260px;">
                    <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;">
                        <div>
                            <h3 style="font-size:18px;font-weight:700;color:#fff;font-family:'Space Grotesk',sans-serif;margin:0 0 3px;">Postęp Profilu</h3>
                            <p style="color:#94a3b8;font-size:13px;margin:0;">Ukończ wszystkie moduły aby odblokować pełną analizę</p>
                        </div>
                        <div style="text-align:right;flex-shrink:0;margin-left:16px;">
                            <div id="completion-count" style="font-size:32px;font-weight:800;font-family:'Space Grotesk',sans-serif;background:linear-gradient(90deg,#38b6ff,#6366f1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">0/6</div>
                            <p style="font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:0.1em;margin:0;">Modułów</p>
                        </div>
                    </div>

                    <!-- Progress bar -->
                    <div style="position:relative;height:10px;background:rgba(30,41,59,0.8);border-radius:999px;overflow:hidden;margin-bottom:16px;border:1px solid rgba(255,255,255,0.05);">
                        <div id="progress-bar" style="height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,#4f46e5,#38b6ff);transition:width 1s ease-out;box-shadow:0 0 16px rgba(99,102,241,0.5);"></div>
                        <div id="progress-percentage" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;">0%</div>
                    </div>

                    <!-- Next Step card -->
                    <div id="next-step-card" style="display:flex;align-items:center;gap:14px;background:rgba(15,23,42,0.9);border:1px solid rgba(99,102,241,0.25);border-radius:12px;padding:12px 16px;">
                        <div style="flex-shrink:0;width:36px;height:36px;background:linear-gradient(135deg,#7c3aed,#6366f1);border-radius:10px;display:flex;align-items:center;justify-content:center;">
                            <svg width="18" height="18" fill="none" stroke="#fff" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        </div>
                        <div style="flex:1;">
                            <p style="font-size:11px;font-weight:700;color:#38b6ff;text-transform:uppercase;letter-spacing:0.08em;margin:0 0 2px;">Następny Krok</p>
                            <p id="next-step-text" style="font-size:13px;color:#cbd5e1;margin:0;">Rozpocznij pierwszy test aby zbudować swój profil psychometryczny</p>
                        </div>
                        <button id="next-step-button" onclick="startNextTest()" style="flex-shrink:0;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;font-size:13px;font-weight:700;padding:8px 18px;border-radius:8px;border:none;cursor:pointer;white-space:nowrap;box-shadow:0 0 16px rgba(99,102,241,0.4);transition:opacity 0.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">
                            Start &rsaquo;
                        </button>
                    </div>

                    <!-- Completion Message (hidden by default) -->
                    <div id="completion-message" style="display:none;align-items:center;gap:14px;background:rgba(6,78,59,0.2);border:1px solid rgba(52,211,153,0.3);border-radius:12px;padding:12px 16px;margin-top:10px;">
                        <div style="flex-shrink:0;width:36px;height:36px;background:linear-gradient(135deg,#059669,#10b981);border-radius:10px;display:flex;align-items:center;justify-content:center;">
                            <svg width="18" height="18" fill="none" stroke="#fff" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <div>
                            <p style="font-size:12px;font-weight:700;color:#34d399;margin:0 0 2px;">🎉 Profil Ukończony!</p>
                            <p style="font-size:13px;color:#cbd5e1;margin:0;">Gratulacje! Ukończyłeś wszystkie 6 modułów psychometrycznych.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Module Cards -->
        <section class="iiy-modules" style="position:relative;">
          <!-- ambient background blobs -->
          <div style="position:absolute;inset:0;pointer-events:none;z-index:-1;overflow:hidden;border-radius:24px;">
            <div style="position:absolute;width:600px;height:400px;top:-80px;left:-100px;background:radial-gradient(ellipse,rgba(56,182,255,0.07) 0%,transparent 70%);"></div>
            <div style="position:absolute;width:500px;height:400px;bottom:-80px;right:-80px;background:radial-gradient(ellipse,rgba(123,94,167,0.1) 0%,transparent 70%);"></div>
          </div>

          <div class="iiy-modules-header">
            <span class="iiy-modules-title">Dostępne Moduły</span>
            <span class="iiy-modules-count">(6)</span>
          </div>

          <div class="iiy-cards-grid">

            <!-- CARD 1: HEXACO-60 — cyan -->
            <div class="iiy-card cyan" onclick="startHexacoTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                  </span>
                </div>
                <span id="hexaco-status" class="iiy-card-tag">Do Wykonania</span>
              </div>
              <div class="iiy-card-title">Rdzeń Osobowości</div>
              <div class="iiy-card-methodology">MODEL HEXACO-60</div>
              <div class="iiy-card-desc">Zdefiniuj swój psychologiczny hardware i bazowe statystyki percepcji świata.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>15 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>60 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="hexaco-button" class="iiy-card-btn primary">
                Rozpocznij Test <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

            <!-- CARD 2: Enneagram — fuchsia -->
            <div class="iiy-card fuchsia" onclick="startEnneagramTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </span>
                </div>
                <span id="enneagram-status" class="iiy-card-tag">Do Wykonania</span>
              </div>
              <div class="iiy-card-title">Silnik Motywacji</div>
              <div class="iiy-card-methodology">ENNEAGRAM RISO-HUDSON</div>
              <div class="iiy-card-desc">Odkryj głębokie pragnienia i nieświadome mechanizmy sterujące Twoimi decyzjami.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>10 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>36 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="enneagram-button" class="iiy-card-btn primary-fuchsia">
                Rozpocznij Test <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

            <!-- CARD 3: Dark Triad — rose -->
            <div class="iiy-card rose" id="dark-triad-card" onclick="startDarkTriadTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                  </span>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                  <span class="iiy-badge-premium">⭐ PREMIUM</span>
                  <span id="dark-triad-status" class="iiy-card-tag">Do Wykonania</span>
                </div>
              </div>
              <div class="iiy-card-title">Analiza Cienia</div>
              <div class="iiy-card-methodology">DARK TRIAD (SD3)</div>
              <div class="iiy-card-desc">Zidentyfikuj ryzykowne cechy, narcyzm i potencjalne zagrożenia systemowe.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>8 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>27 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="dark-triad-button" class="iiy-card-btn primary-rose">
                Zbadaj Cień <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

            <!-- CARD 4: Strengths — amber -->
            <div class="iiy-card amber" onclick="startStrengthsTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </span>
                </div>
                <span id="strengths-status" class="iiy-card-tag">Do Wykonania</span>
              </div>
              <div class="iiy-card-title">Mocne Strony</div>
              <div class="iiy-card-methodology">STRENGTHS ASSESSMENT</div>
              <div class="iiy-card-desc">Poznaj swoje Top 5 talentów i naturalne predyspozycje, dzięki którym wygrywasz.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>12 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>48 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="strengths-button" class="iiy-card-btn primary-amber">
                Odkryj Talenty <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

            <!-- CARD 5: Career RIASEC — emerald -->
            <div class="iiy-card emerald" onclick="startCareerTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  </span>
                </div>
                <span id="career-status" class="iiy-card-tag">Do Wykonania</span>
              </div>
              <div class="iiy-card-title">Profil Kariery</div>
              <div class="iiy-card-methodology">HOLLAND CODE (RIASEC)</div>
              <div class="iiy-card-desc">Znajdź profesję i środowisko pracy idealnie kompatybilne z Twoim profilem.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>12 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>48 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="career-button" class="iiy-card-btn primary-emerald">
                Odkryj Kod Hollanda <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

            <!-- CARD 6: Values Schwartz — teal -->
            <div class="iiy-card teal" onclick="startValuesTest()">
              <div class="iiy-card-glow"></div>
              <div class="iiy-card-top">
                <div class="iiy-card-icon-wrap">
                  <span class="iiy-card-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/></svg>
                  </span>
                </div>
                <span id="values-status" class="iiy-card-tag">Do Wykonania</span>
              </div>
              <div class="iiy-card-title">Kompas Wartości</div>
              <div class="iiy-card-methodology">SCHWARTZ VALUES (PVQ)</div>
              <div class="iiy-card-desc">Zdefiniuj fundamentalne zasady i priorytety Twojego systemu operacyjnego.</div>
              <div class="iiy-card-meta">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>10 min</span>
                <span class="iiy-card-meta-dot"></span>
                <span>40 pytań</span>
              </div>
              <div class="iiy-card-divider"></div>
              <button id="values-button" class="iiy-card-btn primary-teal">
                Rozpocznij Test <span class="iiy-card-btn-arrow">›</span>
              </button>
            </div>

          </div>
        </section>

        <!-- Protokół Kalibracji -->
        <div class="mt-8 glass-card rounded-3xl p-10 border border-white/10 relative overflow-hidden">
            <!-- Glow effect -->
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-96 h-96 bg-indigo-500/8 rounded-full blur-3xl pointer-events-none"></div>

            <h2 class="text-2xl font-bold text-white text-center mb-8 relative tracking-wide">
                Protokół poznawania siebie
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 relative">

                <!-- Step 1: Inicjalizacja Skanu -->
                <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);color:#818cf8;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
                            <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
                            <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
                            <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
                        </svg>
                    </div>
                    <h3 class="text-white font-semibold mb-2">1. Inicjalizacja Skanu</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Wypełnij wybrane moduły psychometryczne. Bądź całkowicie szczery – to Twój kod źródłowy, nie ma tu błędnych odpowiedzi.</p>
                </div>

                <!-- Step 2: Dekodowanie Modułów -->
                <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);color:#818cf8;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="4" y="4" width="16" height="16" rx="2"/>
                            <rect x="9" y="9" width="6" height="6"/>
                            <path d="M15 2v2"/><path d="M15 20v2"/>
                            <path d="M2 15h2"/><path d="M2 9h2"/>
                            <path d="M20 15h2"/><path d="M20 9h2"/>
                            <path d="M9 2v2"/><path d="M9 20v2"/>
                        </svg>
                    </div>
                    <h3 class="text-white font-semibold mb-2">2. Dekodowanie Modułów</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Odbierz natychmiastową analizę każdego z testów. Zrozum swoje mocne strony, ukryte motywacje i potencjalne ryzyka.</p>
                </div>

                <!-- Step 3: Karta Postaci -->
                <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);color:#818cf8;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                    </div>
                    <h3 class="text-white font-semibold mb-2">3. Karta Postaci</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Ukończ wszystkie moduły, aby odblokować pełny, zintegrowany obraz. Zobacz, jak Twoje cechy łączą się w unikalną matrycę.</p>
                </div>

                <!-- Step 4: Neural Engine Analysis -->
                <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);color:#818cf8;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                            <path d="M5 3v4"/><path d="M19 17v4"/>
                            <path d="M3 5h4"/><path d="M17 19h4"/>
                        </svg>
                    </div>
                    <h3 class="text-white font-semibold mb-2">4. Neural Engine Analysis</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Skonfrontuj wyniki z AI. Rozpocznij sesję z silnikiem NEA, który zinterpretuje Twój profil i wskaże optymalne ścieżki rozwoju.</p>
                </div>

            </div>
        </div>

        </div><!-- /tab-tests -->

        <!-- TAB: KARTA POSTACI -->
        <div id="tab-character" style="display:none;">
        <div class="ch-sheet-wrapper">

          <!-- STATUS BAR -->
          <div class="ch-topbar">
            <div style="display:flex;align-items:center;gap:10px;">
              <div class="ch-tb-pill"><div class="ch-tb-dot"></div><span id="ch-completion-pill">ŁADOWANIE PROFILU…</span></div>
            </div>
            <div class="ch-tb-meta" id="ch-footer-id-top">CHAR-ID: PSY----- · PSYCHER v2.0</div>
          </div>

          <!-- BENTO GRID -->
          <div class="ch-bento">

            <!-- ── T1: HERO CORE 2×2 ── -->
            <div class="ch-tile ch-t-hero">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#38b6ff,#7b5ea7);"></div>
              <div class="ch-tl">// IDENTYFIKACJA · HERO CORE</div>
              <div style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;margin-bottom:16px;">
                <div class="ch-av-wrap" style="position:relative;width:118px;height:118px;flex-shrink:0;">
                  <img id="ch-avatar-img" src="" alt="" style="display:none;position:absolute;top:6px;left:6px;width:106px;height:106px;border-radius:50%;object-fit:cover;z-index:5;" />
                  <svg class="ch-av-svg" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <linearGradient id="chG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#38b6ff"/><stop offset="100%" stop-color="#7b5ea7"/></linearGradient>
                      <linearGradient id="chN" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#38b6ff" stop-opacity=".8"/><stop offset="100%" stop-color="#7b5ea7" stop-opacity=".8"/></linearGradient>
                      <linearGradient id="chSc" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="transparent"/><stop offset="25%" stop-color="#38b6ff" stop-opacity=".7"/><stop offset="75%" stop-color="#38b6ff" stop-opacity=".7"/><stop offset="100%" stop-color="transparent"/></linearGradient>
                      <linearGradient id="chBd" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#38b6ff" stop-opacity=".18"/><stop offset="100%" stop-color="#7b5ea7" stop-opacity=".03"/></linearGradient>
                      <filter id="chF" x="-45%" y="-45%" width="190%" height="190%"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                      <clipPath id="chC"><circle cx="60" cy="60" r="54"/></clipPath>
                    </defs>
                    <circle cx="60" cy="60" r="56" fill="#030014"/>
                    <g class="ch-sp"><circle cx="60" cy="60" r="56" fill="none" stroke="url(#chG)" stroke-width=".8" stroke-dasharray="4 7" opacity=".4"/></g>
                    <g class="ch-spr">
                      <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(56,182,255,.08)" stroke-width=".8" stroke-dasharray="2 9"/>
                      <line x1="60" y1="8"   x2="60" y2="14"  stroke="#38b6ff" stroke-width="1.3" stroke-linecap="round" filter="url(#chF)" opacity=".6"/>
                      <line x1="60" y1="106" x2="60" y2="112" stroke="#38b6ff" stroke-width="1.3" stroke-linecap="round" filter="url(#chF)" opacity=".6"/>
                      <line x1="8"   y1="60" x2="14"  y2="60" stroke="#7b5ea7" stroke-width="1.3" stroke-linecap="round" filter="url(#chF)" opacity=".6"/>
                      <line x1="106" y1="60" x2="112" y2="60" stroke="#7b5ea7" stroke-width="1.3" stroke-linecap="round" filter="url(#chF)" opacity=".6"/>
                    </g>
                    <circle cx="60" cy="60" r="54" fill="none" stroke="url(#chG)" stroke-width="1.6"/>
                    <line x1="60" y1="4"   x2="60" y2="11"  stroke="#38b6ff" stroke-width="2" stroke-linecap="round" filter="url(#chF)"/>
                    <line x1="60" y1="109" x2="60" y2="116" stroke="#38b6ff" stroke-width="2" stroke-linecap="round" filter="url(#chF)"/>
                    <line x1="4"   y1="60" x2="11"  y2="60" stroke="#38b6ff" stroke-width="2" stroke-linecap="round" filter="url(#chF)"/>
                    <line x1="109" y1="60" x2="116" y2="60" stroke="#38b6ff" stroke-width="2" stroke-linecap="round" filter="url(#chF)"/>
                    <line x1="17" y1="17"   x2="24" y2="24"  stroke="#7b5ea7" stroke-width="1.1" stroke-linecap="round" opacity=".5" filter="url(#chF)"/>
                    <line x1="103" y1="17"  x2="96" y2="24"  stroke="#7b5ea7" stroke-width="1.1" stroke-linecap="round" opacity=".5" filter="url(#chF)"/>
                    <line x1="17" y1="103"  x2="24" y2="96"  stroke="#7b5ea7" stroke-width="1.1" stroke-linecap="round" opacity=".5" filter="url(#chF)"/>
                    <line x1="103" y1="103" x2="96" y2="96"  stroke="#7b5ea7" stroke-width="1.1" stroke-linecap="round" opacity=".5" filter="url(#chF)"/>
                    <g clip-path="url(#chC)">
                      <path d="M60,18 C78,18 90,30 90,46 C90,57 85,65 78,70 L78,79 L42,79 L42,70 C35,65 30,57 30,46 C30,30 42,18 60,18Z" fill="url(#chBd)" stroke="url(#chG)" stroke-width="1.6" filter="url(#chF)"/>
                      <line x1="42" y1="79" x2="35" y2="93" stroke="url(#chG)" stroke-width="1.2" stroke-linecap="round" opacity=".38"/>
                      <line x1="78" y1="79" x2="85" y2="93" stroke="url(#chG)" stroke-width="1.2" stroke-linecap="round" opacity=".38"/>
                      <line x1="35" y1="93" x2="85" y2="93" stroke="url(#chG)" stroke-width="1.2" stroke-linecap="round" opacity=".38"/>
                      <line class="ch-al" x1="60" y1="28" x2="50" y2="38" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="60" y1="28" x2="70" y2="38" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="50" y1="38" x2="60" y2="48" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="70" y1="38" x2="60" y2="48" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="50" y1="38" x2="40" y2="51" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="70" y1="38" x2="80" y2="51" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="60" y1="48" x2="50" y2="60" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="60" y1="48" x2="70" y2="60" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="40" y1="51" x2="50" y2="60" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="80" y1="51" x2="70" y2="60" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="50" y1="60" x2="60" y2="72" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="70" y1="60" x2="60" y2="72" stroke="url(#chN)" stroke-width="1"/>
                      <line class="ch-al" x1="50" y1="38" x2="70" y2="38" stroke="url(#chN)" stroke-width=".7" opacity=".5"/>
                      <line class="ch-al" x1="50" y1="60" x2="70" y2="60" stroke="url(#chN)" stroke-width=".7" opacity=".5"/>
                      <circle class="ch-an" cx="60" cy="28" r="2.2" fill="#38b6ff" filter="url(#chF)"/>
                      <circle class="ch-an" cx="50" cy="38" r="1.9" fill="#38b6ff" filter="url(#chF)"/>
                      <circle class="ch-an" cx="70" cy="38" r="1.9" fill="#7b5ea7" filter="url(#chF)"/>
                      <circle class="ch-an" cx="60" cy="48" r="2.4" fill="#38b6ff" filter="url(#chF)"/>
                      <circle class="ch-an" cx="40" cy="51" r="1.9" fill="#7b5ea7" filter="url(#chF)"/>
                      <circle class="ch-an" cx="80" cy="51" r="1.9" fill="#7b5ea7" filter="url(#chF)"/>
                      <circle class="ch-an" cx="50" cy="60" r="1.9" fill="#38b6ff" filter="url(#chF)"/>
                      <circle class="ch-an" cx="70" cy="60" r="1.9" fill="#7b5ea7" filter="url(#chF)"/>
                      <circle class="ch-an" cx="60" cy="72" r="1.9" fill="#38b6ff" filter="url(#chF)"/>
                      <rect class="ch-asc" x="6" y="59" width="108" height="2" fill="url(#chSc)" rx="1"/>
                    </g>
                  </svg>
                </div>
                </div>
                <div style="flex:1;min-width:160px;">
                  <div class="ch-lvl"><div class="ch-ldot"></div><span id="ch-lvl-text">LVL 0 · POCZĄTKUJĄCY</span></div>
                  <div class="ch-cname" id="ch-cname">---</div>
                  <div class="ch-carch" id="ch-carch">Profil w budowie</div>
                  <div class="ch-ccodes" id="ch-ccodes">UZUPEŁNIJ TESTY · BRAK DANYCH</div>
                  <div class="ch-rare" id="ch-rare">⚙ OBLICZANIE PROFILU</div>
                  <div class="ch-xp-wrap" style="margin-top:10px;">
                    <div class="ch-xp-lbl">
                      <span style="color:rgba(255,255,255,.22)">PROFIL XP</span>
                      <span style="color:rgba(56,182,255,.6)" id="ch-xp-label">0/7 TESTÓW</span>
                    </div>
                    <div class="ch-xp-track"><div class="ch-xp-fill" id="ch-xp-fill" style="width:0%"></div></div>
                  </div>
                </div>
              </div>
              <div class="ch-tl" style="margin-bottom:8px;">// ⚔ ARCHETYP RPG · KLASA POSTACI</div>
              <div id="ch-rpg-content">
                <div class="ch-empty-block"><div class="ch-empty-icon">⚔</div><div class="ch-empty-text">Ukończ test Enneagram aby odblokować swój archetyp RPG</div><button class="ch-go-btn" onclick="switchTab('tests')">Przejdź do testów →</button></div>
              </div>
              <div class="ch-tl" style="margin-top:16px;margin-bottom:8px;">// 🎬 POSTACIE PODOBNE DO CIEBIE</div>
              <div id="ch-pop-content">
                <div class="ch-empty-block"><div class="ch-empty-icon">🎬</div><div class="ch-empty-text">Ukończ test Enneagram aby zobaczyć postacie z kultury popularnej podobne do Ciebie</div><button class="ch-go-btn" onclick="switchTab('tests')">Przejdź do testów →</button></div>
              </div>
            </div>

            <!-- ── T2: HEXACO RADAR 1×2 ── -->
            <div class="ch-tile ch-t-radar">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#22d3ee,#38b6ff);"></div>
              <div class="ch-tl">// ATRYBUTY · HEXACO-60</div>
              <div style="display:flex;justify-content:center;margin-bottom:12px;">
                <svg id="ch-hex-radar" viewBox="0 0 220 220" width="190" height="190" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="110" cy="110" r="82" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                  <circle cx="110" cy="110" r="62" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                  <circle cx="110" cy="110" r="41" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                  <circle cx="110" cy="110" r="21" fill="none" stroke="rgba(56,182,255,.06)" stroke-width="1"/>
                  <text x="110" y="114" text-anchor="middle" fill="rgba(56,182,255,.2)" font-family="Share Tech Mono,monospace" font-size="8">BRAK DANYCH</text>
                </svg>
              </div>
              <div id="ch-attr-grid" class="ch-attr-grid" style="grid-template-columns:repeat(2,1fr);">
                <div class="ch-attr-b ch-ag"><div class="ch-a-lbl">Sumienność</div><div class="ch-a-val">—</div><div class="ch-a-nm">Conscientiousness</div></div>
                <div class="ch-attr-b ch-ac"><div class="ch-a-lbl">Otwartość</div><div class="ch-a-val">—</div><div class="ch-a-nm">Openness</div></div>
                <div class="ch-attr-b ch-av"><div class="ch-a-lbl">Ugodowość</div><div class="ch-a-val">—</div><div class="ch-a-nm">Agreeableness</div></div>
                <div class="ch-attr-b ch-at"><div class="ch-a-lbl">Szczerość</div><div class="ch-a-val">—</div><div class="ch-a-nm">Honesty-Humility</div></div>
                <div class="ch-attr-b ch-ap"><div class="ch-a-lbl">Ekstrawersja</div><div class="ch-a-val">—</div><div class="ch-a-nm">Extraversion</div></div>
                <div class="ch-attr-b ch-ao"><div class="ch-a-lbl">Emocjonalność</div><div class="ch-a-val">—</div><div class="ch-a-nm">Emotionality</div></div>
              </div>
              <div class="ch-hx-bars" id="ch-hx-bars" style="margin-top:12px;display:flex;flex-direction:column;gap:5px;"></div>
              <div id="ch-hexaco-cta" style="margin-top:14px;text-align:center;">
                <button class="ch-go-btn" onclick="switchTab('tests')">Wykonaj test HEXACO-60 aby odblokować →</button>
              </div>
            </div>

            <!-- ── T3: ENNEAGRAM + TYPOLOGY 1×2 ── -->
            <div class="ch-tile ch-t-enn">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#7b5ea7,#b08fff);"></div>
              <div class="ch-tl">// TYPOLOGIA · ENNEAGRAM</div>
              <div style="display:flex;justify-content:center;margin-bottom:4px;">
                <svg id="ch-enn-star" viewBox="0 0 200 200" width="160" height="160" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="100" cy="100" r="88" fill="none" stroke="rgba(176,143,255,.07)" stroke-width="1.5"/>
                  <text x="100" y="104" text-anchor="middle" fill="rgba(176,143,255,.28)" font-family="Share Tech Mono,monospace" font-size="8">BRAK DANYCH</text>
                </svg>
              </div>
              <div style="text-align:center;margin-bottom:10px;">
                <div id="ch-enn-num" style="font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;letter-spacing:2px;color:#b08fff;text-shadow:0 0 28px #b08fff55;line-height:1;">?</div>
                <div id="ch-enn-type" style="font-size:12px;font-weight:700;color:rgba(255,255,255,.72);letter-spacing:1px;margin-top:3px;">Nieznany typ</div>
                <div id="ch-enn-sub" style="font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:2px;color:rgba(176,143,255,.42);margin-top:2px;text-transform:uppercase;">WYKONAJ TEST</div>
                <div id="ch-enn-desc" style="font-size:9.5px;color:rgba(255,255,255,.24);line-height:1.6;margin-top:7px;padding:0 6px;">Wykonaj test Enneagram aby odblokować typologię motywacji.</div>
              </div>
              <div class="ch-tl" style="margin-bottom:8px;">// KARIERA · RIASEC</div>
              <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap;">
                <div class="ch-hol-ltrs" id="ch-hol-ltrs" style="display:flex;gap:5px;">
                  <div class="ch-hl ch-hl-i">?</div><div class="ch-hl ch-hl-e">?</div><div class="ch-hl ch-hl-a">?</div>
                </div>
                <div class="ch-careers" id="ch-careers" style="flex:1;"><span class="ch-ct">WYKONAJ TEST KARIERY</span></div>
              </div>
              <div class="ch-tl" style="margin-bottom:8px;">// WARTOŚCI · PVQ-40</div>
              <div class="ch-val-chips" id="ch-val-chips" style="margin-bottom:10px;"><span class="ch-vc ch-vc4">Wykonaj test wartości</span></div>
              <div class="ch-tl" style="margin-bottom:6px;">// CIEMNA TRIADA · PODSUMOWANIE</div>
              <div id="ch-dt-summary" style="font-size:10px;color:rgba(255,255,255,.28);">Wykonaj test Dark Triad SD3 aby odblokować.</div>
            </div>

            <!-- ── T4: ARSENAL / STRENGTHS 2×1 ── -->
            <div class="ch-tile ch-t-str">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#fbbf24,#34d399);"></div>
              <div class="ch-tl">// ⚡ ARSENAL · TOP TALENTY · STRENGTHS</div>
              <div id="ch-str-content">
                <div class="ch-empty-block"><div class="ch-empty-icon">⚡</div><div class="ch-empty-text">Wykonaj test Strengths aby odkryć swoje talenty</div><button class="ch-go-btn" onclick="startStrengthsTest()">Rozpocznij →</button></div>
              </div>
            </div>

            <!-- ── T5: DARK TRIAD / SHADOW 2×1 ── -->
            <div class="ch-tile ch-t-dt" style="border-color:rgba(239,68,68,.14);">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#ef4444,#f97316,#fbbf24);"></div>
              <div class="ch-tl" style="color:rgba(239,68,68,.45);">// ⚠ CIEMNA TRIADA · SD3 · OBSZARY CIENIA</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                <div id="ch-dt-content">
                  <div class="ch-empty-block"><div class="ch-empty-icon">🌑</div><div class="ch-empty-text">Odblokuj test Dark Triad SD3 Premium aby zobaczyć analizę cienia</div><button class="ch-go-btn" onclick="startDarkTriadTest()">Odblokuj Premium →</button></div>
                </div>
                <div id="ch-shadow-content">
                  <div class="ch-empty-block"><div class="ch-empty-icon">🌘</div><div class="ch-empty-text">Obszary cienia pojawią się po ukończeniu testów Dark Triad i HEXACO</div></div>
                </div>
              </div>
            </div>

            <!-- ── T6: AI SYNTHESIS 4×1 ── -->
            <div class="ch-tile ch-t-synth">
              <div class="ch-tile-accent" style="background:linear-gradient(90deg,#6366f1,#38b6ff,#7b5ea7,#34d399);"></div>
              <div class="ch-tl">// 🤖 PSYCHER AI INSIGHT · SYNTEZA · PROFIL KOMPLETNY</div>
              <div id="ch-insight-content">
                <div class="ch-empty-block"><div class="ch-empty-icon">🔮</div><div class="ch-empty-text">Synteza AI pojawi się po ukończeniu co najmniej 3 testów</div><button class="ch-go-btn" onclick="switchTab('tests')">Uzupełnij profil →</button></div>
              </div>
            </div>

          </div><!-- /ch-bento -->

          <!-- TRAIT CHIPS -->
          <div style="margin-top:13px;" id="ch-traits-content"></div>

          <!-- FOOTER -->
          <div class="ch-footer" style="margin-top:13px;">
            <div class="ch-fid" id="ch-footer-id">CHAR-ID: PSY----- · PSYCHER v2.0</div>
            <div class="ch-ftests">PSYCHER v2.0</div>
            <div class="ch-fver" id="ch-footer-date">BUILD DATE</div>
          </div>

        </div><!-- /ch-sheet-wrapper -->
        </div><!-- /tab-character -->

    </main>

    <!-- FOOTER -->
    <footer class="border-t border-white/5 bg-black/30 backdrop-blur-xl mt-24">
        <div class="max-w-7xl mx-auto px-6 py-10 text-center">
            <p class="text-slate-500 text-sm">
               &copy; 2026 <span class="text-brand-primary font-semibold">Psycher</span> – Psychometric AI Engine. Wszystkie prawa zastrzeżone.
            </p>
        </div>
    </footer>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://uvzilorpyuqicuwkufky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2emlsb3JweXVxaWN1d2t1Zmt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNDQzNTAsImV4cCI6MjA4NjkyMDM1MH0.jNIkqASHNl_7WbLq0jBZ86kRDmRP2jzIbI-db9l9teA';
        const supabase = createClient(supabaseUrl, supabaseKey);

        console.log('Dashboard loaded, Supabase client created');

        // ============================================
        // PREMIUM / STRIPE HELPERS
        // ============================================

        // Global premium flag — set once on page load
        window.userIsPremium = false;

        /**
         * Fetch is_premium from the profiles table for the current user.
         * Returns true/false; also sets window.userIsPremium.
         */
        async function fetchUserPremiumStatus() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session?.user) return false;

                const { data, error } = await supabase
                    .from('profiles')
                    .select('is_premium')
                    .eq('id', session.user.id)
                    .single();

                if (error) {
                    console.warn('[premium] Error fetching profile:', error.message);
                    return false;
                }

                window.userIsPremium = data?.is_premium ?? false;
                return window.userIsPremium;
            } catch (err) {
                console.error('[premium] fetchUserPremiumStatus error:', err);
                return false;
            }
        }

        /**
         * Redirect user to Stripe Checkout.
         * Called from the Dark Triad locked button.
         */
        window.handleUpgradeToPremium = async function() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session?.access_token) {
                    alert('Musisz być zalogowany, aby przejść na konto Premium.');
                    return;
                }

                // Show loading state on the button
                const btn = document.getElementById('dark-triad-button');
                if (btn) { btn.textContent = 'Ładowanie...'; btn.disabled = true; }

                const response = await fetch(
                    `${supabaseUrl}/functions/v1/create-checkout-session`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${session.access_token}`,
                        },
                        body: JSON.stringify({}),
                    }
                );

                const result = await response.json();

                if (!response.ok || !result.url) {
                    if (btn) { btn.innerHTML = '🔒 Odblokuj Premium'; btn.disabled = false; }
                    alert(`Błąd: ${result.error ?? 'Nie udało się utworzyć sesji płatności.'}`);
                    return;
                }

                window.location.href = result.url;
            } catch (err) {
                console.error('[handleUpgradeToPremium] Error:', err);
                const btn = document.getElementById('dark-triad-button');
                if (btn) { btn.innerHTML = '🔒 Odblokuj Premium'; btn.disabled = false; }
                alert('Wystąpił błąd. Spróbuj ponownie.');
            }
        };
        
        // ============================================
        // THEME TOGGLE FUNCTIONALITY
        // ============================================
        
        // Load theme preference on page load
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme');
            const toggle = document.getElementById('theme-toggle');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                if (toggle) toggle.classList.add('light');
            }
            
            console.log('Theme loaded:', savedTheme || 'dark (default)');
        }
        
        // Toggle theme function
        window.toggleTheme = function() {
            const body = document.body;
            const toggle = document.getElementById('theme-toggle');
            const isLightMode = body.classList.contains('light-mode');
            
            if (isLightMode) {
                // Switch to Dark Mode
                body.classList.remove('light-mode');
                toggle.classList.remove('light');
                localStorage.setItem('theme', 'dark');
                console.log('Switched to Dark Mode');
            } else {
                // Switch to Light Mode
                body.classList.add('light-mode');
                toggle.classList.add('light');
                localStorage.setItem('theme', 'light');
                console.log('Switched to Light Mode');
            }
        }
        
        // Load theme immediately (before other scripts)
        loadThemePreference();
        
        // ============================================
        // END THEME TOGGLE
        // ============================================
        
        // Debug: Check localStorage keys
        console.log('LocalStorage keys:', Object.keys(localStorage));
        const supabaseKeys = Object.keys(localStorage).filter(k => k.includes('supabase') || k.includes('sb-'));
        console.log('Supabase-related keys:', supabaseKeys);
        supabaseKeys.forEach(key => {
            const value = localStorage.getItem(key);
            console.log(`  ${key}:`, value?.substring(0, 100) + '...');
        });

        // Check authentication
        async function checkAuth() {
            console.log('Checking auth...');
            // Wait for Supabase to restore session from localStorage
            const { data: { session }, error } = await supabase.auth.getSession();
            
            console.log('Session check:', { session: session ? 'exists' : 'null', error, userId: session?.user?.id });
            
            if (error || !session) {
                console.log('No valid session, redirecting to auth');
                window.location.href = '/auth';
                return false;
            }
            
            console.log('User authenticated:', session.user.id);
            return true;
        }

        // Logout function
        window.logout = async function() {
            await supabase.auth.signOut();
            localStorage.removeItem('user_session');
            localStorage.removeItem('auth_token');
            localStorage.removeItem('has_profile');
            window.location.href = 'https://it-is-you1.vercel.app/';
        }

        // Check if Strengths test is completed
        async function checkStrengthsCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'STRENGTHS')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Strengths completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkStrengthsCompleted:', err);
                return false;
            }
        }

        // Check if Career test is completed
        async function checkCareerCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'CAREER')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Career completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkCareerCompleted:', err);
                return false;
            }
        }

        // Check if Values test is completed
        async function checkValuesCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'VALUES')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Values completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkValuesCompleted:', err);
                return false;
            }
        }

        // Check if Dark Triad test is completed
        async function checkDarkTriadCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'DARK_TRIAD')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Dark Triad completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkDarkTriadCompleted:', err);
                return false;
            }
        }

        // Check if Enneagram test is completed
        async function checkEnneagramCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'ENNEAGRAM')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Enneagram completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkEnneagramCompleted:', err);
                return false;
            }
        }

        // Check if HEXACO test is completed
        async function checkHexacoCompleted() {
            try {
                // First restore the session from localStorage
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) {
                    console.error('Session error:', sessionError);
                    return false;
                }
                
                if (!session || !session.user) {
                    console.log('No active session found');
                    return false;
                }

                console.log('Checking test completion for user:', session.user.id);

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'HEXACO')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                console.log('Database query result:', { data, error, count: data?.length });

                if (error) {
                    console.error('Error checking test completion:', error);
                    return false;
                }

                const completed = data && data.length > 0;
                console.log('HEXACO test completed:', completed);
                if (completed) {
                    console.log('Test details:', data[0]);
                }
                return completed;
            } catch (err) {
                console.error('Error in checkHexacoCompleted:', err);
                return false;
            }
        }

        // Start Strengths test or view results
        window.startStrengthsTest = async function() {
            const completed = await checkStrengthsCompleted();
            
            if (completed) {
                window.location.href = '/test/strengths/results';
            } else {
                window.location.href = '/test?type=strengths';
            }
        }

        // Start Career test or view results
        window.startCareerTest = async function() {
            const completed = await checkCareerCompleted();
            
            if (completed) {
                window.location.href = '/test/career/results';
            } else {
                window.location.href = '/test?type=career';
            }
        }

        // Start Values test or view results
        window.startValuesTest = async function() {
            const completed = await checkValuesCompleted();
            
            if (completed) {
                window.location.href = '/test/values/results';
            } else {
                window.location.href = '/test?type=values';
            }
        }

        // Start Dark Triad test or view results — PREMIUM GATED
        window.startDarkTriadTest = async function() {
            // Block non-premium users
            if (!window.userIsPremium) {
                await window.handleUpgradeToPremium();
                return;
            }

            const completed = await checkDarkTriadCompleted();
            
            if (completed) {
                window.location.href = '/test/dark-triad/results';
            } else {
                window.location.href = '/test?type=dark_triad';
            }
        }

        // Start Enneagram test or view results
        window.startEnneagramTest = async function() {
            const completed = await checkEnneagramCompleted();
            
            if (completed) {
                window.location.href = '/test/enneagram/results';
            } else {
                window.location.href = '/test?type=enneagram';
            }
        }

        // Start HEXACO test or view results
        window.startHexacoTest = async function() {
            console.log('HEXACO tile clicked, checking completion status...');
            const completed = await checkHexacoCompleted();
            console.log('Completion check result:', completed);
            
            if (completed) {
                console.log('Test completed, redirecting to results');
                window.location.href = '/test/hexaco/results';
            } else {
                console.log('Test not completed, redirecting to test');
                window.location.href = '/test';
            }
        }

        // Update UI for Strengths test
        async function updateStrengthsUI() {
            const completed = await checkStrengthsCompleted();
            
            const statusEl = document.getElementById('strengths-status');
            const buttonEl = document.getElementById('strengths-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.className = 'iiy-card-tag'; statusEl.style.color = '#38b6ff'; statusEl.style.borderColor = 'rgba(56,182,255,0.35)'; statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
            }
        }

        // Update UI for Career test
        async function updateCareerUI() {
            const completed = await checkCareerCompleted();
            
            const statusEl = document.getElementById('career-status');
            const buttonEl = document.getElementById('career-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.className = 'iiy-card-tag'; statusEl.style.color = '#38b6ff'; statusEl.style.borderColor = 'rgba(56,182,255,0.35)'; statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
            }
        }

        // Update UI for Values test
        async function updateValuesUI() {
            const completed = await checkValuesCompleted();
            
            const statusEl = document.getElementById('values-status');
            const buttonEl = document.getElementById('values-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.className = 'iiy-card-tag'; statusEl.style.color = '#38b6ff'; statusEl.style.borderColor = 'rgba(56,182,255,0.35)'; statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
            }
        }

        // Update UI for Dark Triad test — PREMIUM GATED
        async function updateDarkTriadUI() {
            const statusEl = document.getElementById('dark-triad-status');
            const buttonEl = document.getElementById('dark-triad-button');
            const cardEl   = document.getElementById('dark-triad-card');

            if (!window.userIsPremium) {
                // Locked: show upgrade CTA
                if (statusEl) {
                    statusEl.textContent = 'Zablokowany';
                    statusEl.style.color = '#fbbf24';
                    statusEl.style.borderColor = 'rgba(245,158,11,0.35)';
                    statusEl.style.background = 'rgba(245,158,11,0.08)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '🔒 Odblokuj Premium';
                    buttonEl.className = 'iiy-card-btn premium-lock';
                }
                return;
            }

            // Premium user: show normal completion state
            const completed = await checkDarkTriadCompleted();
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.style.color = '#38b6ff';
                    statusEl.style.borderColor = 'rgba(56,182,255,0.35)';
                    statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
            }
            // If not completed, button stays as default "Zbadaj Cień"
        }

        // Update UI for Enneagram test
        async function updateEnneagramUI() {
            const completed = await checkEnneagramCompleted();
            
            const statusEl = document.getElementById('enneagram-status');
            const buttonEl = document.getElementById('enneagram-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.className = 'iiy-card-tag'; statusEl.style.color = '#38b6ff'; statusEl.style.borderColor = 'rgba(56,182,255,0.35)'; statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
            }
        }

        // Update UI based on test completion status
        async function updateHexacoUI() {
            console.log('Updating HEXACO UI...');
            const completed = await checkHexacoCompleted();
            console.log('Test completed status:', completed);
            
            const statusEl = document.getElementById('hexaco-status');
            const buttonEl = document.querySelector('#hexaco-button');
            
            console.log('Status element:', statusEl, 'Button element:', buttonEl);
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukończony';
                    statusEl.className = 'iiy-card-tag'; statusEl.style.color = '#38b6ff'; statusEl.style.borderColor = 'rgba(56,182,255,0.35)'; statusEl.style.background = 'rgba(56,182,255,0.1)';
                }
                if (buttonEl) {
                    buttonEl.innerHTML = '👁 Zobacz Wynik';
                    buttonEl.className = 'iiy-card-btn ghost';
                }
                console.log('UI updated to show completed state');
            } else {
                console.log('Test not completed, keeping default UI');
            }
        }

        // Initialize when DOM is ready
        async function initialize() {
            console.log('Initializing dashboard...');
            const authenticated = await checkAuth();
            if (!authenticated) {
                console.log('Not authenticated, stopping initialization');
                return;
            }
            console.log('Auth successful, updating UI...');
            // Fetch premium status FIRST so all UI components have the correct state
            await fetchUserPremiumStatus();
            console.log('[init] isPremium:', window.userIsPremium);
            await updateProfileHero();
            await updateHexacoUI();
            await updateEnneagramUI();
            await updateDarkTriadUI();
            await updateStrengthsUI();
            await updateCareerUI();
            await updateValuesUI();
            console.log('Dashboard initialized successfully');
        }

        // ============================================
        // PROFILE HERO FUNCTIONS
        // ============================================

        // Count all completed tests
        async function getCompletedTestsCount() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return 0;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('test_type')
                    .eq('user_id', session.user.id);

                if (error) {
                    console.error('Error counting completed tests:', error);
                    return 0;
                }

                // Get unique test types (in case user retook a test)
                const uniqueTests = [...new Set(data.map(item => item.test_type))];
                return uniqueTests.length;
            } catch (err) {
                console.error('Error in getCompletedTestsCount:', err);
                return 0;
            }
        }

        // Get next recommended test
        async function getNextTest() {
            const tests = [
                { name: 'HEXACO-60', type: 'hexaco', checkFn: checkHexacoCompleted, startFn: 'startHexacoTest' },
                { name: 'Enneagram', type: 'enneagram', checkFn: checkEnneagramCompleted, startFn: 'startEnneagramTest' },
                { name: 'Dark Triad', type: 'dark_triad', checkFn: checkDarkTriadCompleted, startFn: 'startDarkTriadTest' },
                { name: 'Character Strengths', type: 'strengths', checkFn: checkStrengthsCompleted, startFn: 'startStrengthsTest' },
                { name: 'Career Interests', type: 'career', checkFn: checkCareerCompleted, startFn: 'startCareerTest' },
                { name: 'Personal Values', type: 'values', checkFn: checkValuesCompleted, startFn: 'startValuesTest' }
            ];

            for (const test of tests) {
                const completed = await test.checkFn();
                if (!completed) {
                    return test;
                }
            }

            return null; // All tests completed
        }

        // Start next recommended test
        window.startNextTest = async function() {
            const nextTest = await getNextTest();
            if (nextTest) {
                window[nextTest.startFn]();
            }
        }

        // Update Profile Hero UI
        async function updateProfileHero() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    console.error('No session for profile hero');
                    return;
                }

                const user = session.user;
                const completedCount = await getCompletedTestsCount();
                const totalTests = 6;
                const percentage = Math.round((completedCount / totalTests) * 100);
                const nextTest = await getNextTest();

                // Update user info
                const userName = user.user_metadata?.full_name || user.email?.split('@')[0] || 'Anonymous';
                const userInitials = userName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                document.getElementById('user-name').textContent = userName;
                document.getElementById('user-email').textContent = user.email;

                // Show avatar photo if available, otherwise show initials
                const avatarUrl = user.user_metadata?.avatar_url || null;
                if (avatarUrl) {
                    const img = document.getElementById('user-avatar-img');
                    img.src = avatarUrl;
                    img.style.display = 'block';
                    document.getElementById('user-initials').style.display = 'none';
                } else {
                    document.getElementById('user-initials').textContent = userInitials;
                }

                // Update level (based on completed tests)
                const level = completedCount;
                document.getElementById('profile-level').textContent = `Lvl ${level}`;

                // Update completion stats
                document.getElementById('completion-count').textContent = `${completedCount}/${totalTests}`;
                document.getElementById('progress-percentage').textContent = `${percentage}%`;

                // Animate progress bar
                setTimeout(() => {
                    document.getElementById('progress-bar').style.width = `${percentage}%`;
                }, 300);

                // Update SVG progress ring - removed (no ring in new layout)

                // Update Premium badge — wire to actual data from profiles table
                const isPremium = window.userIsPremium;
                const badge = document.getElementById('premium-badge');
                const badgeText = document.getElementById('badge-text');
                
                if (isPremium) {
                    badge.style.borderColor = 'rgba(245,158,11,0.6)';
                    badge.style.background = 'rgba(245,158,11,0.1)';
                    badge.style.color = '#FCD34D';
                    badgeText.textContent = '✨ Premium';
                } else {
                    badge.style.borderColor = 'rgba(148,163,184,0.3)';
                    badge.style.background = 'rgba(30,41,59,0.5)';
                    badge.style.color = '#94A3B8';
                    badgeText.textContent = 'Free Account';
                }

                // Update Next Step recommendation
                const nextStepCard = document.getElementById('next-step-card');
                const nextStepText = document.getElementById('next-step-text');
                const nextStepButton = document.getElementById('next-step-button');
                const completionMessage = document.getElementById('completion-message');

                if (nextTest) {
                    nextStepCard.style.display = 'flex';
                    completionMessage.style.display = 'none';
                    nextStepText.textContent = `Rekomendowany krok: Wykonaj test "${nextTest.name}"`;
                    nextStepButton.style.display = 'inline-block';
                } else {
                    // All tests completed!
                    nextStepCard.style.display = 'none';
                    completionMessage.style.display = 'flex';
                }

                console.log('Profile Hero updated:', { completedCount, percentage, nextTest: nextTest?.name });
            } catch (err) {
                console.error('Error updating Profile Hero:', err);
            }
        }

        // ============================================
        // END PROFILE HERO FUNCTIONS
        // ============================================


        // ============================================
        // TAB SWITCHING
        // ============================================
        window.switchTab = function(tab) {
            const tests     = document.getElementById('tab-tests');
            const character = document.getElementById('tab-character');
            const btnTests  = document.getElementById('tab-btn-tests');
            const btnChar   = document.getElementById('tab-btn-character');

            if (tab === 'tests') {
                tests.style.display     = '';
                character.style.display = 'none';
                btnTests.classList.add('active');
                btnChar.classList.remove('active');
            } else {
                tests.style.display     = 'none';
                character.style.display = '';
                btnTests.classList.remove('active');
                btnChar.classList.add('active');
                loadCharacterCard();
            }
        }

        // ============================================
        // KARTA POSTACI — DATA LOADING
        // ============================================
        let ccLoaded = false;

        async function loadCharacterCard() {
            if (ccLoaded) return;

            const { data: { session } } = await supabase.auth.getSession();
            if (!session) return;
            ccLoaded = true;

            // ── Name & ID ──────────────────────────────────────
            const userName = session.user.user_metadata?.full_name
                || session.user.email?.split('@')[0]
                || 'PSYCHER';
            document.getElementById('ch-cname').textContent = userName.toUpperCase().substring(0, 14);

            // ── Avatar photo ───────────────────────────────────
            const chAvatarUrl = session.user.user_metadata?.avatar_url || null;
            if (chAvatarUrl) {
                const chImg = document.getElementById('ch-avatar-img');
                chImg.src = chAvatarUrl;
                chImg.style.display = 'block';
            }
            const charHash = Math.abs(userName.split('').reduce((a,c) => a + c.charCodeAt(0), 0)) % 9000 + 1000;
            const charId = `PSY-${charHash}-PSYCHER`;
            document.getElementById('ch-footer-id').textContent = `CHAR-ID: ${charId} · PSYCHER v2.0`;
            document.getElementById('ch-footer-id-top').textContent = `CHAR-ID: ${charId}`;
            document.getElementById('ch-footer-date').textContent =
                `BUILD ${new Date().toISOString().split('T')[0].replace(/-/g,'.')}`;

            // ── Fetch all test results ─────────────────────────
            const { data, error } = await supabase
                .from('user_psychometrics')
                .select('test_type, raw_scores, percentile_scores, completed_at')
                .eq('user_id', session.user.id)
                .in('test_type', ['HEXACO', 'ENNEAGRAM', 'DARK_TRIAD', 'STRENGTHS', 'CAREER', 'VALUES'])
                .order('completed_at', { ascending: false });

            if (error) { console.error('CC load error:', error); return; }

            const latest = {};
            (data || []).forEach(row => { if (!latest[row.test_type]) latest[row.test_type] = row; });

            const doneCount = Object.keys(latest).length;
            const xpPct = Math.round((doneCount / 7) * 100);

            // ── XP & Level ─────────────────────────────────────
            const xpFill = document.getElementById('ch-xp-fill');
            if (xpFill) xpFill.style.width = xpPct + '%';
            const xpLbl = document.getElementById('ch-xp-label');
            if (xpLbl) xpLbl.textContent = `${doneCount}/7 TESTÓW`;
            const pillEl = document.getElementById('ch-completion-pill');
            if (pillEl) pillEl.textContent = doneCount === 7 ? 'PROFIL UKOŃCZONY · 7/7 TESTÓW' : `PROFIL W BUDOWIE · ${doneCount}/7`;
            const levels = ['POCZĄTKUJĄCY','ODKRYWCA','BADACZ','ANALITYK','PROFILER','SPECJALISTA','EKSPERT','MISTRZ'];
            const lvl = Math.min(doneCount, 7);
            const lvlEl = document.getElementById('ch-lvl-text');
            if (lvlEl) lvlEl.textContent = `LVL ${lvl} · ${levels[lvl]}`;

            // Rarity
            const rares = [[100,'💎 TOP 1% POPULACJI'],[90,'✨ TOP 5% POPULACJI'],[80,'⭐ TOP 10% POPULACJI'],[60,'🔮 PROFIL KOMPLETNY'],[0,'⚙ PROFIL W BUDOWIE']];
            const rarity = rares.find(r => xpPct >= r[0]);
            const rareEl = document.getElementById('ch-rare');
            if (rareEl) rareEl.textContent = rarity[1];

            // Trait chips accumulator
            const traitChips = [];

            // ── HEXACO ──────────────────────────────────────────
            if (latest.HEXACO) {
                // Use percentile_scores (0-100); fall back to converting raw (1-5) if percentile absent
                const raw = latest.HEXACO.raw_scores || {};
                const pct = latest.HEXACO.percentile_scores || {};
                const s = Object.keys(pct).length > 0 ? pct
                    : Object.fromEntries(Object.entries(raw).map(([k,v]) => [k, Math.round(((v-1)/4)*100)]));
                const traits = [
                    { key:'conscientiousness', label:'Sumienność',   color:'#34d399', cls:'ch-ag', en:'Conscientiousness',  grad:'#007a50,#34d399' },
                    { key:'openness',           label:'Otwartość',    color:'#38b6ff', cls:'ch-ac', en:'Openness',           grad:'#1a6aff,#38b6ff' },
                    { key:'agreeableness',      label:'Ugodowość',    color:'#b08fff', cls:'ch-av', en:'Agreeableness',      grad:'#4a28b0,#b08fff' },
                    { key:'honesty_humility',   label:'Szczerość',    color:'#40e0d0', cls:'ch-at', en:'Honesty-Humility',   grad:'#006060,#40e0d0' },
                    { key:'extraversion',       label:'Ekstrawersja', color:'#e878e0', cls:'ch-ap', en:'Extraversion',       grad:'#7b1fa2,#e878e0' },
                    { key:'emotionality',       label:'Emocjonalność',color:'#f97316', cls:'ch-ao', en:'Emotionality',       grad:'#7a2000,#f97316' },
                ];
                // Attribute blocks
                const attrGrid = document.getElementById('ch-attr-grid');
                if (attrGrid) attrGrid.innerHTML = traits.map(t => {
                    const v = Math.round(s[t.key] ?? 50);
                    return `<div class="ch-attr-b ${t.cls}"><div class="ch-a-lbl">${t.label}</div><div class="ch-a-val">${v}</div><div class="ch-a-nm">${t.en}</div></div>`;
                }).join('');
                // Detail bars
                const hxBars = document.getElementById('ch-hx-bars');
                if (hxBars) hxBars.innerHTML = traits.map(t => {
                    const v = Math.round(s[t.key] ?? 50);
                    return `<div class="ch-hb"><div class="ch-hb-top"><span class="ch-hb-name">${t.label}</span><span class="ch-hb-val" style="color:${t.color}">${v}%</span></div><div class="ch-hb-track"><div class="ch-hb-fill" style="width:${v}%;background:linear-gradient(90deg,${t.grad});box-shadow:0 0 7px ${t.color}66;"></div></div></div>`;
                }).join('');
                // Hide CTA
                const ctaEl = document.getElementById('ch-hexaco-cta');
                if (ctaEl) ctaEl.style.display = 'none';
                // ── Draw HEXACO Radar SVG ──────────────────
                (function drawHexRadar(hexS) {
                    const radarEl = document.getElementById('ch-hex-radar');
                    if (!radarEl) return;
                    const cx=110,cy=110,R=82,N=6;
                    const dims6=[
                        {key:'conscientiousness',lbl:'Sumienność',  col:'#34d399'},
                        {key:'openness',         lbl:'Otwartość',   col:'#38b6ff'},
                        {key:'agreeableness',    lbl:'Ugodowość',   col:'#b08fff'},
                        {key:'honesty_humility', lbl:'Szczerość',   col:'#40e0d0'},
                        {key:'extraversion',     lbl:'Ekstrawersja',col:'#e878e0'},
                        {key:'emotionality',     lbl:'Emocjonalność',col:'#f97316'},
                    ];
                    let svg='';
                    // Grid spokes + circles
                    for(let i=0;i<N;i++){const a=(i/N)*2*Math.PI-Math.PI/2;svg+=`<line x1="${cx}" y1="${cy}" x2="${cx+R*Math.cos(a).toFixed(3)}" y2="${cy+R*Math.sin(a).toFixed(3)}" stroke="rgba(56,182,255,.1)" stroke-width="1"/>`;}
                    [0.25,0.5,0.75,1.0].forEach(r=>{svg+=`<circle cx="${cx}" cy="${cy}" r="${R*r}" fill="none" stroke="rgba(56,182,255,.07)" stroke-width="1"/>`;});
                    // Data polygon
                    const pts=dims6.map((d,i)=>{const a=(i/N)*2*Math.PI-Math.PI/2;const r=R*(hexS[d.key]||0)/100;return `${(cx+r*Math.cos(a)).toFixed(2)},${(cy+r*Math.sin(a)).toFixed(2)}`;});
                    svg+=`<polygon points="${pts.join(' ')}" fill="rgba(34,211,238,.10)" stroke="#22d3ee" stroke-width="2" stroke-linejoin="round"/>`;
                    // Vertex dots + labels
                    dims6.forEach((d,i)=>{
                        const a=(i/N)*2*Math.PI-Math.PI/2;
                        const r=R*(hexS[d.key]||0)/100;
                        const vx=(cx+r*Math.cos(a)).toFixed(2);const vy=(cy+r*Math.sin(a)).toFixed(2);
                        svg+=`<circle cx="${vx}" cy="${vy}" r="3.5" fill="${d.col}" opacity=".85"/>`;
                        const lr=R+20;const lx=(cx+lr*Math.cos(a)).toFixed(2);const ly=(cy+lr*Math.sin(a)).toFixed(2);
                        const anc=Math.cos(a)>0.15?'start':Math.cos(a)<-0.15?'end':'middle';
                        const val=Math.round(hexS[d.key]||0);
                        svg+=`<text x="${lx}" y="${(parseFloat(ly)-2).toFixed(1)}" text-anchor="${anc}" fill="${d.col}" font-family="Share Tech Mono,monospace" font-size="7" opacity=".7">${d.lbl}</text>`;
                        svg+=`<text x="${lx}" y="${(parseFloat(ly)+9).toFixed(1)}" text-anchor="${anc}" fill="${d.col}" font-family="Orbitron,monospace" font-size="9" font-weight="700">${val}</text>`;
                    });
                    radarEl.innerHTML=svg;
                })(s);
                // Derive archetype
                const con = s.conscientiousness ?? 50, opn = s.openness ?? 50, ext = s.extraversion ?? 50;
                let arch = 'Analityczny Badacz';
                if (con > 75 && opn > 65) arch = 'Strategiczny Innowator';
                else if (opn > 75) arch = 'Kreatywny Wizjoner';
                else if (con > 75) arch = 'Zdyscyplinowany Strateg';
                else if (ext > 70) arch = 'Charyzmatyczny Lider';
                else if (ext < 35) arch = 'Głęboki Myśliciel';
                const archEl = document.getElementById('ch-carch');
                if (archEl) archEl.textContent = arch;
                const codesEl = document.getElementById('ch-ccodes');
                if (codesEl) codesEl.textContent = `HEXACO-60 · ${doneCount}/7 TESTÓW`;
                // Trait chips
                if (con > 70) traitChips.push({label:'📋 Zdyscyplinowany', cls:'ch-ttg'});
                if (con > 80) traitChips.push({label:'📐 Perfekcjonista',   cls:'ch-ttw'});
                if (opn > 70) traitChips.push({label:'💡 Innowacyjny',     cls:'ch-ttt'});
                if (opn > 80) traitChips.push({label:'🔮 Wzorce',          cls:'ch-ttc'});
                if (ext > 70) traitChips.push({label:'🎭 Charyzmatyczny',  cls:'ch-ttp'});
                else if (ext < 35) traitChips.push({label:'🧘 Introwertyczny', cls:'ch-ttv'});
                if ((s.agreeableness??50) > 70) traitChips.push({label:'🤝 Empatyczny', cls:'ch-ttg'});
                if ((s.honesty_humility??50) > 70) traitChips.push({label:'⚖ Etyczny', cls:'ch-ttc'});
            }

            // ── ENNEAGRAM ────────────────────────────────────────
            const ENNLORE = {
                1: { rpg: 'Praworządny Dobry Paladin',    epithet: 'Architekt Porządku',    pop: ['Hermiona Granger', 'Ned Stark', 'Chidi (The Good Place)'] },
                2: { rpg: 'Kapłan Wsparcia',              epithet: 'Strażnik Serc',         pop: ['Leslie Knope', 'Samwise Gamgee', 'Ted Lasso'] },
                3: { rpg: 'Bard Ambicji',                 epithet: 'Architekt Sukcesu',     pop: ['Tony Stark', 'Harvey Specter', 'Jay Gatsby'] },
                4: { rpg: 'Mroczny Artysta',              epithet: 'Dziecko Cienia',        pop: ['Joker (2019)', 'Severus Snape', 'Don Draper'] },
                5: { rpg: 'Mistrz Wiedzy Zakazanej',      epithet: 'Architekt Cienia',      pop: ['Sherlock Holmes', 'Dr House', 'Walter White'] },
                6: { rpg: 'Strażnik Bractwa',             epithet: 'Bastion Lojalności',    pop: ['Captain America', 'Ron Weasley', 'Samwise Gamgee'] },
                7: { rpg: 'Chaotyczny Dobry Awanturnik',  epithet: 'Wirtuoz Możliwości',    pop: ['Jack Sparrow', 'Tyrion Lannister', 'The Mandalorian'] },
                8: { rpg: 'Warlord Wojenny',              epithet: 'Inkwizytor Woli',       pop: ['Walter White', 'Tony Soprano', 'Daenerys Targaryen'] },
                9: { rpg: 'Mnich Harmonii',               epithet: 'Spokój w Oku Cyklonu',  pop: ['Frodo Baggins', 'Ted Lasso', 'The Dude (Big Lebowski)'] },
            };
            if (latest.ENNEAGRAM) {
                const s = latest.ENNEAGRAM.raw_scores || {};
                let topType = null, topScore = -1;
                for (const [k, v] of Object.entries(s)) { if (Number(v) > topScore) { topScore = Number(v); topType = k; } }
                if (topType) {
                    const ENAMES = {1:'Reformator',2:'Pomocnik',3:'Osiągacz',4:'Indywidualista',5:'Obserwator',6:'Lojalista',7:'Entuzjasta',8:'Przywódca',9:'Mediator'};
                    const EDESCS = {
                        1:'Kieruje się zasadami, pragnie poprawiać siebie i świat. Świadomy kwestii etycznych.',
                        2:'Troszczy się o innych i buduje relacje. Realizuje się przez dawanie i wsparcie.',
                        3:'Zorientowany na cel i sukces. Adaptuje swój wizerunek, by osiągać wyznaczone cele.',
                        4:'Szuka głębokiej tożsamości. Intensywnie przeżywa emocje, pragnie autentyczności.',
                        5:'Gromadzi wiedzę i niezależność. Analizuje zanim działa, oddziela emocje od myślenia.',
                        6:'Szuka bezpieczeństwa i lojalności. Wysoka czujność wobec zagrożeń i sprzeczności.',
                        7:'Entuzjastyczny i optymistyczny. Szuka nowych doświadczeń, unika bólu i ograniczeń.',
                        8:'Silny i zdecydowany. Chroni siebie i słabszych, nie unika konfrontacji.',
                        9:'Dąży do harmonii i spokoju. Mediuje napięcia, unika eskalacji konfliktów.'
                    };
                    const ECOLS = ['#6366f1','#38b6ff','#fbbf24','#34d399','#b08fff','#f97316','#0ea5e9','#ef4444','#14b8a6'];
                    const ennCol = ECOLS[(parseInt(topType)-1) % ECOLS.length];
                    const ennNumEl = document.getElementById('ch-enn-num');
                    if (ennNumEl) { ennNumEl.textContent = topType; ennNumEl.style.color = ennCol; ennNumEl.style.textShadow = `0 0 22px ${ennCol}80`; }
                    const ennTypeEl = document.getElementById('ch-enn-type');
                    if (ennTypeEl) ennTypeEl.textContent = ENAMES[topType] || `Typ ${topType}`;
                    const ennSubEl = document.getElementById('ch-enn-sub');
                    if (ennSubEl) ennSubEl.textContent = `TYP ${topType} · ENNEAGRAM`;
                    const ennDescEl = document.getElementById('ch-enn-desc');
                    if (ennDescEl) ennDescEl.textContent = EDESCS[topType] || '';
                    window._ch_ennName = ENAMES[topType] || `Typ ${topType}`;
                    traitChips.push({label:`🌀 ${ENAMES[topType]||'Typ '+topType}`, cls:'ch-ttv'});
                    // ── Draw Enneagram Star SVG ────────────
                    (function drawEnnStar(tType, tCol) {
                        const starEl = document.getElementById('ch-enn-star');
                        if (!starEl) return;
                        const cx=100,cy=100,R=82,N=9;
                        const pt=i=>{const a=(i/N)*2*Math.PI-Math.PI/2;return[(cx+R*Math.cos(a)).toFixed(2),(cy+R*Math.sin(a)).toFixed(2)];};
                        let svg=`<circle cx="${cx}" cy="${cy}" r="${R}" fill="none" stroke="rgba(176,143,255,.08)" stroke-width="1.5"/>`;
                        svg+=`<circle cx="${cx}" cy="${cy}" r="${R*0.55}" fill="none" stroke="rgba(176,143,255,.05)" stroke-width="1"/>`;
                        // Enneagram inner lines: 1-4-2-8-5-7-1 hexad + 3-6-9 triangle
                        [[1,4],[4,2],[2,8],[8,5],[5,7],[7,1],[3,6],[6,9],[9,3]].forEach(([a,b])=>{
                            const [x1,y1]=pt(a-1);const [x2,y2]=pt(b-1);
                            svg+=`<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="rgba(176,143,255,.12)" stroke-width="1"/>`;
                        });
                        // Nodes
                        for(let i=1;i<=9;i++){
                            const [x,y]=pt(i-1);const isActive=String(i)===String(tType);
                            const col=isActive?tCol:'rgba(255,255,255,.14)';
                            const r=isActive?9:5;
                            svg+=`<circle cx="${x}" cy="${y}" r="${r}" fill="${isActive?tCol+'22':'rgba(255,255,255,.03)'}" stroke="${col}" stroke-width="${isActive?2:1}"/>`;
                            if(isActive)svg+=`<circle cx="${x}" cy="${y}" r="${r+5}" fill="none" stroke="${tCol}" stroke-width=".7" opacity=".35"/>`;
                            svg+=`<text x="${x}" y="${(parseFloat(y)+4).toFixed(1)}" text-anchor="middle" fill="${isActive?tCol:'rgba(255,255,255,.35)'}" font-family="Orbitron,monospace" font-size="${isActive?9:7}" font-weight="${isActive?700:400}">${i}</text>`;
                        }
                        starEl.innerHTML=svg;
                    })(topType, ennCol);

                    // ── RPG Archetype ──────────────────────────
                    const lore = ENNLORE[parseInt(topType)];
                    if (lore) {
                        const ennCol2 = ECOLS[(parseInt(topType)-1) % ECOLS.length];
                        const rpgEl = document.getElementById('ch-rpg-content');
                        if (rpgEl) { rpgEl.innerHTML = `
                            <div style="padding:4px 0 8px;">
                                <div style="font-family:'Orbitron',monospace;font-size:18px;font-weight:700;color:${ennCol2};text-shadow:0 0 20px ${ennCol2}66;letter-spacing:1px;margin-bottom:4px;">${lore.rpg}</div>
                                <div style="font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:2.5px;color:rgba(255,255,255,.35);text-transform:uppercase;margin-bottom:12px;">"${lore.epithet}"</div>
                                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                    <span style="display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:3px;background:rgba(${ennCol2 === '#6366f1' ? '99,102,241' : '56,182,255'},.08);border:1px solid ${ennCol2}33;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;color:${ennCol2};">⚔ ${ENAMES[topType]||'Typ '+topType}</span>
                                    <span style="display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:3px;background:rgba(123,94,167,.1);border:1px solid rgba(123,94,167,.25);font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;color:#b08fff;">TYP ${topType} · ENNEAGRAM</span>
                                </div>
                            </div>`; }

                        // ── Pop Culture ────────────────────────
                        const popEl = document.getElementById('ch-pop-content');
                        if (popEl && lore.pop.length > 0) popEl.innerHTML = `
                            <div style="margin-bottom:10px;font-size:10px;color:rgba(255,255,255,.35);line-height:1.6;">Na podstawie Twojego profilu Enneagram (Typ ${topType}) najbardziej przypominasz:</div>
                            <div style="display:flex;flex-direction:column;gap:7px;">${
                                lore.pop.map((char, i) => {
                                    const colors = ['#38b6ff','#b08fff','#34d399'];
                                    const col = colors[i % colors.length];
                                    const ranks = ['01','02','03'];
                                    return `<div style="display:flex;align-items:center;gap:10px;padding:8px 11px;border-radius:4px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);">
                                        <div style="font-family:'Orbitron',monospace;font-size:10px;font-weight:700;color:${col};min-width:22px;">${ranks[i]}</div>
                                        <div style="flex:1;font-size:12px;font-weight:600;color:rgba(255,255,255,.85);">${char}</div>
                                        <div style="font-family:'Share Tech Mono',monospace;font-size:8px;letter-spacing:1.5px;color:${col}88;">${Math.round(95 - i * 8)}% MATCH</div>
                                    </div>`;
                                }).join('')
                            }</div>
                            <div style="margin-top:10px;padding:8px 11px;border-radius:3px;background:rgba(56,182,255,.04);border:1px solid rgba(56,182,255,.12);font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:1.5px;color:rgba(56,182,255,.45);">
                                DOPASOWANIE NA PODSTAWIE: ENNEAGRAM TYPE ${topType} · ${ENAMES[topType]||''}
                            </div>`;
                    }
                }
            }

            // ── CAREER (RIASEC) ──────────────────────────────────
            if (latest.CAREER) {
                const s = latest.CAREER.raw_scores || {};
                const code = s.holland_code || '???';
                const top3 = (s.top_3 || []).slice(0,3);
                const clsMap = ['ch-hl-i','ch-hl-e','ch-hl-a'];
                const holLtrs = document.getElementById('ch-hol-ltrs');
                if (holLtrs) holLtrs.innerHTML = [...code].slice(0,3).map((l,i) =>
                    `<div class="ch-hl ${clsMap[i]||'ch-hl-i'}">${l}</div>`).join('');
                const careersEl = document.getElementById('ch-careers');
                if (careersEl && top3.length > 0) careersEl.innerHTML = top3.map(t =>
                    `<span class="ch-ct">${(t.name||t.letter||'?').split(' ')[0].toUpperCase()}</span>`).join('');
            }

            // ── VALUES (Schwartz PVQ-40) ─────────────────────────
            if (latest.VALUES) {
                const s = latest.VALUES.raw_scores || {};
                const top3 = (s.top_3 || []).slice(0,3);
                const vcClasses = ['ch-vc1','ch-vc2','ch-vc3','ch-vc4'];
                const valEl = document.getElementById('ch-val-chips');
                if (valEl && top3.length > 0) valEl.innerHTML = top3.map((v,i) =>
                    `<span class="ch-vc ${vcClasses[i%vcClasses.length]}">${v.name||v.id||'?'}</span>`).join('');
            }

            // ── DARK TRIAD ───────────────────────────────────────
            if (latest.DARK_TRIAD) {
                const s = latest.DARK_TRIAD.raw_scores || {};
                // raw_scores = { dimensions: { psychopathy: { raw_score: 1-5 }, ... } }
                const dtDims = s.dimensions || {};
                const toV = raw => raw <= 5 ? Math.round(((raw - 1) / 4) * 100) : Math.round(raw);
                const getRaw = (k) => dtDims[k]?.raw_score ?? dtDims[k.charAt(0).toUpperCase()+k.slice(1)]?.raw_score ?? 0;
                const dtDefs = [
                    { key:'psychopathy',      label:'Psychopatia',  ico:'⚡', color:'#ef4444', grad:'#6b0012,#e8001c,#ff2d55', tags:['tolerancja ryzyka','impulsywność','brak empatii'] },
                    { key:'machiavellianism', label:'Makiawelizm',  ico:'🎭', color:'#f97316', grad:'#7a1a00,#ff6230,#ff9060',  tags:['myślenie strategiczne','cynizm','manipulacja'] },
                    { key:'narcissism',       label:'Narcyzm',      ico:'👑', color:'#fbbf24', grad:'#7a4000,#ffaa00,#ffd060',  tags:['charyzma','potrzeba uznania','wyjątkowość'] },
                ];
                // Summary block in typology panel
                const pPct = toV(getRaw('psychopathy')), mPct = toV(getRaw('machiavellianism')), nPct = toV(getRaw('narcissism'));
                const avgDT = Math.round((pPct + mPct + nPct) / 3);
                const dtSumEl = document.getElementById('ch-dt-summary');
                if (dtSumEl) {
                    const dtCol = avgDT > 70 ? '#ef4444' : avgDT > 50 ? '#f97316' : '#34d399';
                    dtSumEl.innerHTML = `<span style="color:${dtCol};font-weight:700;font-family:'Orbitron',monospace;font-size:13px;">${avgDT}%</span> śr. · Ps: ${pPct}% / Mach: ${mPct}% / Narc: ${nPct}%`;
                }
                // Full bars
                const dtContentEl = document.getElementById('ch-dt-content');
                if (dtContentEl) {
                    dtContentEl.innerHTML = `<div class="ch-dt-bars">` + dtDefs.map(t => {
                        const raw = getRaw(t.key);
                        const pct = toV(raw);
                        const displayVal = raw <= 5 ? raw.toFixed(2) : raw;
                        const maxLabel = raw <= 5 ? '/5' : '%';
                        return `<div class="ch-dt-row">
                            <div class="ch-dt-head">
                                <div class="ch-dt-name" style="color:${t.color}">${t.ico} ${t.label}</div>
                                <div class="ch-dt-sw">
                                    <div class="ch-dt-sc" style="color:${t.color}">${displayVal}</div>
                                    <div class="ch-dt-mx">${maxLabel}</div>
                                    <div class="ch-dt-pc" style="color:${t.color}88">&nbsp;${pct}%</div>
                                </div>
                            </div>
                            <div class="ch-dt-track"><div class="ch-dt-fill" style="width:${pct}%;background:linear-gradient(90deg,${t.grad});box-shadow:0 0 12px ${t.color}88;"></div></div>
                            <div class="ch-dt-tags">${t.tags.map(tag=>`<span class="ch-dtag">${tag}</span>`).join('')}</div>
                        </div>`;
                    }).join('') + `</div>
                    <div style="margin-top:10px;padding:9px 11px;border-radius:3px;background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.16);">
                        <div style="font-family:'Share Tech Mono',monospace;font-size:7.5px;letter-spacing:1.5px;color:rgba(239,68,68,.55);margin-bottom:3px;">⚠ ALERT SYSTEMOWY</div>
                        <div style="font-size:10px;color:rgba(255,255,255,.35);line-height:1.55;">${avgDT > 60 ? 'Podwyższona Ciemna Triada. Rozważ świadome zarządzanie relacjami.' : 'Wyniki mieszczą się w normie populacyjnej.'}</div>
                    </div>`;
                }
                // Shadow areas
                const shadows = [];
                if (pPct > 60) shadows.push({ ico:'⚡', title:`Impulsywność i ryzyko [PSYCHOPATIA ${pPct}%]`, desc:'Silna tendencja do ryzykownych decyzji bez pełnej analizy konsekwencji. Wysoka tolerancja ryzyka może prowadzić do lekkomyślnych działań.' });
                if (mPct > 60) shadows.push({ ico:'🎭', title:`Manipulacyjność w relacjach [MAKIAWELIZM ${mPct}%]`, desc:'Skłonność do instrumentalnego traktowania innych. Cyniczne spojrzenie na motywacje ludzi może podważać autentyczność relacji.' });
                if (nPct > 70) shadows.push({ ico:'👑', title:`Nadmierne ego [NARCYZM ${nPct}%]`, desc:'Silna potrzeba podziwu i uznania. W konflikcie dominuje perspektywa własnych interesów nad potrzebami innych.' });
                if (shadows.length > 0) {
                    const shadowEl = document.getElementById('ch-shadow-content');
                    if (shadowEl) shadowEl.innerHTML = `<div class="ch-sh-list">` + shadows.map(sh =>
                        `<div class="ch-sh-item"><div class="ch-shico">${sh.ico}</div><div class="ch-shbd"><div class="ch-shtt">${sh.title}</div><div class="ch-sht">${sh.desc}</div></div></div>`
                    ).join('') + `</div>`;
                }
                // Trait additions
                if (mPct > 60) traitChips.push({label:'♟ Strategiczny', cls:'ch-ttc'});
                if (pPct > 60) traitChips.push({label:'⚡ Risk taker',  cls:'ch-tto'});
                if (nPct > 60) traitChips.push({label:'👁 Pewny siebie', cls:'ch-ttp'});
            }

            // ── STRENGTHS ─────────────────────────────────────────
            if (latest.STRENGTHS) {
                const s = latest.STRENGTHS.raw_scores || {};
                const top5 = (s.top_5 || []).slice(0, 5);
                const CAT_COLORS = { strategic_thinking:'#34d399', executing:'#b08fff', influencing:'#fbbf24', relationship_building:'#60a5fa' };
                if (top5.length > 0) {
                    const domCat = top5.reduce((acc, t) => { acc[t.category] = (acc[t.category]||0)+1; return acc; }, {});
                    const topCat = Object.entries(domCat).sort((a,b)=>b[1]-a[1])[0]?.[0];
                    const strEl = document.getElementById('ch-str-content');
                    if (strEl) strEl.innerHTML = `<div class="ch-str-list">` +
                        top5.map((t,i) => {
                            const col = CAT_COLORS[t.category] || '#38b6ff';
                            return `<div class="ch-str-item">
                                <div class="ch-srk">0${i+1}</div>
                                <div class="ch-sinf"><div class="ch-snm">${t.name||t.name_en||'?'}</div><div class="ch-sct">${(t.category||'').replace(/_/g,' ').toUpperCase()}</div></div>
                                <div class="ch-sbar"><div class="ch-sbf" style="width:${95-i*7}%;background:linear-gradient(90deg,#3d2a9e,${col});"></div></div>
                            </div>`;
                        }).join('') + `</div>` +
                        (topCat ? `<div style="margin-top:11px;padding:9px 11px;border-radius:4px;background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.13);">
                            <div style="font-size:11px;font-weight:700;color:${CAT_COLORS[topCat]||'#38b6ff'};margin-bottom:2px;">${topCat.replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase())} Dominuje</div>
                            <div style="font-size:9px;color:rgba(255,255,255,.35);">${domCat[topCat]}/${top5.length} talentów w klastrze</div>
                        </div>` : '') +
                        `<button class="ch-go-btn" onclick="window.location.href='/test/strengths/results'" style="margin-top:10px;">Zobacz pełne wyniki →</button>`;
                    // Trait chips from strengths
                    top5.slice(0,3).forEach(t => traitChips.push({label:`⭐ ${t.name||t.name_en||'?'}`, cls:'ch-ttg'}));
                }
            }

            // ── TRAIT CHIPS ────────────────────────────────────────
            if (traitChips.length > 0) {
                const traitsEl = document.getElementById('ch-traits-content');
                if (traitsEl) traitsEl.innerHTML = `<div class="ch-tflow">${traitChips.map(t => `<span class="ch-tt ${t.cls}">${t.label}</span>`).join('')}</div>`;
            }

            // ── AI INSIGHT ─────────────────────────────────────────
            if (doneCount >= 3) {
                const insights = [];
                if (latest.HEXACO && latest.STRENGTHS) {
                    const s = latest.HEXACO.raw_scores || {};
                    const con = s.conscientiousness??50, opn = s.openness??50;
                    insights.push({ color:'#38b6ff', title:'PROFIL ZAWODOWY',
                        text:`Kombinacja <strong>HEXACO + Strengths</strong> wskazuje na profil ${opn>70?'innowatora i architekta systemów':con>70?'doskonałego wykonawcy i lidera':'wszechstronnego specjalisty'} — osoby zdolnej do syntezy wiedzy i przekładania jej na efekty.`
                    });
                }
                if (latest.DARK_TRIAD) {
                    const s2 = latest.DARK_TRIAD.raw_scores || {};
                    const dtDims2 = s2.dimensions || {};
                    const toV2 = raw => raw <= 5 ? Math.round(((raw - 1) / 4) * 100) : Math.round(raw);
                    const getR = k => dtDims2[k]?.raw_score ?? dtDims2[k.charAt(0).toUpperCase()+k.slice(1)]?.raw_score ?? 0;
                    const pP = toV2(getR('psychopathy')), mP = toV2(getR('machiavellianism'));
                    if (pP > 60 || mP > 60) insights.push({ color:'#ef4444', title:'PUNKT KRYTYCZNY',
                        text:`Podwyższona Ciemna Triada (<strong>Psychopatia ${pP}% + Makiawelizm ${mP}%</strong>) w połączeniu z analitycznym profilem tworzy osobę o wyjątkowej skuteczności. Świadome zarządzanie relacjami jest kluczem.`
                    });
                }
                if (latest.ENNEAGRAM && window._ch_ennName) insights.push({ color:'#b08fff', title:'ŚCIEŻKA ROZWOJU',
                    text:`Enneagram <strong>${window._ch_ennName}</strong> wskazuje specyficzną ścieżkę wzrostu. Zrozumienie własnych mechanizmów obronnych to klucz do pełnego potencjału.`
                });
                if (insights.length > 0) {
                    const insightEl = document.getElementById('ch-insight-content');
                    if (insightEl) insightEl.innerHTML = insights.map(ins => {
                        const rgb = ins.color === '#38b6ff' ? '56,182,255' : ins.color === '#ef4444' ? '239,68,68' : '176,143,255';
                        return `<div class="ch-iblk" style="background:rgba(${rgb},.04);border:1px solid rgba(${rgb},.12);">
                            <div class="ch-ib-hd" style="color:rgba(${rgb},.65)">${ins.title}</div>
                            <div class="ch-ib-tx">${ins.text}</div>
                        </div>`;
                    }).join('');
                }
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        // ── Handle Stripe return redirect ──────────────────────────────────
        (async function handleStripeReturn() {
            const params = new URLSearchParams(window.location.search);
            const paymentStatus = params.get('payment');
            const sessionId     = params.get('session_id');
            if (!paymentStatus) return;

            // Remove query params from URL without reload
            window.history.replaceState({}, '', window.location.pathname);

            if (paymentStatus === 'success' && sessionId) {
                // ── Verify payment with Stripe and update is_premium in DB ──
                try {
                    const { data: { session } } = await supabase.auth.getSession();
                    if (session?.access_token) {
                        const resp = await fetch(
                            `${supabaseUrl}/functions/v1/create-checkout-session`,
                            {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${session.access_token}`,
                                },
                                body: JSON.stringify({ action: 'verify', session_id: sessionId }),
                            }
                        );
                        const result = await resp.json();
                        if (result.is_premium) {
                            window.userIsPremium = true;
                            // Update Dark Triad card UI immediately
                            if (typeof updateDarkTriadUI === 'function') updateDarkTriadUI();
                            if (typeof updateProfileHero === 'function') updateProfileHero(session.user);
                        }
                    }
                } catch (e) {
                    console.warn('[payment] verify-payment error:', e);
                }

                setTimeout(() => {
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position:fixed;bottom:28px;right:28px;z-index:9999;
                        background:linear-gradient(135deg,rgba(245,158,11,.15),rgba(217,119,6,.12));
                        border:1px solid rgba(245,158,11,.45);
                        border-radius:16px;padding:18px 24px;
                        color:#fcd34d;font-family:'Space Grotesk',sans-serif;
                        font-size:14px;font-weight:600;max-width:340px;
                        box-shadow:0 0 32px -6px rgba(245,158,11,.4);
                        animation:slideInRight .4s ease;
                    `;
                    toast.innerHTML = '✨ <strong>Płatność zakończona sukcesem!</strong><br><span style="color:rgba(255,255,255,.6);font-size:13px;">Test Dark Triad SD3 jest teraz odblokowany.</span>';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 7000);
                }, 300);
            } else if (paymentStatus === 'cancelled') {
                setTimeout(() => {
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position:fixed;bottom:28px;right:28px;z-index:9999;
                        background:rgba(15,20,40,.9);border:1px solid rgba(255,255,255,.1);
                        border-radius:16px;padding:16px 22px;
                        color:rgba(255,255,255,.6);font-family:'Space Grotesk',sans-serif;
                        font-size:13px;max-width:320px;
                    `;
                    toast.textContent = 'Płatność anulowana. Możesz spróbować ponownie w dowolnej chwili.';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 5000);
                }, 400);
            }
        })();
    </script>

</body>
</html>
