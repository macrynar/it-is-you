<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>It Is You - Testy Psychometryczne</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes blink {
            0%, 90%, 100% { opacity: 1; transform: scale(1); }
            95% { opacity: 0.3; transform: scale(0.5); }
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3), 0 0 40px rgba(139, 92, 246, 0.1); }
            50% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 60px rgba(139, 92, 246, 0.2); }
        }
        
        body {
            background: #0B0F19;
            background-image: 
                radial-gradient(at 50% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
        }
        
        .grid-bg {
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(139, 92, 246, 0.5);
            background: rgba(30, 41, 59, 0.6);
            box-shadow: 
                0 20px 60px -15px rgba(139, 92, 246, 0.4),
                0 0 0 1px rgba(139, 92, 246, 0.2),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
        }
        
        .glass-card-active {
            animation: glow 3s ease-in-out infinite;
        }
        
        .glass-card-locked {
            opacity: 0.6;
            position: relative;
        }
        
        .glass-card-locked::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            border-radius: 1rem;
            pointer-events: none;
        }
        
        .glass-card-locked:hover {
            transform: none;
            border-color: rgba(255, 255, 255, 0.1);
            background: rgba(30, 41, 59, 0.4);
            box-shadow: none;
        }
        
        .neon-badge {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: rgb(196, 181, 253);
            font-size: 0.7rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .neon-badge-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: rgb(134, 239, 172);
        }
        
        .brand-font {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            letter-spacing: -0.02em;
        }
        
        .card-icon-wrapper {
            position: relative;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-icon-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.75rem;
            padding: 2px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.6), rgba(59, 130, 246, 0.4));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
    </style>
</head>
<body class="min-h-screen text-white grid-bg">

    <!-- NAVIGATION -->
    <nav class="border-b border-white/10 bg-black/30 backdrop-blur-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="/index2.html" class="flex items-center gap-3 group">
                    <div class="relative w-10 h-10 flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-br from-violet-500/20 to-cyan-500/10 rounded-full group-hover:from-violet-500/30 group-hover:to-cyan-500/20 transition-all" style="animation: pulse 3s ease-in-out infinite;"></div>
                        <svg class="w-10 h-10 absolute" viewBox="0 0 40 40" fill="none" style="animation: spin 18s linear infinite;">
                            <circle cx="20" cy="20" r="18" stroke="url(#grad1)" stroke-width="1.5" opacity="0.3"/>
                            <circle cx="20" cy="3" r="2" fill="#8B5CF6"/>
                            <defs>
                                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#06B6D4;stop-opacity:0.3" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="relative w-6 h-6 rounded-full bg-gradient-to-br from-violet-600 via-purple-600 to-cyan-600 shadow-lg"></div>
                        <div class="absolute w-2 h-2 rounded-full bg-white" style="animation: blink 2.8s ease-in-out infinite;"></div>
                    </div>
                    <div>
                        <div class="text-xl font-bold tracking-tight brand-font bg-gradient-to-r from-violet-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent">
                            It路is路YOU
                        </div>
                        <div class="text-[9px] text-slate-500 -mt-1 tracking-wider">PSYCHER ENGINE</div>
                    </div>
                </a>

                <!-- User Actions -->
                <div class="flex items-center gap-4">
                    <button onclick="window.location.href='/user-profile-tests.html'" class="px-4 py-2 text-sm text-slate-300 hover:text-white transition-colors">
                        Dashboard
                    </button>
                    <button onclick="logout()" class="px-4 py-2 bg-slate-800/50 hover:bg-slate-700/70 text-white rounded-lg text-sm border border-white/10 hover:border-violet-500/50 transition-all backdrop-blur-sm">
                        Wyloguj
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="max-w-7xl mx-auto px-6 py-16">
        
        <!-- Header Section -->
        <div class="mb-16 text-center">
            <h1 class="text-6xl md:text-7xl font-bold brand-font mb-6 bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent leading-tight">
                Testy Psychometryczne
            </h1>
            <p class="text-xl text-slate-400 max-w-2xl mx-auto">
                Odkryj swoj wyjtkow psychik przez <span class="text-violet-400 font-semibold">7 kluczowych wymiar贸w</span>
            </p>
        </div>

        <!-- Test Cards Grid -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16">
            
            <!-- TEST 1: HEXACO-60 -->
            <div class="glass-card glass-card-active rounded-2xl p-6 cursor-pointer group" onclick="startHexacoTest()">
                <div class="flex items-center justify-between mb-5">
                    <div class="card-icon-wrapper bg-gradient-to-br from-violet-600/20 to-purple-600/20">
                        <svg class="w-7 h-7 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <span id="hexaco-status" class="neon-badge">
                        Do wykonania
                    </span>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 group-hover:text-violet-400 transition-colors">HEXACO-60</h3>
                <p class="text-sm text-slate-400 mb-6">6 wymiar贸w osobowoci</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>15 min 路 60 pyta</span>
                </div>
                
                <button id="hexaco-button" class="w-full px-4 py-3 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-violet-500/20 hover:shadow-violet-500/40">
                    Rozpocznij Test
                </button>
            </div>

            <!-- TEST 2: Enneagram -->
            <div class="glass-card glass-card-active rounded-2xl p-6 cursor-pointer group" onclick="startEnneagramTest()">
                <div class="flex items-center justify-between mb-5">
                    <div class="card-icon-wrapper bg-gradient-to-br from-pink-600/20 to-rose-600/20">
                        <svg class="w-7 h-7 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <span id="enneagram-status" class="neon-badge">
                        Do wykonania
                    </span>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 group-hover:text-pink-400 transition-colors">Enneagram</h3>
                <p class="text-sm text-slate-400 mb-6">Motywacja - Typy 1-9</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>10 min 路 36 pyta</span>
                </div>
                
                <button id="enneagram-button" class="w-full px-4 py-3 bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-500 hover:to-rose-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-pink-500/20 hover:shadow-pink-500/40">
                    Rozpocznij Test
                </button>
            </div>

            <!-- TEST 3: Dark Triad -->
            <div class="glass-card glass-card-active rounded-2xl p-6 cursor-pointer group" onclick="startDarkTriadTest()">
                <div class="flex items-center justify-between mb-5">
                    <div class="card-icon-wrapper bg-gradient-to-br from-rose-600/20 to-red-600/20">
                        <svg class="w-7 h-7 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                    <span id="dark-triad-status" class="neon-badge">
                        Do wykonania
                    </span>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 group-hover:text-rose-400 transition-colors">Dark Triad SD3</h3>
                <p class="text-sm text-slate-400 mb-6">Cie / Ryzyka</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>8 min 路 27 pyta</span>
                </div>
                
                <button id="dark-triad-button" class="w-full px-4 py-3 bg-gradient-to-r from-rose-600 to-red-600 hover:from-rose-500 hover:to-red-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-rose-500/20 hover:shadow-rose-500/40">
                    Zbadaj Cie
                </button>
            </div>

            <!-- TEST 4: Strengths -->
            <div class="glass-card glass-card-locked rounded-2xl p-6">
                <div class="flex items-center justify-between mb-5 relative z-10">
                    <div class="card-icon-wrapper bg-gradient-to-br from-amber-600/20 to-yellow-600/20">
                        <svg class="w-7 h-7 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 relative z-10">Strengths Assessment</h3>
                <p class="text-sm text-slate-400 mb-6 relative z-10">Talenty - Top 5</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6 relative z-10">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>12 min 路 48 pyta</span>
                </div>
                
                <button disabled class="w-full px-4 py-3 bg-slate-800/50 text-slate-500 font-semibold rounded-xl cursor-not-allowed relative z-10 border border-slate-700/30">
                    Wkr贸tce
                </button>
            </div>

            <!-- TEST 5: Career Interests -->
            <div class="glass-card glass-card-locked rounded-2xl p-6">
                <div class="flex items-center justify-between mb-5 relative z-10">
                    <div class="card-icon-wrapper bg-gradient-to-br from-emerald-600/20 to-green-600/20">
                        <svg class="w-7 h-7 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                       </svg>
                    </div>
                    <svg class="w-5 h-5 text-slate-600 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 relative z-10">Career Interests RIASEC</h3>
                <p class="text-sm text-slate-400 mb-6 relative z-10">Holland Code</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6 relative z-10">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>12 min 路 48 pyta</span>
                </div>
                
                <button disabled class="w-full px-4 py-3 bg-slate-800/50 text-slate-500 font-semibold rounded-xl cursor-not-allowed relative z-10 border border-slate-700/30">
                    Wkr贸tce
                </button>
            </div>

            <!-- TEST 6: Values Schwartz -->
            <div class="glass-card glass-card-locked rounded-2xl p-6">
                <div class="flex items-center justify-between mb-5 relative z-10">
                    <div class="card-icon-wrapper bg-gradient-to-br from-purple-600/20 to-violet-600/20">
                        <svg class="w-7 h-7 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                    </div>
                    <svg class="w-5 h-5 text-slate-600 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2 relative z-10">Values Schwartz</h3>
                <p class="text-sm text-slate-400 mb-6 relative z-10">Co jest wa偶ne</p>
                
                <div class="flex items-center gap-2 text-xs text-slate-500 mb-6 relative z-10">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>10 min 路 40 pyta</span>
                </div>
                
                <button disabled class="w-full px-4 py-3 bg-slate-800/50 text-slate-500 font-semibold rounded-xl cursor-not-allowed relative z-10 border border-slate-700/30">
                    Wkr贸tce
                </button>
            </div>



        </div>

        <!-- Info Section -->
        <div class="mt-20 glass-card rounded-3xl p-10 border border-violet-500/20 relative overflow-hidden">
            <!-- Glow effect -->
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-96 h-96 bg-violet-500/10 rounded-full blur-3xl"></div>
            
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-8 brand-font text-center relative">
                <span class="bg-gradient-to-r from-violet-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent">
                    Jak to dziaa?
                </span>
            </h2>
            <div class="grid md:grid-cols-3 gap-8 text-slate-300 relative">
                <div class="text-center">
                    <div class="text-5xl mb-4 filter drop-shadow-lg"></div>
                    <h3 class="font-bold text-white mb-3 text-lg">1. Wypenij Testy</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Odpowiedz szczerze na pytania w ka偶dym tecie. Nie ma zych odpowiedzi.</p>
                </div>
                <div class="text-center">
                    <div class="text-5xl mb-4 filter drop-shadow-lg"></div>
                    <h3 class="font-bold text-white mb-3 text-lg">2. Otrzymaj Wyniki</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Natychmiast po zakoczeniu zobaczysz szczeg贸ow analiz swoich wynik贸w.</p>
                </div>
                <div class="text-center">
                    <div class="text-5xl mb-4 filter drop-shadow-lg"></div>
                    <h3 class="font-bold text-white mb-3 text-lg">3. Odkryj Siebie</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Zbudujemy Twoj unikaln Kart Postaci na podstawie wszystkich test贸w.</p>
                </div>
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="border-t border-white/5 bg-black/30 backdrop-blur-xl mt-24">
        <div class="max-w-7xl mx-auto px-6 py-10 text-center">
            <p class="text-slate-500 text-sm">
                &copy; 2026 <span class="text-violet-400 font-semibold">It Is You</span> - Psycher Engine. Wszystkie prawa zastrze偶one.
            </p>
        </div>
    </footer>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://uvzilorpyuqicuwkufky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2emlsb3JweXVxaWN1d2t1Zmt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNDQzNTAsImV4cCI6MjA4NjkyMDM1MH0.jNIkqASHNl_7WbLq0jBZ86kRDmRP2jzIbI-db9l9teA';
        const supabase = createClient(supabaseUrl, supabaseKey);

        console.log('Dashboard loaded, Supabase client created');
        
        // Debug: Check localStorage keys
        console.log('LocalStorage keys:', Object.keys(localStorage));
        const supabaseKeys = Object.keys(localStorage).filter(k => k.includes('supabase') || k.includes('sb-'));
        console.log('Supabase-related keys:', supabaseKeys);
        supabaseKeys.forEach(key => {
            const value = localStorage.getItem(key);
            console.log(`  ${key}:`, value?.substring(0, 100) + '...');
        });

        // Check authentication
        async function checkAuth() {
            console.log('Checking auth...');
            // Wait for Supabase to restore session from localStorage
            const { data: { session }, error } = await supabase.auth.getSession();
            
            console.log('Session check:', { session: session ? 'exists' : 'null', error, userId: session?.user?.id });
            
            if (error || !session) {
                console.log('No valid session, redirecting to auth');
                window.location.href = '/auth';
                return false;
            }
            
            console.log('User authenticated:', session.user.id);
            return true;
        }

        // Logout function
        window.logout = function() {
            localStorage.removeItem('user_session');
            localStorage.removeItem('auth_token');
            localStorage.removeItem('has_profile');
            window.location.href = '/index2.html';
        }

        // Check if Dark Triad test is completed
        async function checkDarkTriadCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'DARK_TRIAD')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Dark Triad completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkDarkTriadCompleted:', err);
                return false;
            }
        }

        // Check if Enneagram test is completed
        async function checkEnneagramCompleted() {
            try {
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session || !session.user) {
                    return false;
                }

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'ENNEAGRAM')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                if (error) {
                    console.error('Error checking Enneagram completion:', error);
                    return false;
                }

                return data && data.length > 0;
            } catch (err) {
                console.error('Error in checkEnneagramCompleted:', err);
                return false;
            }
        }

        // Check if HEXACO test is completed
        async function checkHexacoCompleted() {
            try {
                // First restore the session from localStorage
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) {
                    console.error('Session error:', sessionError);
                    return false;
                }
                
                if (!session || !session.user) {
                    console.log('No active session found');
                    return false;
                }

                console.log('Checking test completion for user:', session.user.id);

                const { data, error } = await supabase
                    .from('user_psychometrics')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .eq('test_type', 'HEXACO')
                    .order('completed_at', { ascending: false })
                    .limit(1);

                console.log('Database query result:', { data, error, count: data?.length });

                if (error) {
                    console.error('Error checking test completion:', error);
                    return false;
                }

                const completed = data && data.length > 0;
                console.log('HEXACO test completed:', completed);
                if (completed) {
                    console.log('Test details:', data[0]);
                }
                return completed;
            } catch (err) {
                console.error('Error in checkHexacoCompleted:', err);
                return false;
            }
        }

        // Start Dark Triad test or view results
        window.startDarkTriadTest = async function() {
            const completed = await checkDarkTriadCompleted();
            
            if (completed) {
                window.location.href = '/test/dark-triad/results';
            } else {
                window.location.href = '/test?type=dark_triad';
            }
        }

        // Start Enneagram test or view results
        window.startEnneagramTest = async function() {
            const completed = await checkEnneagramCompleted();
            
            if (completed) {
                window.location.href = '/test/enneagram/results';
            } else {
                window.location.href = '/test?type=enneagram';
            }
        }

        // Start HEXACO test or view results
        window.startHexacoTest = async function() {
            console.log('HEXACO tile clicked, checking completion status...');
            const completed = await checkHexacoCompleted();
            console.log('Completion check result:', completed);
            
            if (completed) {
                console.log('Test completed, redirecting to results');
                window.location.href = '/test/hexaco/results';
            } else {
                console.log('Test not completed, redirecting to test');
                window.location.href = '/test';
            }
        }

        // Update UI for Dark Triad test
        async function updateDarkTriadUI() {
            const completed = await checkDarkTriadCompleted();
            
            const statusEl = document.getElementById('dark-triad-status');
            const buttonEl = document.getElementById('dark-triad-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukoczony';
                    statusEl.className = 'neon-badge neon-badge-success';
                }
                if (buttonEl) {
                    buttonEl.textContent = 'Analiza Cienia';
                    buttonEl.className = 'w-full px-4 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/40';
                }
            }
        }

        // Update UI for Enneagram test
        async function updateEnneagramUI() {
            const completed = await checkEnneagramCompleted();
            
            const statusEl = document.getElementById('enneagram-status');
            const buttonEl = document.getElementById('enneagram-button');
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukoczony';
                    statusEl.className = 'neon-badge neon-badge-success';
                }
                if (buttonEl) {
                    buttonEl.textContent = 'Zobacz Wyniki';
                    buttonEl.className = 'w-full px-4 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/40';
                }
            }
        }

        // Update UI based on test completion status
        async function updateHexacoUI() {
            console.log('Updating HEXACO UI...');
            const completed = await checkHexacoCompleted();
            console.log('Test completed status:', completed);
            
            const statusEl = document.getElementById('hexaco-status');
            const buttonEl = document.querySelector('#hexaco-button');
            
            console.log('Status element:', statusEl, 'Button element:', buttonEl);
            
            if (completed) {
                if (statusEl) {
                    statusEl.textContent = 'Ukoczony';
                    statusEl.className = 'neon-badge neon-badge-success';
                }
                if (buttonEl) {
                    buttonEl.textContent = 'Zobacz Wyniki';
                    buttonEl.className = 'w-full px-4 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/40';
                }
                console.log('UI updated to show completed state');
            } else {
                console.log('Test not completed, keeping default UI');
            }
        }

        // Initialize when DOM is ready
        async function initialize() {
            console.log('Initializing dashboard...');
            const authenticated = await checkAuth();
            if (!authenticated) {
                console.log('Not authenticated, stopping initialization');
                return;
            }
            console.log('Auth successful, updating UI...');
            await updateHexacoUI();
            await updateEnneagramUI();
            await updateDarkTriadUI();
            console.log('Dashboard initialized successfully');
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>

</body>
</html>
